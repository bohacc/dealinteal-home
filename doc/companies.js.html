<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/controllers/companies.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: lib/controllers/companies.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/*jslint node: true, unparam: true */
'use strict';

/**
 * @file companies
 * @fileOverview __Server_REST_API_Companies
 */

/**
 * @namespace __Server_REST_API_Companies
 * @author Martin Boháč
 */

var postgres = require('./api_pg'),
  tools = require('./tools'),
  constants = require('./constants'),
  exportsFactory = require('./exports_factory'),
  Promise = require('promise');

/**
 * @memberof __Server_REST_API_Companies
 * @method
 * @name list
 * @description list of companies from DB
 * @param req {Object} request reference object
 * @param res {Object} response reference object
 * @returns void
 */
exports.list = function (req, res) {
  try {
    var obj = {rows: [], count: req.query.count},
      page = req.query.page || 1,
      amount = req.query.amount || 10,
      offset = (page * amount) - amount,
      loadCount = parseInt(req.query.loadCount, 10),
      searchStr = req.query.searchStr ? req.query.searchStr.toUpperCase() : '',
      sortDirection = req.query.sortDirection ? req.query.sortDirection.toUpperCase() : '',
      sortField = req.query.sortField ? req.query.sortField.toUpperCase() : '',
      sqlContacts,
      sqlContactsCount,
      accessColumnOrder,
      accessColumnOrderDirection,
      sqlOrderBy,
      sqlOrderByField,
      sqlOrderByDirection;

    accessColumnOrder = ['COMPANY_NAME'];
    accessColumnOrderDirection = ['ASC', 'DESC'];
    sqlOrderByField = accessColumnOrder.indexOf(sortField) > -1 ? sortField : ' ID ';
    sqlOrderByDirection = accessColumnOrderDirection.indexOf(sortDirection) > -1 ? sortDirection : ' ASC ';
    sqlOrderBy = ' ' + sqlOrderByField + ' ' + (sqlOrderByField ? sqlOrderByDirection : '') + ' ';

    sqlContacts =
      'SELECT ' +
      '  ID, COMPANY_NAME AS companyname ' +
      'FROM ' +
      '  companies ' +
      'WHERE ' +
      '  UPPER(COMPANY_NAME) LIKE \'%\' || $3::varchar || \'%\' ' +
      '  OR $3::varchar IS NULL ' +
      'ORDER BY ' +
      sqlOrderBy +
      'LIMIT $1::integer ' +
      'OFFSET $2::integer';

    sqlContactsCount =
      'SELECT ' +
      '  count(*) AS rowscount ' +
      'FROM ' +
      '  companies ' +
      'WHERE ' +
      '  UPPER(COMPANY_NAME) LIKE \'%\' || $1::varchar || \'%\' ' +
      '  OR $1::varchar IS NULL ';

    if (loadCount === 1) {
      postgres.select(sqlContactsCount, [searchStr], req).then(
        function (result) {
          obj.count = tools.getSingleResult(result).rowscount || 0;
          res.json(obj);
        },
        function (result) {
          tools.sendResponseError(result, res, false);
        }
      );
    } else {
      postgres.select(sqlContacts, [amount, offset, searchStr], req).then(
        function (result) {
          res.json(tools.getMultiResult(result));
        },
        function (result) {
          tools.sendResponseError(result, res, false);
        }
      );
    }
  } catch (e) {
    tools.sendResponseError(e, res, false);
  }
};

/**
 * @memberof __Server_REST_API_Companies
 * @method
 * @name get
 * @description get company from DB
 * @param req {Object} request reference object
 * @param res {Object} response reference object
 * @returns void
 */
exports.get = function (req, res) {
  var sql, errors;
  req.assert('id', 'ID row not found.').notEmpty();

  errors = req.validationErrors();
  if (errors) {
    res.json(errors);
    return;
  }

  try {
    sql = 'SELECT ' +
      '  c.*,con.iso AS country_1_name ' +
      'FROM ' +
      '  companies AS c ' +
      '  LEFT JOIN countries AS con ON con.id = c.address_country_1 ' +
      'WHERE ' +
      '  c.id = $1::integer ';

    postgres.select(sql, [req.params.id], req).then(
      function (result) {
        res.json(tools.getSingleResult(result));
      },
      function (result) {
        tools.sendResponseError(result, res, false);
      }
    );
  } catch (e) {
    tools.sendResponseError(e, res, false);
  }
};

/**
 * @memberof __Server_REST_API_Companies
 * @method
 * @name post
 * @description post company to DB
 * @param req {Object} request reference object
 * @param res {Object} response reference object
 * @param noCloseReq {Boolean} no request
 * @returns Promise
 */
exports.post = function (req, res, noCloseReq) {
  var vals, sql, sqlSeq, errors,
    message_valid_length = constants.MESSAGE_VALIDATION_LENGTH,
    message_valid_format = constants.MESSAGE_VALIDATION_FORMAT,
    message_valid_number = constants.MESSAGE_VALIDATION_NUMBER;
  // validations
  req.assert('company_name', 'Name of company not found.').notEmpty();
  req.assert('reg_id', tools.getValidationMessage('reg_id', message_valid_length, 0, 20)).len(0, 20);
  req.assert('vat_id', tools.getValidationMessage('vat_id', message_valid_length, 0, 20)).len(0, 20);
  req.assert('company_name', tools.getValidationMessage('company_name', message_valid_length, 0, 255)).len(0, 255);
  if (req.body.company_group) {
    req.assert('company_group', tools.getValidationMessage('company_group', message_valid_number, null, null)).isInt();
  }
  req.assert('address_tag_1', tools.getValidationMessage('address_tag_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('address_street_1', tools.getValidationMessage('address_street_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('address_city_1', tools.getValidationMessage('address_city_1', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateZip(req.body.address_zip_1) && req.body.address_zip_1) {
    req.assert('address_zip_1', tools.getValidationMessage('address_zip_1', message_valid_format, null, null)).isNull();
  }
  req.assert('address_zip_1', tools.getValidationMessage('address_zip_1', message_valid_length, 0, 20)).len(0, 20);
  req.assert('address_region_1', tools.getValidationMessage('address_region_1', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_1_1) && req.body.phone_1_1) {
    req.assert('phone_1_1', tools.getValidationMessage('phone_1_1', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_1_1', tools.getValidationMessage('phone_1_1', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_1_1_tag', tools.getValidationMessage('phone_1_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_1_2) && req.body.phone_1_2) {
    req.assert('phone_1_2', tools.getValidationMessage('phone_1_2', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_1_2', tools.getValidationMessage('phone_1_2', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_1_2_tag', tools.getValidationMessage('phone_1_2_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_1_3) && req.body.phone_1_3) {
    req.assert('phone_1_3', tools.getValidationMessage('phone_1_3', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_1_3', tools.getValidationMessage('phone_1_3', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_1_3_tag', tools.getValidationMessage('phone_1_3_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_1_1) && req.body.email_1_1) {
    req.assert('email_1_1', tools.getValidationMessage('email_1_1', message_valid_format, null, null)).isNull();
  }
  req.assert('email_1_1', tools.getValidationMessage('email_1_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_1_1_tag', tools.getValidationMessage('email_1_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_1_2) && req.body.email_1_2) {
    req.assert('email_1_2', tools.getValidationMessage('email_1_2', message_valid_format, null, null)).isNull();
  }
  req.assert('email_1_2', tools.getValidationMessage('email_1_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_1_2_tag', tools.getValidationMessage('email_1_2_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_1_3) && req.body.email_1_3) {
    req.assert('email_1_3', tools.getValidationMessage('email_1_3', message_valid_format, null, null)).isNull();
  }
  req.assert('email_1_3', tools.getValidationMessage('email_1_3', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_1_3_tag', tools.getValidationMessage('email_1_3_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.fax_1_1) && req.body.fax_1_1) {
    req.assert('fax_1_1', tools.getValidationMessage('fax_1_1', message_valid_format, null, null)).isNull();
  }
  req.assert('fax_1_1', tools.getValidationMessage('fax_1_1', message_valid_length, 0, 30)).len(0, 30);
  req.assert('fax_1_1_tag', tools.getValidationMessage('fax_1_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.fax_1_2) && req.body.fax_1_2) {
    req.assert('fax_1_2', tools.getValidationMessage('fax_1_2', message_valid_format, null, null)).isNull();
  }
  req.assert('fax_1_2', tools.getValidationMessage('fax_1_2', message_valid_length, 0, 30)).len(0, 30);
  req.assert('fax_1_2_tag', tools.getValidationMessage('fax_1_2_tag', message_valid_length, 0, 100)).len(0, 100);
  req.assert('address_tag_2', tools.getValidationMessage('address_tag_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('address_street_2', tools.getValidationMessage('address_street_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('address_city_2', tools.getValidationMessage('address_city_2', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateZip(req.body.address_zip_2) && req.body.address_zip_2) {
    req.assert('address_zip_2', tools.getValidationMessage('address_zip_2', message_valid_format, null, null)).isNull();
  }
  req.assert('address_zip_2', tools.getValidationMessage('address_zip_2', message_valid_length, 0, 20)).len(0, 20);
  req.assert('address_region_2', tools.getValidationMessage('address_region_2', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_2_1) && req.body.phone_2_1) {
    req.assert('phone_2_1', tools.getValidationMessage('phone_2_1', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_2_1', tools.getValidationMessage('phone_2_1', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_2_1_tag', tools.getValidationMessage('phone_2_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_2_2) && req.body.phone_2_2) {
    req.assert('phone_2_2', tools.getValidationMessage('phone_2_2', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_2_2', tools.getValidationMessage('phone_2_2', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_2_2_tag', tools.getValidationMessage('phone_2_2_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_2_3) && req.body.phone_2_3) {
    req.assert('phone_2_3', tools.getValidationMessage('phone_2_3', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_2_3', tools.getValidationMessage('phone_2_3', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_2_3_tag', tools.getValidationMessage('phone_2_3_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_2_1) && req.body.email_2_1) {
    req.assert('email_2_1', tools.getValidationMessage('email_2_1', message_valid_format, null, null)).isNull();
  }
  req.assert('email_2_1', tools.getValidationMessage('email_2_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_2_1_tag', tools.getValidationMessage('email_2_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_2_2) && req.body.email_2_2) {
    req.assert('email_2_2', tools.getValidationMessage('email_2_2', message_valid_format, null, null)).isNull();
  }
  req.assert('email_2_2', tools.getValidationMessage('email_2_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_2_2_tag', tools.getValidationMessage('email_2_2_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_2_3) && req.body.email_2_3) {
    req.assert('email_2_3', tools.getValidationMessage('email_2_3', message_valid_format, null, null)).isNull();
  }
  req.assert('email_2_3', tools.getValidationMessage('email_2_3', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_2_3_tag', tools.getValidationMessage('email_2_3_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.fax_2_1) && req.body.fax_2_1) {
    req.assert('fax_2_1', tools.getValidationMessage('fax_2_1', message_valid_format, null, null)).isNull();
  }
  req.assert('fax_2_1', tools.getValidationMessage('fax_2_1', message_valid_length, 0, 30)).len(0, 30);
  req.assert('fax_2_1_tag', tools.getValidationMessage('fax_2_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.fax_2_2) && req.body.fax_2_2) {
    req.assert('fax_2_2', tools.getValidationMessage('fax_2_2', message_valid_format, null, null)).isNull();
  }
  req.assert('fax_2_2', tools.getValidationMessage('fax_2_2', message_valid_length, 0, 30)).len(0, 30);
  req.assert('fax_2_2_tag', tools.getValidationMessage('fax_2_2_tag', message_valid_length, 0, 100)).len(0, 100);
  req.assert('address_tag_3', tools.getValidationMessage('address_tag_3', message_valid_length, 0, 100)).len(0, 100);
  req.assert('address_street_3', tools.getValidationMessage('address_street_3', message_valid_length, 0, 100)).len(0, 100);
  req.assert('address_city_3', tools.getValidationMessage('address_city_3', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateZip(req.body.address_zip_3) && req.body.address_zip_3) {
    req.assert('address_zip_3', tools.getValidationMessage('address_zip_3', message_valid_format, null, null)).isNull();
  }
  req.assert('address_zip_3', tools.getValidationMessage('address_zip_3', message_valid_length, 0, 20)).len(0, 20);
  req.assert('address_region_3', tools.getValidationMessage('address_region_3', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_3_1) && req.body.phone_3_1) {
    req.assert('phone_3_1', tools.getValidationMessage('phone_3_1', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_3_1', tools.getValidationMessage('phone_3_1', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_3_1_tag', tools.getValidationMessage('phone_3_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_3_2) && req.body.phone_3_2) {
    req.assert('phone_3_2', tools.getValidationMessage('phone_3_2', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_3_2', tools.getValidationMessage('phone_3_2', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_3_2_tag', tools.getValidationMessage('phone_3_2_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_3_3) && req.body.phone_3_3) {
    req.assert('phone_3_3', tools.getValidationMessage('phone_3_3', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_3_3', tools.getValidationMessage('phone_3_3', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_3_3_tag', tools.getValidationMessage('phone_3_3_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_3_1) && req.body.email_3_1) {
    req.assert('email_3_1', tools.getValidationMessage('email_3_1', message_valid_format, null, null)).isNull();
  }
  req.assert('email_3_1', tools.getValidationMessage('email_3_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_3_1_tag', tools.getValidationMessage('email_3_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_3_2) && req.body.email_3_2) {
    req.assert('email_3_2', tools.getValidationMessage('email_3_2', message_valid_format, null, null)).isNull();
  }
  req.assert('email_3_2', tools.getValidationMessage('email_3_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_3_2_tag', tools.getValidationMessage('email_3_2_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_3_3) && req.body.email_3_3) {
    req.assert('email_3_3', tools.getValidationMessage('email_3_3', message_valid_format, null, null)).isNull();
  }
  req.assert('email_3_3', tools.getValidationMessage('email_3_3', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_3_3_tag', tools.getValidationMessage('email_3_3_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.fax_3_1) && req.body.fax_3_1) {
    req.assert('fax_3_1', tools.getValidationMessage('fax_3_1', message_valid_format, null, null)).isNull();
  }
  req.assert('fax_3_1', tools.getValidationMessage('fax_3_1', message_valid_length, 0, 30)).len(0, 30);
  req.assert('fax_3_1_tag', tools.getValidationMessage('fax_3_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.fax_3_2) && req.body.fax_3_2) {
    req.assert('fax_3_2', tools.getValidationMessage('fax_3_2', message_valid_format, null, null)).isNull();
  }
  req.assert('fax_3_2', tools.getValidationMessage('fax_3_2', message_valid_length, 0, 30)).len(0, 30);
  req.assert('fax_3_2_tag', tools.getValidationMessage('fax_3_2_tag', message_valid_length, 0, 100)).len(0, 100);
  req.assert('website_1', tools.getValidationMessage('website_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('website_2', tools.getValidationMessage('website_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('website_3', tools.getValidationMessage('website_3', message_valid_length, 0, 100)).len(0, 100);

  req.assert('facebook_1', tools.getValidationMessage('facebook_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('facebook_2', tools.getValidationMessage('facebook_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('facebook_3', tools.getValidationMessage('facebook_3', message_valid_length, 0, 100)).len(0, 100);
  req.assert('google_1', tools.getValidationMessage('google_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('google_2', tools.getValidationMessage('google_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('google_3', tools.getValidationMessage('google_3', message_valid_length, 0, 100)).len(0, 100);
  req.assert('twitter_1', tools.getValidationMessage('twitter_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('twitter_2', tools.getValidationMessage('twitter_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('twitter_3', tools.getValidationMessage('twitter_3', message_valid_length, 0, 100)).len(0, 100);

  if (req.body.category) {
    req.assert('category', tools.getValidationMessage('category', message_valid_number, null, null)).isInt();
  }
  if (req.body.subcategory) {
    req.assert('subcategory', tools.getValidationMessage('subcategory', message_valid_number, null, null)).isInt();
  }
  if (req.body.address_country_1) {
    req.assert('address_country_1', tools.getValidationMessage('address_country_1', message_valid_number, null, null)).isInt();
  }
  if (req.body.address_country_2) {
    req.assert('address_country_2', tools.getValidationMessage('address_country_2', message_valid_number, null, null)).isInt();
  }
  if (req.body.address_country_3) {
    req.assert('address_country_3', tools.getValidationMessage('address_country_3', message_valid_number, null, null)).isInt();
  }

  errors = req.validationErrors();
  if (errors) {
    res.json(errors);
    return null;
  }
  tools.setNullForEmpty(req.body);

  sqlSeq = req.body.id ? 'SELECT null AS id' : 'SELECT nextval(\'seq_companies_id\') AS id';

  sql =
    'INSERT INTO COMPANIES ' +
    '  (id, reg_id, vat_id, company_name, company_group, address_tag_1, address_street_1, address_city_1, address_zip_1, address_region_1, ' +
    '  phone_1_1, phone_1_1_tag, phone_1_2, phone_1_2_tag, phone_1_3, phone_1_3_tag, email_1_1, email_1_1_tag, email_1_2, email_1_2_tag, ' +
    '  email_1_3, email_1_3_tag, fax_1_1, fax_1_1_tag, fax_1_2, fax_1_2_tag, address_tag_2, address_street_2, address_city_2, address_zip_2, ' +
    '  address_region_2, phone_2_1, phone_2_1_tag, phone_2_2, phone_2_2_tag, phone_2_3, phone_2_3_tag, email_2_1, email_2_1_tag, email_2_2, ' +
    '  email_2_2_tag, email_2_3, email_2_3_tag, fax_2_1, fax_2_1_tag, fax_2_2, fax_2_2_tag, address_tag_3, address_street_3, address_city_3, ' +
    '  address_zip_3, address_region_3, phone_3_1, phone_3_1_tag, phone_3_2, phone_3_2_tag, phone_3_3, phone_3_3_tag, email_3_1, email_3_1_tag, ' +
    '  email_3_2, email_3_2_tag, email_3_3, email_3_3_tag, fax_3_1, fax_3_1_tag, fax_3_2, fax_3_2_tag, website_1, website_2, ' +
    '  website_3, facebook_1, google_1, twitter_1, category, subcategory, address_country_1, address_country_2, address_country_3, facebook_2, ' +
    '  google_2, twitter_2, facebook_3, google_3, twitter_3, rating) ' +
    'VALUES($1, $2, $3, $4, $5, $6, $7, $8, $9, $10,' +
    '  $11, $12, $13, $14, $15, $16, $17, $18, $19, $20,' +
    '  $21, $22, $23, $24, $25, $26, $27, $28, $29, $30,' +
    '  $31, $32, $33, $34, $35, $36, $37, $38, $39, $40,' +
    '  $41, $42, $43, $44, $45, $46, $47, $48, $49, $50,' +
    '  $51, $52, $53, $54, $55, $56, $57, $58, $59, $60,' +
    '  $61, $62, $63, $64, $65, $66, $67, $68, $69, $70,' +
    '  $71, $72, $73, $74, $75, $76, $77, $78, $79, $80,' +
    '  $81, $82, $83, $84, $85, $86)';

  try {
    vals = [null, req.body.reg_id, req.body.vat_id, req.body.company_name, req.body.company_group, req.body.address_tag_1, req.body.address_street_1, req.body.address_city_1, req.body.address_zip_1, req.body.address_region_1,
      req.body.phone_1_1, req.body.phone_1_1_tag, req.body.phone_1_2, req.body.phone_1_2_tag, req.body.phone_1_3, req.body.phone_1_3_tag, req.body.email_1_1, req.body.email_1_1_tag, req.body.email_1_2, req.body.email_1_2_tag,
      req.body.email_1_3, req.body.email_1_3_tag, req.body.fax_1_1, req.body.fax_1_1_tag, req.body.fax_1_2, req.body.fax_1_2_tag, req.body.address_tag_2, req.body.address_street_2, req.body.address_city_2, req.body.address_zip_2,
      req.body.address_region_2, req.body.phone_2_1, req.body.phone_2_1_tag, req.body.phone_2_2, req.body.phone_2_2_tag, req.body.phone_2_3, req.body.phone_2_3_tag, req.body.email_2_1, req.body.email_2_1_tag, req.body.email_2_2, req.body.email_2_2_tag,
      req.body.email_2_3, req.body.email_2_3_tag, req.body.fax_2_1, req.body.fax_2_1_tag, req.body.fax_2_2, req.body.fax_2_2_tag, req.body.address_tag_3, req.body.address_street_3, req.body.address_city_3, req.body.address_zip_3,
      req.body.address_region_3, req.body.phone_3_1, req.body.phone_3_1_tag, req.body.phone_3_2, req.body.phone_3_2_tag, req.body.phone_3_3, req.body.phone_3_3_tag, req.body.email_3_1, req.body.email_3_1_tag, req.body.email_3_2,
      req.body.email_3_2_tag, req.body.email_3_3, req.body.email_3_3_tag, req.body.fax_3_1, req.body.fax_3_1_tag, req.body.fax_3_2, req.body.fax_3_2_tag, req.body.website_1, req.body.website_2, req.body.website_3,
      req.body.facebook_1, req.body.google_1, req.body.twitter_1, req.body.category, req.body.subcategory, req.body.address_country_1, req.body.address_country_2, req.body.address_country_3, req.body.facebook_2,
      req.body.google_2, req.body.twitter_2, req.body.facebook_3, req.body.google_3, req.body.twitter_3, req.body.rating];

    return postgres.select(sqlSeq, [], req).then(
      function (result) {
        vals[0] = tools.getSingleResult(result).id || req.body.id;
        return postgres.executeSQL(req, res, sql, vals);
      },
      function (result) {
        tools.sendResponseError(result, res, noCloseReq);
      }
    ).then(
      function () {
        return tools.sendResponseSuccess({id: vals[0]}, res, noCloseReq);
      },
      function (result) {
        tools.sendResponseError(result, res, noCloseReq);
      }
    );
  } catch (e) {
    tools.sendResponseError(e, res, noCloseReq);
  }
};

/**
 * @memberof __Server_REST_API_Companies
 * @method
 * @name put
 * @description put company to DB
 * @param req {Object} request reference object
 * @param res {Object} response reference object
 * @returns void
 */
exports.put = function (req, res) {
  var vals, sql, errors,
    message_valid_length = constants.MESSAGE_VALIDATION_LENGTH,
    message_valid_format = constants.MESSAGE_VALIDATION_FORMAT,
    message_valid_number = constants.MESSAGE_VALIDATION_NUMBER;
  // validations
  req.assert('id', 'ID row not found.').notEmpty();
  req.assert('id', 'ID must be integer').isInt();
  req.assert('reg_id', tools.getValidationMessage('reg_id', message_valid_length, 0, 20)).len(0, 20);
  req.assert('vat_id', tools.getValidationMessage('vat_id', message_valid_length, 0, 20)).len(0, 20);
  req.assert('company_name', tools.getValidationMessage('company_name', message_valid_length, 0, 255)).len(0, 255);
  if (req.body.company_group) {
    req.assert('company_group', tools.getValidationMessage('company_group', message_valid_number, null, null)).isInt();
  }
  req.assert('address_tag_1', tools.getValidationMessage('address_tag_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('address_street_1', tools.getValidationMessage('address_street_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('address_city_1', tools.getValidationMessage('address_city_1', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateZip(req.body.address_zip_1) && req.body.address_zip_1) {
    req.assert('address_zip_1', tools.getValidationMessage('address_zip_1', message_valid_format, null, null)).isNull();
  }
  req.assert('address_zip_1', tools.getValidationMessage('address_zip_1', message_valid_length, 0, 20)).len(0, 20);
  req.assert('address_region_1', tools.getValidationMessage('address_region_1', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_1_1) && req.body.phone_1_1) {
    req.assert('phone_1_1', tools.getValidationMessage('phone_1_1', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_1_1', tools.getValidationMessage('phone_1_1', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_1_1_tag', tools.getValidationMessage('phone_1_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_1_2) && req.body.phone_1_2) {
    req.assert('phone_1_2', tools.getValidationMessage('phone_1_2', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_1_2', tools.getValidationMessage('phone_1_2', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_1_2_tag', tools.getValidationMessage('phone_1_2_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_1_3) && req.body.phone_1_3) {
    req.assert('phone_1_3', tools.getValidationMessage('phone_1_3', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_1_3', tools.getValidationMessage('phone_1_3', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_1_3_tag', tools.getValidationMessage('phone_1_3_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_1_1) && req.body.email_1_1) {
    req.assert('email_1_1', tools.getValidationMessage('email_1_1', message_valid_format, null, null)).isNull();
  }
  req.assert('email_1_1', tools.getValidationMessage('email_1_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_1_1_tag', tools.getValidationMessage('email_1_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_1_2) && req.body.email_1_2) {
    req.assert('email_1_2', tools.getValidationMessage('email_1_2', message_valid_format, null, null)).isNull();
  }
  req.assert('email_1_2', tools.getValidationMessage('email_1_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_1_2_tag', tools.getValidationMessage('email_1_2_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_1_3) && req.body.email_1_3) {
    req.assert('email_1_3', tools.getValidationMessage('email_1_3', message_valid_format, null, null)).isNull();
  }
  req.assert('email_1_3', tools.getValidationMessage('email_1_3', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_1_3_tag', tools.getValidationMessage('email_1_3_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.fax_1_1) && req.body.fax_1_1) {
    req.assert('fax_1_1', tools.getValidationMessage('fax_1_1', message_valid_format, null, null)).isNull();
  }
  req.assert('fax_1_1', tools.getValidationMessage('fax_1_1', message_valid_length, 0, 30)).len(0, 30);
  req.assert('fax_1_1_tag', tools.getValidationMessage('fax_1_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.fax_1_2) && req.body.fax_1_2) {
    req.assert('fax_1_2', tools.getValidationMessage('fax_1_2', message_valid_format, null, null)).isNull();
  }
  req.assert('fax_1_2', tools.getValidationMessage('fax_1_2', message_valid_length, 0, 30)).len(0, 30);
  req.assert('fax_1_2_tag', tools.getValidationMessage('fax_1_2_tag', message_valid_length, 0, 100)).len(0, 100);
  req.assert('address_tag_2', tools.getValidationMessage('address_tag_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('address_street_2', tools.getValidationMessage('address_street_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('address_city_2', tools.getValidationMessage('address_city_2', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateZip(req.body.address_zip_2) && req.body.address_zip_2) {
    req.assert('address_zip_2', tools.getValidationMessage('address_zip_2', message_valid_format, null, null)).isNull();
  }
  req.assert('address_zip_2', tools.getValidationMessage('address_zip_2', message_valid_length, 0, 20)).len(0, 20);
  req.assert('address_region_2', tools.getValidationMessage('address_region_2', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_2_1) && req.body.phone_2_1) {
    req.assert('phone_2_1', tools.getValidationMessage('phone_2_1', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_2_1', tools.getValidationMessage('phone_2_1', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_2_1_tag', tools.getValidationMessage('phone_2_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_2_2) && req.body.phone_2_2) {
    req.assert('phone_2_2', tools.getValidationMessage('phone_2_2', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_2_2', tools.getValidationMessage('phone_2_2', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_2_2_tag', tools.getValidationMessage('phone_2_2_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_2_3) && req.body.phone_2_3) {
    req.assert('phone_2_3', tools.getValidationMessage('phone_2_3', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_2_3', tools.getValidationMessage('phone_2_3', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_2_3_tag', tools.getValidationMessage('phone_2_3_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_2_1) && req.body.email_2_1) {
    req.assert('email_2_1', tools.getValidationMessage('email_2_1', message_valid_format, null, null)).isNull();
  }
  req.assert('email_2_1', tools.getValidationMessage('email_2_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_2_1_tag', tools.getValidationMessage('email_2_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_2_2) && req.body.email_2_2) {
    req.assert('email_2_2', tools.getValidationMessage('email_2_2', message_valid_format, null, null)).isNull();
  }
  req.assert('email_2_2', tools.getValidationMessage('email_2_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_2_2_tag', tools.getValidationMessage('email_2_2_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_2_3) && req.body.email_2_3) {
    req.assert('email_2_3', tools.getValidationMessage('email_2_3', message_valid_format, null, null)).isNull();
  }
  req.assert('email_2_3', tools.getValidationMessage('email_2_3', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_2_3_tag', tools.getValidationMessage('email_2_3_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.fax_2_1) && req.body.fax_2_1) {
    req.assert('fax_2_1', tools.getValidationMessage('fax_2_1', message_valid_format, null, null)).isNull();
  }
  req.assert('fax_2_1', tools.getValidationMessage('fax_2_1', message_valid_length, 0, 30)).len(0, 30);
  req.assert('fax_2_1_tag', tools.getValidationMessage('fax_2_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.fax_2_2) && req.body.fax_2_2) {
    req.assert('fax_2_2', tools.getValidationMessage('fax_2_2', message_valid_format, null, null)).isNull();
  }
  req.assert('fax_2_2', tools.getValidationMessage('fax_2_2', message_valid_length, 0, 30)).len(0, 30);
  req.assert('fax_2_2_tag', tools.getValidationMessage('fax_2_2_tag', message_valid_length, 0, 100)).len(0, 100);
  req.assert('address_tag_3', tools.getValidationMessage('address_tag_3', message_valid_length, 0, 100)).len(0, 100);
  req.assert('address_street_3', tools.getValidationMessage('address_street_3', message_valid_length, 0, 100)).len(0, 100);
  req.assert('address_city_3', tools.getValidationMessage('address_city_3', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateZip(req.body.address_zip_3) && req.body.address_zip_3) {
    req.assert('address_zip_3', tools.getValidationMessage('address_zip_3', message_valid_format, null, null)).isNull();
  }
  req.assert('address_zip_3', tools.getValidationMessage('address_zip_3', message_valid_length, 0, 20)).len(0, 20);
  req.assert('address_region_3', tools.getValidationMessage('address_region_3', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_3_1) && req.body.phone_3_1) {
    req.assert('phone_3_1', tools.getValidationMessage('phone_3_1', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_3_1', tools.getValidationMessage('phone_3_1', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_3_1_tag', tools.getValidationMessage('phone_3_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_3_2) && req.body.phone_3_2) {
    req.assert('phone_3_2', tools.getValidationMessage('phone_3_2', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_3_2', tools.getValidationMessage('phone_3_2', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_3_2_tag', tools.getValidationMessage('phone_3_2_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.phone_3_3) && req.body.phone_3_3) {
    req.assert('phone_3_3', tools.getValidationMessage('phone_3_3', message_valid_format, null, null)).isNull();
  }
  req.assert('phone_3_3', tools.getValidationMessage('phone_3_3', message_valid_length, 0, 30)).len(0, 30);
  req.assert('phone_3_3_tag', tools.getValidationMessage('phone_3_3_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_3_1) && req.body.email_3_1) {
    req.assert('email_3_1', tools.getValidationMessage('email_3_1', message_valid_format, null, null)).isNull();
  }
  req.assert('email_3_1', tools.getValidationMessage('email_3_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_3_1_tag', tools.getValidationMessage('email_3_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_3_2) && req.body.email_3_2) {
    req.assert('email_3_2', tools.getValidationMessage('email_3_2', message_valid_format, null, null)).isNull();
  }
  req.assert('email_3_2', tools.getValidationMessage('email_3_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_3_2_tag', tools.getValidationMessage('email_3_2_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validateEmail(req.body.email_3_3) && req.body.email_3_3) {
    req.assert('email_3_3', tools.getValidationMessage('email_3_3', message_valid_format, null, null)).isNull();
  }
  req.assert('email_3_3', tools.getValidationMessage('email_3_3', message_valid_length, 0, 100)).len(0, 100);
  req.assert('email_3_3_tag', tools.getValidationMessage('email_3_3_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.fax_3_1) && req.body.fax_3_1) {
    req.assert('fax_3_1', tools.getValidationMessage('fax_3_1', message_valid_format, null, null)).isNull();
  }
  req.assert('fax_3_1', tools.getValidationMessage('fax_3_1', message_valid_length, 0, 30)).len(0, 30);
  req.assert('fax_3_1_tag', tools.getValidationMessage('fax_3_1_tag', message_valid_length, 0, 100)).len(0, 100);
  if (!tools.validatePhone(req.body.fax_3_2) && req.body.fax_3_2) {
    req.assert('fax_3_2', tools.getValidationMessage('fax_3_2', message_valid_format, null, null)).isNull();
  }
  req.assert('fax_3_2', tools.getValidationMessage('fax_3_2', message_valid_length, 0, 30)).len(0, 30);
  req.assert('fax_3_2_tag', tools.getValidationMessage('fax_3_2_tag', message_valid_length, 0, 100)).len(0, 100);
  req.assert('website_1', tools.getValidationMessage('website_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('website_2', tools.getValidationMessage('website_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('website_3', tools.getValidationMessage('website_3', message_valid_length, 0, 100)).len(0, 100);

  req.assert('facebook_1', tools.getValidationMessage('facebook_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('facebook_2', tools.getValidationMessage('facebook_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('facebook_3', tools.getValidationMessage('facebook_3', message_valid_length, 0, 100)).len(0, 100);
  req.assert('google_1', tools.getValidationMessage('google_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('google_2', tools.getValidationMessage('google_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('google_3', tools.getValidationMessage('google_3', message_valid_length, 0, 100)).len(0, 100);
  req.assert('twitter_1', tools.getValidationMessage('twitter_1', message_valid_length, 0, 100)).len(0, 100);
  req.assert('twitter_2', tools.getValidationMessage('twitter_2', message_valid_length, 0, 100)).len(0, 100);
  req.assert('twitter_3', tools.getValidationMessage('twitter_3', message_valid_length, 0, 100)).len(0, 100);

  if (req.body.category) {
    req.assert('category', tools.getValidationMessage('category', message_valid_number, null, null)).isInt();
  }
  if (req.body.subcategory) {
    req.assert('subcategory', tools.getValidationMessage('subcategory', message_valid_number, null, null)).isInt();
  }
  if (req.body.address_country_1) {
    req.assert('address_country_1', tools.getValidationMessage('address_country_1', message_valid_number, null, null)).isInt();
  }
  if (req.body.address_country_2) {
    req.assert('address_country_2', tools.getValidationMessage('address_country_2', message_valid_number, null, null)).isInt();
  }
  if (req.body.address_country_3) {
    req.assert('address_country_3', tools.getValidationMessage('address_country_3', message_valid_number, null, null)).isInt();
  }

  errors = req.validationErrors();
  if (errors) {
    res.json(errors);
    return;
  }

  tools.setNullForEmpty(req.body);
  sql =
    'UPDATE COMPANIES SET ' +
//      '  id = $1 ' +
    '  reg_id = $2, vat_id = $3, company_name = $4, company_group = $5, address_tag_1 = $6, address_street_1 = $7, address_city_1 = $8, address_zip_1 = $9, address_region_1 = $10, ' +
    '  phone_1_1 = $11, phone_1_1_tag = $12, phone_1_2 = $13, phone_1_2_tag = $14, phone_1_3 = $15, phone_1_3_tag = $16, email_1_1 = $17, email_1_1_tag = $18, email_1_2 = $19, email_1_2_tag = $20, ' +
    '  email_1_3 = $21, email_1_3_tag = $22, fax_1_1 = $23, fax_1_1_tag = $24, fax_1_2 = $25, fax_1_2_tag = $26, address_tag_2 = $27, address_street_2 = $28, address_city_2 = $29, address_zip_2 = $30, ' +
    '  address_region_2 = $31, phone_2_1 = $32, phone_2_1_tag = $33, phone_2_2 = $34, phone_2_2_tag = $35, phone_2_3 = $36, phone_2_3_tag = $37, email_2_1 = $38, email_2_1_tag = $39, email_2_2 = $40, ' +
    '  email_2_2_tag = $41, email_2_3 = $42, email_2_3_tag = $43, fax_2_1 = $44, fax_2_1_tag = $45, fax_2_2 = $46, fax_2_2_tag = $47, address_tag_3 = $48, address_street_3 = $49, address_city_3 = $50, ' +
    '  address_zip_3 = $51, address_region_3 = $52, phone_3_1 = $53, phone_3_1_tag = $54, phone_3_2 = $55, phone_3_2_tag = $56, phone_3_3 = $57, phone_3_3_tag = $58, email_3_1 = $59, email_3_1_tag = $60, ' +
    '  email_3_2 = $61, email_3_2_tag = $62, email_3_3 = $63, email_3_3_tag = $64, fax_3_1 = $65, fax_3_1_tag = $66, fax_3_2 = $67, fax_3_2_tag = $68, website_1 = $69, website_2 = $70, ' +
    '  website_3 = $71, facebook_1 = $72, google_1 = $73, twitter_1 = $74, category = $75, subcategory = $76, address_country_1 = $77, address_country_2 = $78, address_country_3 = $79, facebook_2 = $80, ' +
    '  google_2 = $81, twitter_2 = $82, facebook_3 = $83, google_3 = $84, twitter_3 = $85, rating = $86 ' +
    'WHERE ID = $1';

  try {
    vals = [req.body.id, req.body.reg_id, req.body.vat_id, req.body.company_name, req.body.company_group, req.body.address_tag_1, req.body.address_street_1, req.body.address_city_1, req.body.address_zip_1, req.body.address_region_1,
      req.body.phone_1_1, req.body.phone_1_1_tag, req.body.phone_1_2, req.body.phone_1_2_tag, req.body.phone_1_3, req.body.phone_1_3_tag, req.body.email_1_1, req.body.email_1_1_tag, req.body.email_1_2, req.body.email_1_2_tag,
      req.body.email_1_3, req.body.email_1_3_tag, req.body.fax_1_1, req.body.fax_1_1_tag, req.body.fax_1_2, req.body.fax_1_2_tag, req.body.address_tag_2, req.body.address_street_2, req.body.address_city_2, req.body.address_zip_2,
      req.body.address_region_2, req.body.phone_2_1, req.body.phone_2_1_tag, req.body.phone_2_2, req.body.phone_2_2_tag, req.body.phone_2_3, req.body.phone_2_3_tag, req.body.email_2_1, req.body.email_2_1_tag, req.body.email_2_2, req.body.email_2_2_tag,
      req.body.email_2_3, req.body.email_2_3_tag, req.body.fax_2_1, req.body.fax_2_1_tag, req.body.fax_2_2, req.body.fax_2_2_tag, req.body.address_tag_3, req.body.address_street_3, req.body.address_city_3, req.body.address_zip_3,
      req.body.address_region_3, req.body.phone_3_1, req.body.phone_3_1_tag, req.body.phone_3_2, req.body.phone_3_2_tag, req.body.phone_3_3, req.body.phone_3_3_tag, req.body.email_3_1, req.body.email_3_1_tag, req.body.email_3_2,
      req.body.email_3_2_tag, req.body.email_3_3, req.body.email_3_3_tag, req.body.fax_3_1, req.body.fax_3_1_tag, req.body.fax_3_2, req.body.fax_3_2_tag, req.body.website_1, req.body.website_2, req.body.website_3,
      req.body.facebook_1, req.body.google_1, req.body.twitter_1, req.body.category, req.body.subcategory, req.body.address_country_1, req.body.address_country_2, req.body.address_country_3, req.body.facebook_2,
      req.body.google_2, req.body.twitter_2, req.body.facebook_3, req.body.google_3, req.body.twitter_3, req.body.rating];

    postgres.executeSQL(req, res, sql, vals).then(
      function (result) {
        res.json(constants.OK);
      },
      function (result) {
        tools.sendResponseError(result, res, false);
      }
    );
  } catch (e) {
    tools.sendResponseError(e, res, false);
  }
};

/**
 * @memberof __Server_REST_API_Companies
 * @method
 * @name delete
 * @description delete company from DB
 * @param req {Object} request reference object
 * @param res {Object} response reference object
 * @returns void
 */
exports.delete = function (req, res) {
  var sql2 = 'DELETE FROM COMPANIES WHERE id = $1',
    sql = 'DELETE FROM PEOPLE_COMPANIES WHERE COMPANIES_ID = $1',
    errors;
  req.assert('id', 'ID row not found.').notEmpty();

  errors = req.validationErrors();
  if (errors) {
    res.json(errors);
    return;
  }

  try {
    postgres.executeSQL(req, res, sql, [req.params.id]).then(
      function () {
        return postgres.executeSQL(req, res, sql2, [req.params.id]);
      },
      function (result) {
        tools.sendResponseError(result, res, false);
      }
    ).then(
      function () {
        tools.sendResponseSuccess(constants.OK, res, false);
      },
      function (result) {
        tools.sendResponseError(result, res, false);
      }
    );
  } catch (e) {
    tools.sendResponseError(e, res, false);
  }
};

/**
 * @memberof __Server_REST_API_Companies
 * @method
 * @name exists
 * @description search ID company according to name
 * @param req {Object} request reference object
 * @param res {Object} response reference object
 * @returns Promise
 */
exports.exists = function (req, res) {
  var sql, newObj;
  sql = 'SELECT ID FROM COMPANIES WHERE COMPANY_NAME = $1';
  return postgres.select(sql, [req.body.company_name], req).then(
    function (result) {
      newObj = tools.getSingleResult(result);
      return {exists: newObj.id > 0, id: newObj.id};
    },
    function () {
      return {};
    }
  );
};

/**
 * @memberof __Server_REST_API_Companies
 * @method
 * @name search
 * @description search all companies for angucomplete
 * @param req {Object} request reference object
 * @param res {Object} response reference object
 * @returns Promise
 */
exports.search = function (req, res) {
  var sql1, sql2, sql3, sql4, sql5, sql6, sql,
    limit = req.query.limit || 10,
    offset = req.query.offset || 0;

// STRING LEFT SIDE, ACCENTS, CASE SENSITIVE
  sql1 =
    'SELECT ' +
    '  id, company_name as name, 1 AS type ' +
    'FROM ' +
    '  companies ' +
    'WHERE ' +
    '  company_name LIKE $1::varchar || \'%\' ' +
    'ORDER BY ' +
    '  id ';

  // STRING INNER, ACCENTS, CASE SENSITIVE
  sql2 =
    'SELECT ' +
    '  id, company_name as name, 2 AS type ' +
    'FROM ' +
    '  companies ' +
    'WHERE ' +
    '  company_name LIKE \'%\' || $1::varchar || \'%\' ' +
    'ORDER BY ' +
    '  id ';

  // LEFT SIDE WITHOUT ACCENTS, CASE INSENSITIVE
  sql3 =
    'SELECT ' +
    '  id, company_name as name, 3 AS type ' +
    'FROM ' +
    '  companies ' +
    'WHERE ' +
    '  to_ascii(convert_to(UPPER(COMPANY_NAME), \'latin2\'),\'latin2\') LIKE to_ascii(convert_to(UPPER($1::varchar), \'latin2\'),\'latin2\') || \'%\' ' +
    'ORDER BY ' +
    '  id ';

  // STRING INNER, WITHOUT ACCENTS, CASE INSENSITIVE
  sql4 =
    'SELECT ' +
    '  id, company_name as name, 4 AS type ' +
    'FROM ' +
    '  companies ' +
    'WHERE ' +
    '  to_ascii(convert_to(UPPER(COMPANY_NAME), \'latin2\'),\'latin2\') LIKE \'%\' || to_ascii(convert_to(UPPER($1::varchar), \'latin2\'),\'latin2\') || \'%\' ' +
    'ORDER BY ' +
    '  id ';

  // STRING LEFT SIDE WITHOUT SPACE, WITHOUT ACCENTS, CASE INSENSITIVE
  sql5 =
    'SELECT ' +
    '  id, company_name as name, 5 AS type ' +
    'FROM ' +
    '  companies ' +
    'WHERE ' +
    '  to_ascii(convert_to(UPPER(REPLACE(COMPANY_NAME, \' \', \'\')), \'latin2\'),\'latin2\') LIKE to_ascii(convert_to(UPPER($1::varchar), \'latin2\'),\'latin2\') || \'%\' ' +
    'ORDER BY ' +
    '  id ';

  // STRING INNER WITHOUT SPACE, WITHOUT ACCENTS, CASE INSENSITIVE
  sql6 =
    'SELECT ' +
    '  id, company_name as name, 6 AS type ' +
    'FROM ' +
    '  companies ' +
    'WHERE ' +
    '  to_ascii(convert_to(UPPER(REPLACE(COMPANY_NAME, \' \', \'\')), \'latin2\'),\'latin2\') LIKE \'%\' || to_ascii(convert_to(UPPER($1::varchar), \'latin2\'),\'latin2\') || \'%\' ' +
    'ORDER BY ' +
    '  id ';

  sql =
    'SELECT ' +
    '  ID, NAME, MIN(TYPE) AS TYPE ' +
    'FROM ' +
    '  ( ' +
    '     (' + sql1 + ')' +
    '   UNION ' +
    '     (' + sql2 + ')' +
    '   UNION ' +
    '     (' + sql3 + ')' +
    '   UNION ' +
    '     (' + sql4 + ')' +
    '   UNION ' +
    '     (' + sql5 + ')' +
    '   UNION ' +
    '     (' + sql6 + ')' +
    '  ) S1 ' +
    'GROUP BY ' +
    '  ID, NAME ' +
    'ORDER BY ' +
    '  TYPE, ID ' +
    'LIMIT $3::int ' +
    'OFFSET $2::int ';

  try {
    return postgres.select(sql, [req.params.search, parseInt(offset, 10), parseInt(limit, 10)], req).then(
      function (result) {
        res.json(tools.getMultiResult(result));
      },
      function (result) {
        tools.sendResponseError(result, res, false);
      }
    );
  } catch (e) {
    tools.sendResponseError(e, res, false);
  }
};

/**
 * @memberof __Server_REST_API_Companies
 * @method
 * @name salesPipeline
 * @description list of sales pipelines for company
 * @param req {Object} request reference object
 * @param res {Object} response reference object
 * @returns void
 */
exports.salesPipeline = function (req, res) {
  try {
    var sql;

    sql =
      'SELECT ' +
      '  sp.id,sp.subject as name ' +
      'FROM ' +
      '  sales_pipeline sp ' +
      'WHERE ' +
      '  sp.company_id = $1 ' +
      'ORDER BY ' +
      '  sp.subject ' +
      'LIMIT 50';

    postgres.select(sql, [req.params.id], req).then(
      function (result) {
        res.json(tools.getMultiResult(result));
      },
      function (result) {
        tools.sendResponseError(result, res, false);
      }
    );
  } catch (e) {
    tools.sendResponseError(e, res, false);
  }
};

/**
 * @memberof __Server_REST_API_Companies
 * @method
 * @name exportExcel
 * @description export
 * @param req {Object} request reference object
 * @param res {Object} response reference object
 * @returns void
 */
exports.exportExcel = function (req, res) {
  try {
    var sql, range, excelContent;

    sql =
      'SELECT ' +
      '  ID as "Id", COMPANY_NAME AS "companyName" ' +
      'FROM ' +
      '  companies ' +
      'WHERE ' +
      '  id in ($1::int) ';

    range = req.body.items ? req.body.items.join(',') : '';
    /*postgres.select(sql, [range], req).then(
      function (result) {*/
        excelContent = exportsFactory.getContent(null);
        res.setHeader('Content-Type', 'application/vnd.openxmlformats');
        res.setHeader("Content-Disposition", "attachment; filename=" + "ReportNotia.xlsx");
        res.end(excelContent, 'binary');
        //res.json(tools.getMultiResult(result));
      /*},
      function (result) {
        tools.sendResponseError(constants.E500, res, false);
      }
    ); */
  } catch (e) {
    tools.sendResponseError(constants.E500, res, false);
  }
};

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Namespaces</h3><ul><li><a href="__Server_Connections.html">__Server_Connections</a></li><li><a href="__Server_Constants.html">__Server_Constants</a></li><li><a href="__Server_Flow.html">__Server_Flow</a></li><li><a href="__Server_Messages.html">__Server_Messages</a></li><li><a href="__Server_MonitorDB.html">__Server_MonitorDB</a></li><li><a href="__Server_PDF.html">__Server_PDF</a></li><li><a href="__Server_PG_API.html">__Server_PG_API</a></li><li><a href="__Server_REST_API.html">__Server_REST_API</a></li><li><a href="__Server_REST_API_Appointment.html">__Server_REST_API_Appointment</a></li><li><a href="__Server_REST_API_Authentication.html">__Server_REST_API_Authentication</a></li><li><a href="__Server_REST_API_Companies.html">__Server_REST_API_Companies</a></li><li><a href="__Server_REST_API_Countries.html">__Server_REST_API_Countries</a></li><li><a href="__Server_REST_API_Logging.html">__Server_REST_API_Logging</a></li><li><a href="__Server_REST_API_People.html">__Server_REST_API_People</a></li><li><a href="__Server_REST_API_People_Companies.html">__Server_REST_API_People_Companies</a></li><li><a href="__Server_REST_API_Positions.html">__Server_REST_API_Positions</a></li><li><a href="__Server_REST_API_Reminders.html">__Server_REST_API_Reminders</a></li><li><a href="__Server_REST_API_Roles.html">__Server_REST_API_Roles</a></li><li><a href="__Server_REST_API_Sales_Pipeline.html">__Server_REST_API_Sales_Pipeline</a></li><li><a href="__Server_REST_API_Sales_Pipeline_Stages.html">__Server_REST_API_Sales_Pipeline_Stages</a></li><li><a href="__Server_REST_API_Tasks.html">__Server_REST_API_Tasks</a></li><li><a href="__Server_REST_API_TimeZones.html">__Server_REST_API_TimeZones</a></li><li><a href="__Server_REST_API_User.html">__Server_REST_API_User</a></li><li><a href="__Server_Socket.html">__Server_Socket</a></li><li><a href="__Server_Tools.html">__Server_Tools</a></li><li><a href="__Server_TOOLS_API_ExportsFactory.html">__Server_TOOLS_API_ExportsFactory</a></li><li><a href="actionButtons.html">actionButtons</a></li><li><a href="AgendaCtrl.html">AgendaCtrl</a></li><li><a href="alerts.html">alerts</a></li><li><a href="alertsModal.html">alertsModal</a></li><li><a href="AlertsService.html">AlertsService</a></li><li><a href="angucomplete.html">angucomplete</a></li><li><a href="AppointmentCtrl.html">AppointmentCtrl</a></li><li><a href="AppointmentService.html">AppointmentService</a></li><li><a href="CalendarCtrl.html">CalendarCtrl</a></li><li><a href="CompaniesCtrl.html">CompaniesCtrl</a></li><li><a href="CompaniesService.html">CompaniesService</a></li><li><a href="CompanyCtrl.html">CompanyCtrl</a></li><li><a href="CountriesService.html">CountriesService</a></li><li><a href="DatepickerFactory.html">DatepickerFactory</a></li><li><a href="datepickerNotia.html">datepickerNotia</a></li><li><a href="DateService.html">DateService</a></li><li><a href="header.html">header</a></li><li><a href="language.html">language</a></li><li><a href="LogData.html">LogData</a></li><li><a href="MainCtrl.html">MainCtrl</a></li><li><a href="MessengerService.html">MessengerService</a></li><li><a href="MetaService.html">MetaService</a></li><li><a href="PageAncestorService.html">PageAncestorService</a></li><li><a href="PeopleCtrl.html">PeopleCtrl</a></li><li><a href="PeopleService.html">PeopleService</a></li><li><a href="PersonCtrl.html">PersonCtrl</a></li><li><a href="pillsNotia.html">pillsNotia</a></li><li><a href="ratingNotia.html">ratingNotia</a></li><li><a href="ReminderCtrl.html">ReminderCtrl</a></li><li><a href="Reminders.html">Reminders</a></li><li><a href="ReminderService.html">ReminderService</a></li><li><a href="SalesPipelineCtrl.html">SalesPipelineCtrl</a></li><li><a href="SalesPipelineService.html">SalesPipelineService</a></li><li><a href="SalesPipelineStagesService.html">SalesPipelineStagesService</a></li><li><a href="SocketFactory.html">SocketFactory</a></li><li><a href="TestCtrl.html">TestCtrl</a></li><li><a href="TimeZonesService.html">TimeZonesService</a></li><li><a href="ToolsService.html">ToolsService</a></li><li><a href="UsersService.html">UsersService</a></li><li><a href="VyvojCtrl.html">VyvojCtrl</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Tue Jan 20 2015 15:55:58 GMT+0100 (CET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>

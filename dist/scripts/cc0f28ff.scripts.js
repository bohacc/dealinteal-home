"use strict";angular.module("crmPostgresWebApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngAnimate","ui.bootstrap.datepicker","ui.bootstrap.buttons","template/datepicker/datepicker.html","template/datepicker/popup.html","template/datepicker/day.html","template/datepicker/month.html","template/datepicker/year.html","ui.calendar","mgcrea.ngStrap.timepicker","mgcrea.ngStrap.popover","pascalprecht.translate","tmh.dynamicLocale","btford.socket-io","angularSpinner","ngFileUpload","chart.js","textAngular"]).config(["$routeProvider","$translateProvider","tmhDynamicLocaleProvider","$httpProvider","uibDatepickerConfig","$provide",function(a,b,c,d,e,f){d.interceptors.push("authHttpResponseInterceptor"),a.when("/",{title:"LOGIN_TITLE",templateUrl:"views/login.html",controller:"LoginController"}).when("/login",{title:"LOGIN_TITLE",templateUrl:"views/login.html",controller:"LoginController"}).when("/error",{title:"ERROR_TITLE",templateUrl:"views/error.html"}).when("/home",{title:"DASHBOARD_TITLE",templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).when("/profil",{title:"PROFILE_TITLE",templateUrl:"views/profile.html",controller:"ProfileController"}).when("/rezervace-mistnosti",{title:"RESERVATION_ROOMS",templateUrl:"views/reservation_office.html",controller:"ReservationOfficeCtrl"}).when("/crm",{title:"CRM",templateUrl:"views/crm.html",controller:"CrmCtrl"}).when("/opportunities",{title:"OPPORTUNITIES",templateUrl:"views/opportunities.html",controller:"OpportunitiesCtrl",resolve:{initialData:["OpportunitiesService",function(a){return a.list({sortField:"subject",sortDirection:"asc"}).then(function(a){return{opportunities:a.data}})}]}}).when("/opportunity",{title:"OPPORTUNITY",templateUrl:"views/opportunity.html",controller:"OpportunityCtrl",resolve:{initialData:["$q","SalesPipelineStagesService","MessengerService",function(a,b,c){var d=b.list();return a.all([d]).then(function(a){return{opportunity:c.getData()||{},stages:a[0].data||{}}})}]}}).when("/opportunity/:id",{title:"OPPORTUNITY",templateUrl:"views/opportunity.html",controller:"OpportunityCtrl",resolve:{initialData:["$q","$route","OpportunitiesService","SalesPipelineStagesService",function(a,b,c,d){var e=c.get({id:b.current.params.id}),f=d.list();return a.all([e,f]).then(function(a){return{opportunity:a[0].data||{},stages:a[1].data||[]}})}]}}).when("/sales-pipeline",{title:"SALES_PIPELINE",templateUrl:"views/sales_pipeline.html",controller:"SalesPipelineCtrl",resolve:{initialData:["$q","SalesPipelineStagesService",function(a,b){var c,d,e,f=b.list(),g={};return a.all([f]).then(function(a){for(d=0,e=a[0].data.length;e>d;d+=1)c=a[0].data[d],g[c.id]={};return{opportunity:{},stages:a[0].data||[],stagesRows:g}})}]}}).when("/vyvoj",{title:"DEVELOP",templateUrl:"views/vyvoj.html",controller:"VyvojCtrl"}).when("/people",{title:"PEOPLE",templateUrl:"views/people.html",controller:"PeopleCtrl",resolve:{initialData:["PeopleService",function(a){return a.list({sortField:"last_name",sortDirection:"asc"}).then(function(a){return{people:a.data,teamMember:0}})}]}}).when("/person/:id",{title:"PERSON",templateUrl:"views/person.html",controller:"PersonCtrl",resolve:{initialData:["$q","$route","PeopleService","CountriesService",function(a,b,c,d){var e,f=c.get(b.current.params.id),g=d.list();return a.all([f,g]).then(function(a){return e=a[0].data,e.teamMember=0,{person:e,countries:a[1].data}})}]}}).when("/person",{title:"PERSON",templateUrl:"views/person.html",controller:"PersonCtrl",resolve:{initialData:["$q","CountriesService",function(a,b){var c=b.list();return a.all([c]).then(function(a){return{person:{teamMember:0},countries:a[0].data}})}]}}).when("/team-members",{title:"TEAM_MEMBERS",templateUrl:"views/people.html",controller:"PeopleCtrl",resolve:{initialData:["PeopleService",function(a){return a.teamMembersList({sortField:"last_name",sortDirection:"asc",teamMember:1}).then(function(a){return{people:a.data,teamMember:1}})}]}}).when("/team-member/:id",{title:"TEAM_MEMBER",templateUrl:"views/person.html",controller:"PersonCtrl",resolve:{initialData:["$q","$route","PeopleService","CountriesService",function(a,b,c,d){var e,f=c.get(b.current.params.id),g=d.list();return a.all([f,g]).then(function(a){return e=a[0].data,e.teamMember=1,{person:e,countries:a[1].data}})}]}}).when("/team-member",{title:"TEAM_MEMBER",templateUrl:"views/person.html",controller:"PersonCtrl",resolve:{initialData:["$q","CountriesService",function(a,b){var c=b.list();return a.all([c]).then(function(a){return{person:{teamMember:1},countries:a[0].data}})}]}}).when("/config",{title:"CONFIG_TITLE",templateUrl:"views/config.html",controller:"ConfigCtrl"}).when("/test",{title:"PAGE_TITLE",templateUrl:"views/test.html",controller:"TestCtrl"}).when("/company/:id",{title:"COMPANY",templateUrl:"views/company.html",controller:"CompanyCtrl",resolve:{initialData:["$q","$route","CountriesService","CompaniesService",function(a,b,c,d){var e=c.list(),f=d.get(b.current.params.id);return a.all([f,e]).then(function(a){return{company:a[0].data,countries:a[1].data}})}]}}).when("/company",{title:"COMPANY",templateUrl:"views/company.html",controller:"CompanyCtrl",resolve:{initialData:["$q","CountriesService",function(a,b){var c=b.list();return a.all([c]).then(function(a){return{company:{},countries:a[0].data}})}]}}).when("/companies",{title:"COMPANIES",templateUrl:"views/companies.html",controller:"CompaniesCtrl",resolve:{companies:["CompaniesService",function(a){return a.list({sortField:"company_name",sortDirection:"asc"}).then(function(a){return a.data})}]}}).when("/appointment",{title:"APPOINTMENT",templateUrl:"views/appointment.html",controller:"AppointmentCtrl",resolve:{initialData:["$q","AppointmentService","MessengerService",function(a,b,c){var d=b.places(),e=b.types();return a.all([d,e]).then(function(a){return{appointment:c.getData().appointment||{},places:a[0].data,types:a[1].data}})}]}}).when("/appointment/:id",{title:"APPOINTMENT",templateUrl:"views/appointment.html",controller:"AppointmentCtrl",resolve:{initialData:["$q","$route","AppointmentService",function(a,b,c){var d=c.places(),e=c.types(),f=c.get(b.current.params.id);return a.all([f,d,e]).then(function(a){return{appointment:a[0].data,places:a[1].data,types:a[2].data}})}]}}).when("/appointments",{title:"APPOINTMENTS",templateUrl:"views/appointments.html",controller:"AppointmentsCtrl",resolve:{initialData:["AppointmentService",function(a){return a.list({sortField:"subject",sortDirection:"asc"}).then(function(a){return{appointments:a.data}})}]}}).when("/reminder",{title:"REMINDER",templateUrl:"views/reminder.html",controller:"ReminderCtrl",resolve:{initialData:["PeopleService","MessengerService",function(a,b){return a.loginUserEmails().then(function(a){return{reminder:b.getData(),people:a.data||{}}})}]}}).when("/reminder/:id",{title:"REMINDER",templateUrl:"views/reminder.html",controller:"ReminderCtrl",resolve:{initialData:["$q","$route","PeopleService","ReminderService",function(a,b,c,d){var e=c.loginUserEmails(),f=d.get(b.current.params.id);return a.all([f,e]).then(function(a){return{reminder:a[0].data||{},people:a[1].data||{}}})}]}}).when("/reminders",{title:"REMINDERS",templateUrl:"views/reminders.html",controller:"RemindersCtrl",resolve:{initialData:["ReminderService",function(a){return a.list({sortField:"original_time",sortDirection:"desc"}).then(function(a){return{reminders:a.data}})}]}}).when("/calendar",{title:"PAGE_TITLE",templateUrl:"views/calendar.html",controller:"CalendarCtrl",resolve:{initialData:["$q","$rootScope","AppointmentService","ReminderService","UsersService","MessengerService",function(a,b,c,d,e,f){var g=c.listForCalendar({ownerId:b.meta.ownerId}),h=d.listForCalendar({ownerId:b.meta.ownerId}),i=e.listWithoutOwner();return a.all([h,g,i]).then(function(a){var b=f.getData();return{appointmentId:b.appointmentId,scrollTime:b.scrollTime,defaultView:b.defaultView,defaultCalendarDate:b.defaultCalendarDate,appointmentsCalendar:a[1].data.length>0?a[1].data:[{title:"",start:"2013-12-11T00:00:00.000Z"}],reminderCalendar:a[0].data.length>0?a[0].data:[{title:"",start:"2013-12-11T00:00:00.000Z"}],usersWithoutOwner:a[2].data}})}]}}).when("/agenda",{title:"AGENDA_TITLE",templateUrl:"views/agenda.html",controller:"AgendaCtrl"}).when("/task",{title:"TASK",templateUrl:"views/task.html",controller:"TaskCtrl",resolve:{initialData:["$q","MessengerService","UsersService",function(a,b,c){var d=c.listWithoutOwner();return a.all([d]).then(function(a){return{task:b.getData().task||{},usersWithoutOwner:a[0].data}})}]}}).when("/task/:id",{title:"TASK",templateUrl:"views/task.html",controller:"TaskCtrl",resolve:{initialData:["$q","$route","TasksService","UsersService",function(a,b,c,d){var e=c.get(b.current.params.id),f=d.listWithoutOwner();return a.all([e,f]).then(function(a){return{task:a[0].data,usersWithoutOwner:a[1].data}})}]}}).when("/tasks",{title:"TASKS",templateUrl:"views/tasks.html",controller:"TasksCtrl"}).when("/sales-plan",{title:"SALES_PLAN",templateUrl:"views/sales_plan.html",controller:"SalesPlanCtrl",resolve:{initialData:["$q","SalesPlanService","MessengerService",function(a,b,c){var d=b.yearsForFilter(),e=b.monthsForFilter(),f=b.quarterForFilter();return a.all([d,e,f]).then(function(a){return{salesPlan:c.getData(),years:b.yearsArrayForFilter(a[0].data),months:b.monthsArrayForFilter(a[1].data),quarter:b.monthsArrayForFilter(a[2].data)}})}]}}).when("/our-company",{title:"OUR_COMPANY",templateUrl:"views/our_company.html",controller:"OurCompanyCtrl"}).when("/products",{title:"PRODUCTS",templateUrl:"views/products.html",controller:"ProductsCtrl",resolve:{initialData:["ProductsService",function(a){return a.list({sortField:"name",sortDirection:"asc"}).then(function(a){return{products:a.data}})}]}}).when("/product/:id",{title:"PRODUCT",templateUrl:"views/product.html",controller:"ProductCtrl",resolve:{initialData:["$q","$route","ProductsService","CurrencyService","UnitsService",function(a,b,c,d,e){var f=d.list(),g=e.list(),h=c.get(b.current.params.id);return a.all([h,f,g]).then(function(a){return{product:a[0].data,currency:a[1].data,units:a[2].data}})}]}}).when("/product",{title:"PRODUCT",templateUrl:"views/product.html",controller:"ProductCtrl",resolve:{initialData:["$q","CurrencyService","UnitsService","MessengerService",function(a,b,c,d){var e=b.list(),f=c.list();return a.all([e,f]).then(function(a){return{product:d.getData(),currency:a[0].data,units:a[1].data}})}]}}).when("/projects",{title:"PROJECTS",templateUrl:"views/projects.html",controller:"ProjectsCtrl",resolve:{initialData:["ProjectsService",function(a){return a.list({sortField:"subject",sortDirection:"asc"}).then(function(a){return{projects:a.data}})}]}}).when("/project/:id",{title:"PROJECT",templateUrl:"views/project.html",controller:"ProjectCtrl",resolve:{initialData:["$q","$route","ProjectsService",function(a,b,c){var d=c.get(b.current.params.id);return a.all([d]).then(function(a){return{project:a[0].data}})}]}}).when("/project",{title:"PROJECT",templateUrl:"views/project.html",controller:"ProjectCtrl",resolve:{initialData:["MessengerService",function(a){return{project:a.getData()}}]}}).when("/search/:code/:hash",{title:"SEARCH_TITLE",templateUrl:"views/search.html",controller:"SearchCtrl"}).when("/changelog",{title:"CHANGELOG_TITLE",templateUrl:"views/changelog.html",controller:"ChangelogCtrl"}).when("/changelogs",{title:"CHANGELOGS_TITLE",templateUrl:"views/changelogs.html",controller:"ChangelogsCtrl",resolve:{initialData:["ChangelogsService",function(a){return a.list({sortField:"table_name",sortDirection:"asc"}).then(function(a){return{changelogs:a.data}})}]}}).when("/companies-import",{title:"COMPANIES_IMPORT_TITLE",templateUrl:"views/companies_import.html",controller:"CompaniesImportCtrl"}).when("/dashboard",{title:"DASHBOARD_TITLE",templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).when("/sales",{title:"SALES_TITLE",templateUrl:"views/sales.html",controller:"SalesCtrl"}).when("/pipeline-setup",{title:"PIPELINE_SETUP_TITLE",templateUrl:"views/pipeline_setup.html",controller:"PipelineSetupCtrl",resolve:{initialData:["SalesPipelineStagesService",function(a){return a.list().then(function(a){return{stages:a.data}})}]}}).when("/attachments",{title:"ATTACHMENTS",templateUrl:"views/attachments.html",controller:"AttachmentsCtrl"}).when("/contract",{title:"PAGE_TITLE",templateUrl:"views/contract.html",controller:"ContractCtrl"}).when("/contracts",{title:"PAGE_TITLE",templateUrl:"views/contracts.html",controller:"ContractsCtrl"}).when("/user",{title:"PAGE_TITLE",templateUrl:"views/user.html",controller:"UserCtrl"}).otherwise({redirectTo:"/error"}),b.useSanitizeValueStrategy(null),b.useLoader("$translatePartialLoader",{urlTemplate:"translations/{lang}/{part}.json"}),b.preferredLanguage("en-us"),c.localeLocationPattern("bower_components/angular-i18n/angular-locale_{{locale}}.js"),d.defaults.headers.get||(d.defaults.headers.get={}),d.defaults.headers.get["If-Modified-Since"]="0",e.startingDay=1,f.decorator("taOptions",["taRegisterTool","$delegate",function(a,b){return b.forceTextAngularSanitize=!1,b.toolbar=[["h1","h2","h3","h4","p"],["bold","italics","underline","strikeThrough","ul","ol"],["justifyLeft","justifyCenter","justifyRight","indent","outdent"],["redo","undo","clear"]],b}])}]).run(["$rootScope","$locale","$route","$location","$cookies","Meta","DateService","Language",function(a,b,c,d,e,f,g,h){e.isLogged&&["/","/login"].indexOf(d.path())>-1&&d.path("/home"),a.$on("$translateChangeSuccess",function(){g.setDatepicker()}),a.$on("$localeChangeSuccess",function(){g.setFormat("d.M.yyyy"),g.setFormatTime(b.DATETIME_FORMATS.shortTime)}),a.$on("$locationChangeStart",function(a,b,e){if(-1===["/login","/"].indexOf(d.path())&&""!==d.path()){var g=f.setMetaInformations();h.getLanguage()||(a.preventDefault(),g?g.then(function(a){d.$$parse(b),b===e&&c.reload()}):d.$$parse(b))}}),a.$on("$routeChangeSuccess",function(b,c,d){c.$$route&&(a.title=c.$$route.title),a.showFormChanges=!1})}]),angular.module("crmPostgresWebApp").controller("MainCtrl",["$scope","$rootScope","$timeout","$http","$route","$translate","$translatePartialLoader","Admin","Constants","Tools","UsersService","SocketFactory","AlertsService","AuthenticationService","MessengerService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){g.addPart("global"),f.refresh(),a.LANGUAGE_KEYS=i.LANGUAGE_KEYS,a.alertsMain=[],a.exportToExcel=function(a,b){var c,e=[];e=j.objectWithBooleanToArray(b),d.post(a,{items:e}).then(function(a){a.data.message&&a.data.message.type===i.MESSAGE_ERROR_MODAL?m.add({type:i.MESSAGE_ERROR_MODAL,message:"INFO_EXPORT_ERROR",message2:"("+decodeURIComponent(a.data.message.msg)+")",title:"ERROR"}):(c=new Blob([a.data],{type:"application/vnd.openxmlformats"}),window.navigator.msSaveOrOpenBlob(c,"filename.xlsx"))})},a.changeLanguage=function(a){b.meta.language=a,k.saveLanguage(a),j.setLanguage(a).then(function(){e.reload()})},a.createUser=function(){h.createUser(function(b){a.alertsMain.push(b)})},l.on("send:message",function(b){var c=a.prepareSocketMessage(b);m.add(c)}),a.sendSocket=function(){l.emit("send:message",{type:"ERROR",message:"Test klient"},function(a){console.log(a)})},a.prepareSocketMessage=function(b){var c,d,e=[],f=!1;if(b.type===i.MESSAGE_WARNING_MODAL_CONN_LOST){for(e=m.getModal(),c=0,d=e.length;d>c;c+=1)e[c].type===i.MESSAGE_WARNING_MODAL_CONN_LOST&&(f=!0);b=f?null:a.createConnectionLostMessage()}return b},a.createConnectionLostMessage=function(){var a,b;return a=c(function(){m.deleteType(i.MESSAGE_WARNING_MODAL_CONN_LOST),m.closeModalMessage(),o.setData({message:i.MESSAGE_TEXT_CONNECTION_LOST}),n.logout()},i.CONNECTION_LOST_TIME_LOGOUT),b={prefix:i.MESSAGE_TEXT_CONNECTION_SOON_LOST2,text:"",sufix:i.MESSAGE_TEXT_CONNECTION_SOON_LOST3},j.timer(b,"text",6e4),{type:i.MESSAGE_WARNING_MODAL_CONN_LOST,title:i.MESSAGE_TEXT_CONNECTION_SOON_LOST_TITLE,messageObj:b,cancelButton:{name:i.MESSAGE_TEXT_NO,onClick:function(){c.cancel(a),n.logout()}},buttons:[{name:i.MESSAGE_TEXT_YES,onClick:function(){c.cancel(a),n.sendConnectionRefresh()}},{name:i.MESSAGE_TEXT_NO,onClick:function(){c.cancel(a),n.logout()}}]}}}]),angular.module("crmPostgresWebApp").service("AuthenticationService",["$location","$http","$cookies",function(a,b,c){var d=!1;return{isLogin:d,login:function(a,c,e,f){b.post("/api/login",{credentials:a}).success(function(a){a.success?(d=!0,c(a)):e(a)}).error(function(a){f(a)})},logout:function(){c.auth_token="",a.path("/login"),b.get("/api/logout",{cache:!1})},sendConnectionRefresh:function(){b.post("/api/authentication/alive",{})}}}]),angular.module("crmPostgresWebApp").controller("HomeCtrl",["$scope","$translate","$translatePartialLoader",function(a,b,c){c.addPart("home"),b.refresh()}]),angular.module("crmPostgresWebApp").controller("LoginController",["$scope","$timeout","$cookies","$translate","$translatePartialLoader","AuthenticationService","AlertsService","Constants","Tools","MessengerService",function(a,b,c,d,e,f,g,h,i,j){e.addPart("login"),d.refresh(),b(function(){d.refresh()},300),a.credentials={},a.credentials.pin="",a.credentials.login="",a.credentials.password="",a.messenger=j.getData(),a.message=a.messenger?a.messenger.message:"",a.credentials={login:"",password:"",pin:""},a.login=function(){a.credentials.login=$("#lg").val(),a.credentials.password=$("#pw").val(),a.credentials.pin=$("#pinpw").val(),f.login(a.credentials,function(){$("#login-login").val(a.credentials.login),$("#login-password").val(a.credentials.password),$("#login-password2").val(a.credentials.pin),$("#login-form").submit()},function(a){g.add(a.message)},function(a){g.add({type:h.MESSAGE_ERROR,message:a?a.message.msg:h.MESSAGE_ERROR})})},i.setLanguage(c.language||"en-us")}]),angular.module("crmPostgresWebApp").directive("header",function(){return{templateUrl:"views/directives/d_header.html",restrict:"E",controller:["$scope","$http","$location","AuthenticationService","MessengerService","AlertsService","Constants",function(a,b,c,d,e,f,g){a.pagesWithoutHeader=["/login","/"],a.modules={home:[{name:"HOME2",redirect:"/home"}],contacts:[{name:"COMPANIES",redirect:"/companies"},{name:"PEOPLE",redirect:"/people"}],activity:[{name:"AGENDA",redirect:"/agenda"},{name:"CALENDAR",redirect:"/calendar"},{name:"APPOINTMENTS",redirect:"/appointments"},{name:"TASKS",redirect:"/tasks"},{name:"REMINDERS",redirect:"/reminders"}],pipeline:[{name:"OPPORTUNITIES",redirect:"/opportunities"},{name:"SALES_PIPELINE",redirect:"/sales-pipeline"}],sales:[{name:"SALES_PLAN",redirect:"/sales-plan"},{name:"SALES",redirect:"/sales"},{name:"PRODUCTS",redirect:"/products"},{name:"PROJECTS",redirect:"/projects"},{name:"CONTRACTS",redirect:"/contracts"}],team:[{name:"TEAM_MEMBERS",redirect:"/team-members"}]},a.logout=d.logout,a.headerTitle="",a.hideMenu=!1,a.setShowMenu=function(){a.hideMenu=!1},a.setHideMenu=function(){a.hideMenu=!0},a.activeMenuItem=function(a){var b,d,e=!1;for(b=0,d=a.length;d>b;b+=1)if(c.path()===a[b].redirect){e=!0;break}return e},a.enterSearch=function(b){13===b.which&&a.search()},a.search=function(){a.searchCode.length>1?(e.clear(),e.setData({searchCode:a.searchCode}),c.path("/search/"+encodeURIComponent(a.searchCode)+"/"+Math.random())):f.add({type:g.MESSAGE_WARNING,messages:[{message:"SEARCH_STR_LENGTH"}]})},a.pageWithoutHeader=function(){return a.pagesWithoutHeader.indexOf(c.path())>-1}}]}}),angular.module("crmPostgresWebApp").directive("portletReservationOffice",["$http",function(a){return{templateUrl:"views/directives/d_portlet_reservation_office.html",restrict:"E",controller:["$scope","$timeout","ReservationOffice","Rooms",function(a,b,c,d){var e=new Date;e.getDate(),e.getMonth(),e.getFullYear();a.title="Rezervace místností",a.reservationOffice={},a.events=[],a.rooms=[],a.alerts=[],a.alertsMain=[],a.closeAlert=function(b){a.alerts.splice(b,1)},a.closeAlertMain=function(b){a.alertsMain.splice(b,1)},a.today=function(){a.reservationOffice.date=new Date},a.today(),a.showWeeks=!1,a.toggleWeeks=function(){a.showWeeks=!a.showWeeks},a.clear=function(){a.reservationOffice.date=null},a.toggleMin=function(){a.minDate=a.minDate?null:new Date},a.toggleMin(),a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.dateOptions={"year-format":"'yy'","starting-day":1,"current-text":"Dnes","toggle-weeks-text":"Týdny","clear-text":"Smazat","close-text":"Zavřít"},a.formats=["dd.MM.yyyy","yyyy/MM/dd","shortDate"],a.format=a.formats[0],a.hstep=1,a.mstep=1,a.reservationOffice.time_from=new Date,a.reservationOffice.time_to=new Date,a.ismeridian=!1,a.postReservationOffice=function(){c.post(a.reservationOffice,function(c){"success"==c.type?(a.alertsMain.push(c),b(function(){a.alertsMain=[]},1e4),$("#myModal").modal("hide"),a.init()):(a.alerts.push(c),b(function(){a.alerts=[]},1e4))},function(c){a.alerts.push({type:"danger",msg:"Při ukládání nové rezervace došlo k chybě."}),b(function(){a.alerts=[]},1e4)})},a.deleteItem=function(d){c["delete"]({id:a.events[d].id},function(c){"success"==c.type?(a.alertsMain.push(c),b(function(){a.alertsMain=[]},1e4),a.events.splice(d,1),a.init()):(a.alertsMain.push(c),b(function(){a.alertsMain=[]},1e4))},function(c){a.alertsMain.push({type:"danger",msg:"Při mazání rezervace došlo k chybě."}),b(function(){a.alertsMain=[]},1e4)})},a.init=function(){c.portletsList({},function(c){if(a.events=[],c)if("success"==c.type){if(c.rows)for(var d=0;d<c.rows.length;d++)a.events.push({id:decodeURIComponent(c.rows[d].id),title:decodeURIComponent(c.rows[d].title)})}else a.alertsMain.push(c),b(function(){a.alertsMain=[]},1e4)})},a.initRooms=function(){d.list(function(b){if(a.rooms=[],b)for(var c=0;c<b.rows.length;c++){b.rows[c];a.rooms.push({id:b.rows[c].id,name:decodeURIComponent(b.rows[c].name)})}})},a.init(),a.initRooms()}]}}]),angular.module("crmPostgresWebApp").directive("portlets",["$compile","$http",function(a,b){return{template:"",restrict:"E",link:function(c,d,e){b.post("/test");var f=angular.element("<portlet_reservation_office></portlet_reservation_office>");f.insertBefore(d,f.nextSibling),a(f)(c)}}}]),angular.module("crmPostgresWebApp").service("Tools",["$timeout","$translate","$rootScope","$location","$filter","$cookies","$locale","tmhDynamicLocale","Constants","DateService","Language",function(a,b,c,d,e,f,g,h,i,j,k){return{getDateTimeStr:function(a){var b,c,d,e,f,g="";return a?(b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear(),e=a.getHours(),f=a.getMinutes(),b+"."+c+"."+d+" "+e+":"+f):g},setLanguage:function(a){return b.use(a),f.language=a,k.setLanguage(a),h.set(a)},createObject:function(a,b){var c,d,e,f=b||{};if(a){e=JSON.parse(JSON.stringify(a));for(c in a)if(a.hasOwnProperty(c))if("object"==typeof a[c]&&null!==a[c]){if("[object Object]"===Object.prototype.toString.call(a[c])&&(f[c]=e[c]),"[object Function]"===Object.prototype.toString.call(a[c])&&(f[c]=e[c]),"[object Date]"===Object.prototype.toString.call(a[c])&&(f[c]=new Date(e[c])),"[object Array]"===Object.prototype.toString.call(a[c])){f[c]=[];for(d in a[c])a[c].hasOwnProperty(d)&&"[object Object]"===Object.prototype.toString.call(a[c][d])&&(f[c][d]=e[c][d])}}else f[c]=a[c]}return f},setObject:function(a,b){var c;if(b){for(c in a)a.hasOwnProperty(c)&&delete a[c];a=this.createObject(b,a)}},getChangedProperties:function(a,b){var c,d={};for(c in b)b.hasOwnProperty(c)&&JSON.stringify(b[c])!==JSON.stringify(a[c])&&(b[c]||a[c])&&(d[c]=b[c]);return d},inc:function(a,b){var c,d;for(c=0,d=a.length;d>c;c+=1)a[c]+=b;return a},openUrl:function(a,b,c){var d;a&&(d=a,c&&(d=c+a),c||-1!==d.toUpperCase().indexOf("http://")||(d="http://"+d),b?window.open(d,b):window.open(d))},existsItemInArray:function(a,b,c){var d,e,f,g,h=!1,i=c.split(",");if(!b)return h;for(d=0,e=b.length;e>d;d+=1){for(f=0,g=i.length;g>f;f+=1)if(a&&c&&b[d][i[f]].toLowerCase()===a.toLowerCase()){h=!0;break}if(h)break}return h},getItemFromArray:function(a,b,c,d){var e,f,g=null;for(e=0,f=c.length;f>e;e+=1)if(b&&d&&c[e][b]===a){g=c[e][d];break}return g},validateEmail:function(a){var b=/^(([^<>()\[\]\\.,;:\s@\"]+(\.[^<>()\[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,c=a?b.test(a):!0;return c},validatePhone:function(a){var b=/^(\+420)? ?[0-9]{3} ?[0-9]{3} ?[0-9]{3}$/,c=a?b.test(a):!0;return c},validateZip:function(a){var b=/^[0-9]{3} ?[0-9]{2}$/,c=a?b.test(a):!0;return c},deleteItemOfArrayObjects:function(a,b,c,d){a[b]=a[b].filter(function(a){var b=!1;return c!==a[d]&&(b=!0),b})},objectToQueryString:function(a){var b,c={},d="";for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b],d&&(d+="&"),d+="filter"===b.toString()?this.objectToQueryString(c[b]):b.toString()+"="+String(c[b]));return d},isNumber:function(a){var b,c,d,e,f,g=String(a),h=["0","1","2","3","4","5","6","7","8","9"];if(f=g.length>0,!g)return!1;for(b=0,c=g.length;c>b;b+=1)if(e=g.substring(b,b+1),d=h.indexOf(e),-1===d){f=!1;break}return f},dateSeparator:function(a){var b,c=a;return c&&(c=c.replace(/m/gi,""),c=c.replace(/d/gi,""),c=c.replace(/y/gi,""),b=c[0]),b},validateDate:function(a,b){var c,d,e,f,g,h,i,k,l=b||j.getFormat(),m=!0;if(!a)return!1;if(c=this.dateSeparator(l),k=a.split(c),f=l.split(c),m=3===k.length){for(d=0,e=f.length;e>d;d+=1)g=f[d].toUpperCase(),g.indexOf("Y")>-1&&(i=d,h=f[d]);for(d=0,e=k.length;e>d;d+=1)m=m&&(this.isNumber(k[d])||f[d].indexOf(" ")>-1&&this.isNumber(k[d].replace(/ /g,""))),i===d&&(m=m&&(h.length===k[d].length||1===h.replace(/ /g,"").length&&4===k[d].replace(/ /g,"").length))}return m},join:function(a,b){var c,d,e=[];for(c=0,d=a.length;d>c;c+=1)a[c]&&a[c].length>0&&e.push(a[c]);return e.join(b)},getColorEventForCalendar:function(a){var b;if(a.type===i.TYPE_CALENDAR_EVENT_APPOINTMENT)switch(parseInt(a.typeId,10)){case 1:b="SkyBlue";break;case 2:b="YellowGreen";break;case 3:b="Blue";break;case 4:b="DarkGreen"}return a.type===i.TYPE_CALENDAR_EVENT_REMINDER&&(b="Orange"),b},objectWithBooleanToArray:function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&a[b]&&c.push(b);return c},objectFromArrayByGroup:function(a,b){var c,d,e={};for(c=0,d=a.length;d>c;c+=1)e[a[c][b]]?e[a[c][b]].rows.push(a[c]):(e[a[c][b]]={rows:[]},e[a[c][b]].rows.push(a[c]));return e},sortArrayWithObjectsIntoGroups:function(a,b,c){var d,e,f,g={};for(d=0,e=c.length;e>d;d+=1)g[c[d]]=[];for(d=0,e=a.length;e>d;d+=1)f=c.indexOf(a[d][b]),g[c[f]]||(g[c[f]]=[]),g[c[f]].push(a[d]);return g.count=a.length||0,g},timer:function(b,c,d){var e,f;e=d,f=function(){e-=1e3,b[c]=e/1e3,e>0&&a(f,1e3)},a(f,1e3)}}}]),angular.module("crmPostgresWebApp").controller("OpportunityCtrl",["$scope","$location","$translate","$translatePartialLoader","PageAncestor","OpportunitiesService","Constants","MessengerService","AlertsService","initialData",function(a,b,c,d,e,f,g,h,i,j){d.addPart("opportunity"),c.refresh(),a.probabilityChar="%",a.opportunity=j.opportunity,a.opportunityTmp={},a.opportunityTmp.chance=a.opportunity.chance?a.opportunity.chance+a.probabilityChar:"",a.salesPipelineStages=j.stages,a.opportunity.company=a.opportunity.company||[],a.opportunity.person=a.opportunity.person||[],a.opportunity.opportunityTags=a.opportunity.opportunityTags||[],a.opportunity.salesPipeline=a.opportunity.sales_pipeline||[],a.opportunity.ownerName=a.opportunity.ownerName||a.meta.ownerName,a.showNewItem=!1,a.showEditItem=!1,a.tabs=[!1,!1,!1,!1],a.localDataTags=[],a.opportunityItems=[],a.dataLoaderParams={sortField:"name",sortDirection:"asc"},a.infoPaging={},a.dataLoader=function(b){return f.listItems(a.opportunity,b)},a.refreshItems=null,a.history=[],a.loadDataForAgendaList=f.listForAgenda,a.dataForAgenda={},a.attachmentsTable=g.ATTACHMENTS_TYPES.OPPORTUNITY,a.isEdit=0===parseInt(a.opportunity.status||"0",10),a.initButtons=function(){var b={};a.actionButtons=[{name:"DELETE",dropDown:[{name:"DELETE_OPPORTUNITY",onClick:a.del,disabled:function(){return!a.opportunity.id}}],disabled:!a.opportunity.id},{name:"CANCEL",onClick:a.pageAncestor.cancel,disabled:function(){return!a.pageAncestor.log.changes.isChanged}}],b=a.opportunity.id?{name:"SAVE",onClick:a.put,disabled:function(){return!a.isEdit}}:{name:"SAVE",onClick:a.post,disabled:function(){return!a.isEdit}},a.actionButtons.push(b)},a.verify=function(){var b,c,d=!0,e=[];for(e.push({message:"WARNING_FIELD_VALUE_INVALID"}),a.opportunity.subject||(d=!1,e.push({message:"SUBJECT"})),(!a.opportunity.company[0]||a.opportunity.company[0]&&!a.opportunity.company[0].id)&&(d=!1,e.push({message:"COMPANY"})),a.opportunity.salesPipelineStageId||(d=!1,e.push({message:"PHASE"})),b=0,c=e.length;c>b;b+=1)b>1&&(e[b].prefix=", ");return d||a.pageAncestor.addAlert({type:g.MESSAGE_WARNING_VALIDATION_BEFORE_CRUD,messages:e}),d},a.verifyItem=function(){var b,c,d=!0,e=[];for(e.push({message:"WARNING_FIELD_VALUE_INVALID"}),(!a.opportunity.item.product[0]||a.opportunity.item.product[0]&&!a.opportunity.item.product[0].id)&&(d=!1,e.push({message:"PRODUCT"})),a.opportunity.item.price||(d=!1,e.push({message:"PRICE_UNIT"})),a.opportunity.item.amount||(d=!1,e.push({message:"AMOUNT"})),(!a.opportunity.item.product[0]||a.opportunity.item.product[0]&&!a.opportunity.item.product[0].unit)&&(d=!1,e.push({message:"UNIT"})),b=0,c=e.length;c>b;b+=1)b>1&&(e[b].prefix=", ");return d||a.pageAncestor.addAlert({type:g.MESSAGE_WARNING_VALIDATION_BEFORE_CRUD,messages:e}),d},a.getProbabilities=function(){var a,b,c=[];for(a=0,b=5;100>=a;a+=b)c.push(a);return c},a.setProbability=function(b){a.opportunity.chance=a.getProbabilities()[b],a.opportunityTmp.chance=a.opportunity.chance+a.probabilityChar},a.setSalesPipelineStage=function(b){a.opportunity.salesPipelineStageId=a.salesPipelineStages[b].id,a.opportunityTmp.tmpSalesPipelineStage=a.salesPipelineStages[b].name},a.setTabs=function(b){a.tabs=a.tabs.map(function(c,d){return d===b&&a.opportunity.id})},a.addItem=function(){a.clearItem(),a.showNewItem=!0,a.showItemIndex=null},a.cancelItem=function(){a.clearItem(),a.showNewItem=!1,a.showItemIndex=null},a.postItem=function(){a.verifyItem()&&a.pageAncestor.post(function(){return f.postItem(a.opportunity).then(function(b){return a.refreshAfterPostItem(b.data),b})})},a.putItem=function(){a.verifyItem()&&a.pageAncestor.put(function(){return f.putItem(a.opportunity).then(function(b){return a.refreshAfterPutItem(b.data),b})})},a.delItem=function(b){a.pageAncestor.confirm(function(){return f.delItem({id:a.opportunity.id,number:a.opportunityItems[b].number}).then(function(b){return a.loadItems(),b})},g.MESSAGE_EXEC_DELETE_ITEM,g.MESSAGE_EXEC_DELETE_ITEM_SUCCESS,g.MESSAGE_EXEC_DELETE_ITEM_ERROR)},a.post=function(){a.verify()&&a.pageAncestor.post(function(){return f.post(a.opportunity).then(function(a){return a.data.id&&b.path("/opportunity/"+a.data.id),a})})},a.put=function(){a.verify()&&a.pageAncestor.put(function(){return f.put(a.opportunity).then(function(a){return a.data.id&&b.path("/opportunity/"+a.data.id),a})})},a.del=function(){a.pageAncestor.del(function(){return f.del(a.opportunity).then(function(a){return a.data.id?b.path("/opportunity/"+a.data.id):b.path("/sales-pipeline"),a})})},a.loadTags=function(){f.tags().then(function(b){a.localDataTags=b.data})},a.loadHistory=function(){f.history(a.opportunity).then(function(b){a.history=b.data})},a.loadItems=function(){a.opportunity.id&&a.refreshItems()},a.refreshAfterPostItem=function(b){b.message&&b.message.type===g.MESSAGE_SUCCESS&&(a.loadItems(),a.cancelItem())},a.refreshAfterPutItem=function(b){b.message&&b.message.type===g.MESSAGE_SUCCESS&&(a.loadItems(),a.cancelItem())},a.clearItem=function(){a.opportunity.item={product:[]}},a.setSalesPipelineStageDefault=function(){var b=0;a.salesPipelineStages.map(function(c,d){a.opportunity.salesPipelineStageId===c.id&&(b=d)}),a.setSalesPipelineStage(b)},a.refreshTotalPrice=function(){a.opportunityTmp.totalPrice=0,a.opportunityItems.map(function(b){a.opportunityTmp.totalPrice+=parseFloat(b.price)*parseFloat(b.amount)})},a.itemsCallback=function(){a.cancelItem(),a.refreshTotalPrice()},a.newOpportunity=function(){b.path("/opportunity")},a.editItem=function(b){a.clearItem(),a.showNewItem=!1,a.showItemIndex=b,a.prepareItem(b)},a.prepareItem=function(b){
var c=a.opportunityItems[b];a.opportunity.item=c,a.opportunity.item.price=parseFloat(c.price),a.opportunity.item.amount=parseFloat(c.amount),a.opportunity.item.product=[{id:c.id,name:c.name,unit:c.unit}]},a.initDataForAgenda=function(){a.dataForAgenda.appointment={},a.dataForAgenda.appointment.salesPipeline=[{id:a.opportunity.id,name:a.opportunity.subject}],a.dataForAgenda.appointment.company=[{id:a.opportunity.companyId,name:a.opportunity.companyName}],a.dataForAgenda.task={},a.dataForAgenda.task.salesPipeline=[{id:a.opportunity.id,name:a.opportunity.subject}],a.dataForAgenda.task.company=[{id:a.opportunity.companyId,name:a.opportunity.companyName}]},a.opportunitySuccess=function(){parseInt(a.opportunity.status,10)===g.OPPORTUNITY_STATUS.OPEN.ID&&a.pageAncestor.postPart(function(){return f.setSuccess({id:a.opportunity.id,date:new Date}).then(function(b){return b.data&&b.data.message&&b.data.message.type===g.MESSAGE_SUCCESS&&(i.add({type:g.MESSAGE_SUCCESS,message:g.MESSAGE_TEXT_OPPORTUNITY_STATUS_SUCCESS_SUCCESS}),a.opportunity.status=g.OPPORTUNITY_STATUS.SUCCESS.ID),b})})},a.opportunityFailed=function(){parseInt(a.opportunity.status,10)===g.OPPORTUNITY_STATUS.OPEN.ID&&a.pageAncestor.postPart(function(){return f.setFailed({id:a.opportunity.id,date:new Date}).then(function(b){return b.data&&b.data.message&&b.data.message.type===g.MESSAGE_SUCCESS&&(i.add({type:g.MESSAGE_SUCCESS,message:g.MESSAGE_TEXT_OPPORTUNITY_STATUS_FAILED_SUCCESS}),a.opportunity.status=g.OPPORTUNITY_STATUS.FAILED.ID),b})})},a.opportunityOpenClosed=function(){parseInt(a.opportunity.status,10)!==g.OPPORTUNITY_STATUS.OPEN.ID&&a.pageAncestor.postPart(function(){return f.setOpen({id:a.opportunity.id}).then(function(b){return b.data&&b.data.message&&b.data.message.type===g.MESSAGE_SUCCESS&&(i.add({type:g.MESSAGE_SUCCESS,message:g.MESSAGE_TEXT_OPPORTUNITY_OPEN_CLOSED_SUCCESS}),a.opportunity.status=g.OPPORTUNITY_STATUS.OPEN.ID),b})})},a.isOpen=function(){return parseInt(a.opportunity.status,10)===g.OPPORTUNITY_STATUS.OPEN.ID},a.getStatusName=function(){var b="";return 0===parseInt(a.opportunity.status||"0",10)&&(b=g.OPPORTUNITY_STATUS.OPEN.NAME),1===parseInt(a.opportunity.status,10)&&(b=g.OPPORTUNITY_STATUS.SUCCESS.NAME),2===parseInt(a.opportunity.status,10)&&(b=g.OPPORTUNITY_STATUS.FAILED.NAME),b},a.$watch("opportunity.status",function(b,c){b!==c&&(a.statusName=a.getStatusName(),a.isEdit=0===parseInt(a.opportunity.status||"0",10))}),a.pageAncestor=e.getInstance(),a.pageAncestor.init({scope:a,formObject:"opportunity",table:"SALES_PIPELINE"}),a.statusName=a.getStatusName(),a.initButtons(),a.setTabs(0),a.setSalesPipelineStageDefault(),a.loadTags(),a.clearItem(),a.loadHistory(),a.initDataForAgenda()}]),angular.module("crmPostgresWebApp").service("UsersService",["$http",function(a){return{saveLanguage:function(b){return a.put("/api/user",{language:b})},get:function(){return a.get("/api/user")},list:function(){return a.get("/api/users",{cache:!1})},listWithoutOwner:function(){return a.get("/api/users/without-owner",{cache:!1})},logout:function(){return a.get("/api/logout",{cache:!1})},createPermission:function(b){return a.post("/api/admin/create-restrictions/user",b)}}}]),angular.module("crmPostgresWebApp").service("UserLocale",["$http","$q",function(a,b){var c=b.defer();return{getKey:function(){return a.get("/api/user").success(function(a){c.resolve(a.translate)}).error(function(a){c.reject(a)}),c.promise}}}]),angular.module("crmPostgresWebApp").controller("VyvojCtrl",["$scope","$window","$http","$translate","$translatePartialLoader",function(a,b,c,d,e){e.addPart("vyvoj"),d.refresh(),a.position={},a.getGPSPosition=function(){b.navigator.geolocation.getCurrentPosition(function(b){a.$apply(function(){a.position.latitude=b.coords.latitude,a.position.longitude=b.coords.longitude})},function(a){alert(a)})},a.exampleData=[{key:"Series 1",values:[[10254096e5,0],[1028088e6,-6.3382185140371],[10307664e5,-5.9507873460847],[10333584e5,-11.569146943813],[10360404e5,-5.4767332317425],[10386324e5,.50794682203014],[10413108e5,-5.5310285460542],[10439892e5,-5.7838296963382],[10464084e5,-7.3249341615649],[10490868e5,-6.7078630712489],[10516752e5,.44227126150934],[10543536e5,7.2481659343222],[10569456e5,9.2512381306992]]},{key:"Series 2",values:[[10254096e5,0],[1028088e6,0],[10307664e5,0],[10333584e5,0],[10360404e5,0],[10386324e5,0],[10413108e5,0],[10439892e5,0],[10464084e5,0],[10490868e5,0],[10516752e5,0],[10543536e5,0],[10569456e5,0],[1059624e6,0],[10623024e5,0],[10648944e5,0],[10675764e5,0],[10701684e5,0],[10728468e5,0],[10755252e5,-.049184266875945]]},{key:"Series 3",values:[[10254096e5,0],[1028088e6,-6.3382185140371],[10307664e5,-5.9507873460847],[10333584e5,-11.569146943813],[10360404e5,-5.4767332317425],[10386324e5,.50794682203014],[10413108e5,-5.5310285460542],[10439892e5,-5.7838296963382],[10464084e5,-7.3249341615649],[10490868e5,-6.7078630712489],[10516752e5,.44227126150934],[10543536e5,7.2481659343222],[10569456e5,9.2512381306992]]},{key:"Series 4",values:[[10254096e5,-7.0674410638835],[1028088e6,-14.663359292964],[10307664e5,-14.10439306054],[10333584e5,-23.114477037218],[10360404e5,-16.774256687841],[10386324e5,-11.902028464],[10413108e5,-16.883038668422],[10439892e5,-19.104223676831],[10464084e5,-20.420523282736],[10490868e5,-19.660555051587],[10516752e5,-13.106911231646],[10543536e5,-8.2448460302143],[10569456e5,-7.0313058730976]]}],a.exampleData2=[{key:"Series 1",values:[[10254096e5,0],[1028088e6,-6.3382185140371],[10307664e5,-5.9507873460847],[10333584e5,-11.569146943813],[10360404e5,-5.4767332317425],[10386324e5,.50794682203014],[10413108e5,-5.5310285460542],[10439892e5,-5.7838296963382],[10464084e5,-7.3249341615649],[10490868e5,-6.7078630712489],[10516752e5,.44227126150934],[10543536e5,7.2481659343222],[10569456e5,9.2512381306992],[1059624e6,11.341210982529],[10623024e5,14.73482040902],[10648944e5,12.387148007542],[10675764e5,18.436471461827],[10701684e5,19.830742266977],[10728468e5,22.643205829887],[10755252e5,26.743156781239],[10780308e5,29.597478802228],[10807092e5,30.831697585341],[10832976e5,28.054068024708],[1085976e6,29.294079423832],[1088568e6,30.269264061274],[10912464e5,24.934526898906],[10939248e5,24.265982759406],[10965168e5,27.217794897473],[10991952e5,30.802601992077],[11017908e5,36.331003758254],[11044692e5,43.14249870006],[11071476e5,40.558263931958],[11095668e5,42.5436223858],[11122452e5,41.683584710331],[11148336e5,36.375367302328],[1117512e6,40.71968898073],[1120104e6,43.897963036919],[11227824e5,49.797033975368],[11254608e5,47.085993935989],[11280528e5,46.601972859745],[11307348e5,41.567784572762],[11333268e5,47.296923737245],[11360052e5,47.64296961208],[11386836e5,50.781515820954],[11411028e5,52.600229204305],[11437812e5,55.599684490628],[11463696e5,57.920388436633],[1149048e6,53.503593218971],[115164e7,53.522973979964],[11543184e5,49.846822298548],[11569968e5,54.72134161465],[11595888e5,58.186236223191],[11622708e5,63.908065540997],[11648628e5,69.767285129367],[11675412e5,72.534013373592],[11702196e5,77.991819436573],[11726388e5,78.14358440499],[11753136e5,83.702398665233],[11779056e5,91.140859312418],[1180584e6,98.590960607028],[1183176e6,96.245634754228],[11858544e5,92.326364432615],[11885328e5,97.06876533223],[11911248e5,105.8102555626],[11938032e5,114.38348777791],[11963988e5,103.5960494981],[11990772e5,101.72488429307],[12017556e5,89.840147735028],[12042612e5,86.963597532664],[1206936e6,84.075505208491],[1209528e6,93.170105645831],[12122064e5,103.62838083121],[12147984e5,87.458241365091],[12174768e5,85.808374141319],[12201552e5,93.158054469193],[12227472e5,65.97325238236],[12254256e5,44.580686638224],[12280212e5,36.418977140128],[12306996e5,38.727678144761],[1233378e6,36.692674173387],[12357972e5,30.03302280948],[1238472e6,36.707532162718],[1241064e6,52.191457688389],[12437424e5,56.357883979735],[12463344e5,57.629002180305],[12490128e5,66.650985790166],[12516912e5,70.839243432186],[12542832e5,78.731998491499],[12569616e5,72.375528540349],[12595572e5,81.73838788163],[12622356e5,87.539792394232],[1264914e6,84.320762662273],[12673332e5,90.621278391889],[1270008e6,102.47144881651],[12726e8,102.79320353429],[12752784e5,90.529736050479],[12778704e5,76.580859994531],[12805488e5,86.548979376972],[12832272e5,81.879653334089],[12858192e5,101.72550015956],[12884976e5,107.9796485226],[12910932e5,106.16240630785],[12937716e5,114.84268599533],[129645e7,121.60793322282],[12988692e5,133.41437346605],[1301544e6,125.46646042904],[1304136e6,129.76784954301],[13068144e5,128.15798861044],[13094064e5,121.92388706072],[13120848e5,116.7003610087],[13147632e5,88.367701837033],[13173552e5,59.159665765725],[13200336e5,79.793568139753],[13226292e5,75.903834028417],[13253076e5,72.704218209157],[1327986e6,84.936990804097],[13304916e5,93.388148670744]]}],a.downloadFile=function(a){c.get("./download/"+a).success(function(b){var c=angular.element("<a/>");c.attr({href:"data:attachment/csv;charset=utf-8,"+encodeURI(b),target:"_blank",download:a})[0].click()}).error(function(a){console.log(a)})},a.createPDF=function(){c.get("/api/pdf").success(function(a){console.log(a)})},a.createLocalPDF=function(){var a=new PDFDocument,b=a.pipe(blobStream()),c="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam in suscipitpurus. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuerecubilia Curae; Vivamus nec hendrerit felis. Morbi aliquam facilisis risus eu lacinia.  Sed eu leo in turpis fringilla hendrerit. Ut nec accumsan nisl. Suspendisse rhoncusnisl posuere tortor tempus et dapibus elit porta. Cras leo neque, elementum a rhoncusut, vestibulum non nibh. Phasellus pretium justo turpis. Etiam vulputate, odio vitaetincidunt ultricies, eros odio dapibus nisi, ut tincidunt lacus arcu eu elit. Aeneanvelit erat, vehicula eget lacinia ut, dignissim non tellus. Aliquam nec lacus mi, sedvestibulum nunc. Suspendisse potenti. Curabitur vitae sem turpis. Vestibulum sedneque eget dolor dapibus porttitor at sit amet sem. Fusce a turpis lorem. Vestibulumante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae;";a.fontSize(25).text("Here is some vector graphics...",100,80),a.save().moveTo(100,150).lineTo(100,250).lineTo(200,250).fill("#FF3300"),a.circle(280,200,50).fill("#6600FF"),a.scale(.6).translate(470,130).path("M 250,75 L 323,301 131,161 369,161 177,301 z").fill("red","even-odd").restore(),a.text("And here is some wrapped text...",100,300).font("Times-Roman",13).moveDown().text(c,{width:412,align:"justify",indent:30,columns:2,height:300,ellipsis:!0}),a.end(),b.on("finish",function(){console.log(b.toBlobURL("application/pdf"))})}}]),angular.module("crmPostgresWebApp").controller("PeopleCtrl",["$scope","$translate","$location","$translatePartialLoader","PeopleService","MessengerService","initialData","Constants",function(a,b,c,d,e,f,g,h){d.addPart("people"),b.refresh();var i=f.getData();a.searchStr="",a.dataLoaderParams={filter:{},sortField:"last_name",sortDirection:"asc"},a.dataLoaderParams.filter.type=i&&i.people&&i.people.filter?i.people.filter.type:-1,a.infoPaging={},a.teamMember=g.teamMember,a.types=[h.PEOPLE.FILTER.UPCOMING_ANNIVERSARY],a.typesList=[{ID:-1,NAME:"ALL"}],a.typesList=a.typesList.concat(a.types),a.setSearch=function(b){13===b.which&&(a.dataLoaderParams.searchStr=a.searchStr)},a.newPerson=function(){a.teamMember?c.path("/team-member"):c.path("/person")},a.getType=function(){return a.typesList.filter(function(b){return b.ID===a.dataLoaderParams.filter.type})[0]},a.people=g.people,a.dataLoader=g.teamMember?e.teamMembersList:e.list}]),angular.module("crmPostgresWebApp").controller("PersonCtrl",["$scope","$location","$translatePartialLoader","$translate","$timeout","PeopleService","PageAncestor","CountriesService","LogData","Tools","Constants","DatepickerFactory","MessengerService","FilesService","DateService","initialData","AttachmentsService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){c.addPart("person"),d.refresh(),a.person=p.person,a.person.id?(a.person.company=a.person.companies_id?[{id:a.person.companies_id,name:a.person.company_name}]:[],a.person.positionBox=a.person.position_id?[{id:a.person.position_id,name:a.person.position}]:[],a.person.roleBox=a.person.role_id?[{id:a.person.role_id,name:a.person.role}]:[]):(a.person.company=[],a.person.positionBox=[],a.person.roleBox=[]),a.showOnPage="",a.pageAncestor={},a.pills=[{name:"INTRO",hide:function(){return!0}},{name:"PERSONAL"},{name:"CONTACTS"},{name:"COMPANY"},{name:"NOTES",hide:function(){return!0}},{name:"RESPONSIBILITY",hide:function(){return!a.person.teamMember}},{name:"AGENDA"}],a.activePillsIndex=1,a.pills_contacts=[{name:"BUSINESS"},{name:"HOME"},{name:"OTHER"}],a.localDataCountries=p.countries,a.validateZip=j.validateZip,a.validatePhone=j.validatePhone,a.validateEmail=j.validateEmail,a.loadDataForAgendaList=f.listForAgenda,a.pictureFile={},a.isPictureChange=!1,a.inProcess=!1,a.uploadPictureConfig={},a.dataForAgenda={},a.uploadPicture=function(){n.uploadFile(a.pictureFile,a.uploadPictureConfig)},a.initButtons=function(){var b={};a.actionButtons=[{name:"DELETE",dropDown:[{name:"DELETE_THIS_PERSON",onClick:a.del,disabled:function(){return!a.person.id}}],disabled:!a.person.id},{name:"CANCEL",onClick:a.pageAncestor.cancel,disabled:function(){return!a.pageAncestor.log.changes.isChanged}}],b=a.person.id?{name:"SAVE",onClick:a.put,disabled:function(){return a.inProcess}}:{name:"SAVE",onClick:a.post,disabled:function(){return a.inProcess}},a.actionButtons.push(b)},a.put=function(){a.person.company_name=a.person.company[0]?a.person.company[0].name:"",a.verifyForm()&&(a.person.birthday=o.setDateAsUTC0(a.person.birthday),a.person.anniversary=o.setDateAsUTC0(a.person.anniversary),a.pageAncestor.put(function(){return f.put(a.person).then(function(b){return a.person.companies_id=b.data.companies_id,a.person.position_id=b.data.position_id,a.person.role_id=b.data.role_id,e(function(){var a;a=i.getInstance(),a.clear()},400),b})}))},a.post=function(){a.person.company_name=a.person.company[0]?a.person.company[0].name:"",a.verifyForm()&&(a.person.birthday=o.setDateAsUTC0(a.person.birthday),a.person.anniversary=o.setDateAsUTC0(a.person.anniversary),a.pageAncestor.post(function(){return f.post(a.person).then(function(c){return c.data.id&&b.path((a.person.teamMember?"/team-member/":"/person/")+c.data.id),c})}))},a.del=function(){a.pageAncestor.del(function(){return f.del(a.person).then(function(a){return a.data.id?b.path("/person/"+a.data.id):b.path("/people"),a})})},a.verifyForm=function(){var b,c,d,e=!0,f=[];for(f.push({message:"WARNING_FIELD_VALUE_INVALID"}),a.person.home_addr_zip&&!j.validateZip(a.person.home_addr_zip)&&(e=!1,f.push({message:"ZIP"})),a.person.email&&!j.validateEmail(a.person.email)&&(e=!1,f.push({message:"EMAIL"})),a.person.email2&&!j.validateEmail(a.person.email2)&&(e=!1,f.push({message:"EMAIL2"})),a.person.mobile_phone&&!j.validatePhone(a.person.mobile_phone)&&(e=!1,f.push({message:"MOBILE_PHONE"})),a.person.business_phone&&!j.validatePhone(a.person.business_phone)&&(e=!1,f.push({message:"BUSINESS_PHONE"})),a.person.home_phone&&!j.validatePhone(a.person.home_phone)&&(e=!1,f.push({message:"HOME_PHONE"})),a.person.assistant_phone&&!j.validatePhone(a.person.assistant_phone)&&(e=!1,f.push({message:"COMPANY_PHONE"})),a.person.other_phone&&!j.validatePhone(a.person.other_phone)&&(e=!1,f.push({message:"OTHER_PHONE"})),a.person.fax&&!j.validatePhone(a.person.fax)&&(e=!1,f.push({message:"FAX"})),d=$("#BIRTHDAY").val(),d&&!j.validateDate(d,null)&&(e=!1,f.push({message:"BIRTHDAY"})),d=$("#ANNIVERSARY").val(),d&&!j.validateDate(d,null)&&(e=!1,f.push({message:"ANNIVERSARY"})),d=$("#SINCE").val(),d&&!j.validateDate(d,null)&&(e=!1,f.push({message:"SINCE"})),!a.person.home_addr_country&&$("#XXC4b_value").val()&&(e=!1,f.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"COUNTRY"})),$("#XXB1_value").val()&&!a.person.company[0]&&(e=!1,f.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"COMPANY"})),$("#XXB2_value").val()&&!a.person.positionBox[0]&&(e=!1,f.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"POSITION"})),$("#XXB3_value").val()&&!a.person.roleBox[0]&&(e=!1,f.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"ROLE"})),b=0,c=f.length;c>b;b+=1)b>1&&(f[b].prefix=", ");return e||a.pageAncestor.addAlert({type:k.MESSAGE_WARNING_VALIDATION_BEFORE_CRUD,messages:f}),e},a.createAppointment=function(){var c=[{id:a.person.id,name:a.person.first_name+" "+a.person.last_name}];m.setData(a.person.is_team_member?{teamReminderMembers:c}:{attendeeReminderMembers:c}),b.path("/appointment")},a.selectFile=function(b){a.pictureFile=b,a.isPictureChange=!0},a.removePicture=function(){a.isPictureChange=a.person.pictureId?!0:!1,a.pictureFile={}},a.showSavePictureAnchor=function(){return a.isPictureChange&&(a.pictureFile&&a.pictureFile.name?!0:!1)&&!a.inProcess},a.showDeletePictureAnchor=function(){return a.isPictureChange&&!(a.pictureFile&&a.pictureFile.name)&&!a.inProcess},a.showRemovePictureAnchor=function(){return a.person.pictureId&&!a.isPictureChange||(a.pictureFile&&a.pictureFile.name?!0:!1)},a.getPersonPicture=function(){var b=null;return b=Object.keys(a.pictureFile||{}).length>0?"pictureFile":a.person.pictureId&&!a.isPictureChange?"/api/attachments/"+a.person.pictureId:k.EMPTY_PERSON_PICTURE},a.afterUploadPersonPicture=function(b){a.isPictureChange=!1,a.person.pictureId=b.data.id,a.uploadPictureConfig.data.id=b.data.id,a.inProcess=!1},a.initPictureConfig=function(){a.uploadPictureConfig={url:"/api/people/"+a.person.id+"/picture/upload",errorMsg:"",callback:a.afterUploadPersonPicture,data:{table:k.ATTACHMENTS_TYPES.PEOPLE,id:a.person.pictureId}}},a.deletePicture=function(){var b={id:a.person.pictureId};q.del(b).then(function(){a.person.pictureId=null,a.isPictureChange=!1,a.inProcess=!1})},a.initDataForAgenda=function(){a.dataForAgenda.appointment={},a.dataForAgenda.appointment.attendeeReminderMembers=[{id:a.person.id,name:a.person.first_name+" "+a.person.last_name}],a.dataForAgenda.task={},a.dataForAgenda.task.person=[{id:a.person.id,name:a.person.first_name+" "+a.person.last_name}]},a.calculateBirthday=function(){var b=o.setDateAfterToday(a.person.birthday);a.person.birthdayYears=o.getAge(a.person.birthday),a.person.daysBirth=o.getDaysToDate(b)},a.calculateAnniversary=function(){var b=o.setDateAfterToday(a.person.anniversary);a.person.daysAnniv=o.getDaysToDate(b)},a.pageAncestor=g.getInstance(),a.pageAncestor.init({scope:a,formObject:"person",table:"PEOPLE"}),a.dp=l.getInstance(),a.dp.init(a),a.initButtons(),a.initPictureConfig(),a.initDataForAgenda(),a.calculateBirthday(),a.calculateAnniversary()}]),angular.module("crmPostgresWebApp").service("Admin",["$http",function(a){return{createUser:function(b){a.post("/api/user/create").success(function(a){b(a.message)})}}}]),angular.module("crmPostgresWebApp").service("PeopleService",["$http","Tools","AlertsService","Constants",function(a,b,c,d){return{list:function(c){return a.get("/api/people?"+b.objectToQueryString(c)).error(function(a){console.log(a)})},get:function(b){return a.get("/api/people/"+b,{cache:!1}).error(function(a){console.log(a)})},put:function(b){return a.put("/api/people/"+b.id,b).error(function(a){console.log(a)})},post:function(b){return a.post("/api/people",b).error(function(a){console.log(a)})},del:function(b){return a["delete"]("/api/people/"+b.id).error(function(a){console.log(a)})},homeAddress:function(){return a.get("/api/people/login-user/home-address",{cache:!1}).error(function(a){console.log(a)})},businessAddress:function(){return a.get("/api/people/login-user/business-address",{cache:!1}).error(function(a){console.log(a)})},latestAddress:function(){return a.get("/api/people/login-user/latest-address",{cache:!1}).error(function(a){console.log(a)})},loginUser:function(){return a.get("/api/people/login-user/all",{cache:!1}).error(function(a){console.log(a)})},loginUserEmails:function(){return a.get("/api/people/login-user/emails",{cache:!1}).error(function(a){console.log(a)})},teamMembersList:function(c){return a.get("/api/team-members?"+b.objectToQueryString(c)).error(function(a){console.log(a)})},searchGlobal:function(b){return a.get("/api/people/search-all/"+b.str).error(function(a){console.log(a)})},searchGlobalTeam:function(b){return a.get("/api/people/team/search-all/"+b.str).error(function(a){console.log(a)})},listForAgenda:function(e){return a.get("/api/agenda/list/person/"+e.id+"?"+b.objectToQueryString(e),{cache:!1}).then(function(a){var b=a.data.message;return b&&b.type===d.MESSAGE_ERROR_MODAL&&c.add({type:b.type,message:b.msg}),a})},anniversaryCount:function(){return a.get("/api/people/anniversary/count",{cache:!1}).error(function(a){console.log(a)})},anniversaryToday:function(){return a.get("/api/people/anniversary/list/today/",{cache:!1}).error(function(a){console.log(a)})},anniversaryTomorrow:function(){return a.get("/api/people/anniversary/list/tomorrow/",{cache:!1}).error(function(a){console.log(a)})},anniversaryAfterTomorrow:function(){return a.get("/api/people/anniversary/list/aftertomorrow/",{cache:!1}).error(function(a){console.log(a)})},anniversaryNextDays:function(){return a.get("/api/people/anniversary/list/nextdays/",{cache:!1}).error(function(a){console.log(a)})}}}]),angular.module("crmPostgresWebApp").controller("SalesPipelineCtrl",["$scope","$translate","$location","$translatePartialLoader","SalesPipelineService","SalesPipelineStagesService","initialData",function(a,b,c,d,e,f,g){d.addPart("sales_pipeline"),b.refresh(),a.searchStr="",a.dataLoader=e.list,a.dataLoaderSummary=e.list,a.dataLoaderParams={filter:{},sortField:"company_name",sortDirection:"asc"},a.infoPaging=[],a.stages=g.stages,a.stagesRows=g.stagesRows,a.rowsInStage=10,a.defaultCollapse=!1,a.owners=[],a.init=function(){a.loadOwnersForStages(),a.loadAllStages(),a.initInfoPaging()},a.findStage=function(b){var c,d;for(c=0,d=a.stages.length;d>c;c+=1)if(a.stages[c].id===String(b))return a.stages[c];return{}},a.loadCurrentStage=function(b){a.stagesRows[b.id]||(a.stagesRows[b.id]={}),e.list({id:b.id,amount:a.rowsInStage}).then(function(c){a.stagesRows[b.id].rows=c.data,a.stagesRows[b.id].collapse=a.defaultCollapse})},a.loadOwnersForStages=function(){f.owners().then(function(b){a.owners=[],a.owners.push({peoplename:"Všechny",owner_id:"-1"}),a.dataLoaderParams.filter.owner=a.owners[0];var c,d;for(c=0,d=b.data.length;d>c;c+=1)a.owners.push(b.data[c])})},a.loadAllStages=function(){var b,c;for(b=0,c=a.stages.length;c>b;b+=1)a.loadCurrentStage({id:a.stages[b].id})},a.toggleStages=function(b){a.stagesRows[b]&&(a.stagesRows[b].collapse=!a.stagesRows[b].collapse)},a.setOwner=function(b){a.dataLoaderParams.filter.owner=b},a.initInfoPaging=function(){var b,c;for(b=0,c=a.stages.length;c>b;b+=1)a.infoPaging[a.stages[b].id]={}},a.viewOpportunities=function(){c.path("/opportunities")},a.init()}]),angular.module("crmPostgresWebApp").controller("TasksCtrl",["$scope","$location","$translatePartialLoader","$translate","TasksService","Constants","MessengerService",function(a,b,c,d,e,f,g){c.addPart("tasks"),d.refresh();var h=g.getData();a.tasks=[],a.searchStr="",a.dataLoaderParams={filter:{},sortField:"subject",sortDirection:"asc"},a.dataLoaderParams.filter.type=h&&h.tasks&&h.tasks.filter?h.tasks.filter.type:-1,a.infoPaging={},a.types=[f.TASK.FILTER.OLD,f.TASK.FILTER.TODAY,f.TASK.FILTER.TOMORROW,f.TASK.FILTER.NEW],a.typesList=[{ID:-1,NAME:"ALL"}],a.typesList=a.typesList.concat(a.types),a.setSearch=function(b){13===b.which&&(a.dataLoaderParams.searchStr=a.searchStr)},a.newTask=function(){b.path("/task")},a.getType=function(){return a.typesList.filter(function(b){return b.ID===a.dataLoaderParams.filter.type})[0]},a.dataLoader=e.list}]),angular.module("crmPostgresWebApp").controller("TeamCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("crmPostgresWebApp").controller("ConfigCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("crmPostgresWebApp").directive("paginationNotia",["$timeout","usSpinnerService",function(a,b){return{templateUrl:"views/directives/d_pagination.html",restrict:"E",scope:{loadData:"=",loadDataParams:"=",loadDataParamsRuntime:"=",listData:"=",buttonAll:"=",amount:"=",info:"=",refresh:"=?",loadDataCallback:"=?"},link:function(c,d,e){c.info?(c.info.inProcess=!1,c.info.summary={},c.info.inProcessCount=!1):c.info={inProcess:!1,summary:{},inProcessCount:!1},c.getPagingDefault=function(){var a={page:1,amount:c.amount||"10",count:0,pageCount:1};return a},c.paging=c.getPagingDefault(),c.getLoadDataParams=function(a){var b={};return $.extend(b,c.paging),$.extend(b,c.loadDataParams),$.extend(b,c.loadDataParamsRuntime),$.extend(b,a),b},c.loadCount=function(){0===c.paging.count&&(c.info.inProcessCount=!0,c.startSpin(),c.loadData(c.getLoadDataParams({loadCount:1})).then(function(a){c.info.inProcessCount=!1,c.stopSpin(),a.data&&(c.paging.count=parseInt(a.data.count,10),c.paging.pageCount=Math.ceil(parseInt(a.data.count,10)/c.paging.amount),c.info.summary=a.data)},function(){c.info.inProcessCount=!1}))},c.load=function(a){c.info.inProcess||(c.info.inProcess=!0,c.loadData(c.getLoadDataParams()).then(function(a){c.info.inProcess=!1,c.listData.splice(0,c.listData.length),a.data&&a.data.length>0&&a.data.map&&a.data.map(function(a){c.listData.push(a)}),c.loadDataCallback&&c.loadDataCallback()},function(){c.info.inProcessCount=!1}),a&&(c.paging=c.getPagingDefault(),c.loadCount()))},c.next=function(){c.info.inProcess||c.paging.pageCount>c.paging.page&&(c.paging.page+=1,c.load())},c.prior=function(a){c.info.inProcess||c.paging.page>1&&(c.paging.page-=1,c.load())},c.all=function(){c.paging.pageCount>1&&(c.paging.page=1,c.paging.amount=9999,c.paging.pageCount=1,c.load())},c.startSpin=function(){b.spin("spinner-paging")},c.stopSpin=function(){b.stop("spinner-paging")},c.timerLoadData=null,c.$watch("loadDataParams",function(b,d){if(b!==d){var e=b.searchStr!==d.searchStr||JSON.stringify(b.filter)!==JSON.stringify(d.filter);a.cancel(c.timerLoadData),c.timerLoadData=a(function(){c.load(e||c.loadDataParams&&c.loadDataParams.loadCount)},500)}},!0),c.refresh=function(){c.load(!0)},c.load(!0)}}}]),angular.module("crmPostgresWebApp").service("Constants",function(){return{ATTACHMENTS_TYPES:{APPOINTMENT:"APPOINTMENT",COMPANY:"COMPANY",OPPORTUNITY:"OPPORTUNITY",ANY:"ANY",PEOPLE:"PEOPLE",PRODUCT:"PRODUCT"},LANGUAGE_KEYS:["cs-cz","en-us","sk-sk"],TASK:{FILTER:{OLD:{ID:0,NAME:"BEFORE_AND_UNFULFILLED"},TODAY:{ID:1,NAME:"TODAY"},TOMORROW:{ID:2,NAME:"TOMORROW"},NEW:{ID:3,NAME:"LATER"}}},PEOPLE:{FILTER:{UPCOMING_ANNIVERSARY:{ID:0,NAME:"UPCOMING_ANNIVERSARY"}}},COMPANIES:{FILTER:{OPEN_OPPORTUNITIES:{ID:0,NAME:"OPEN_OPPORTUNITIES"}}},APPOINTMENTS:{FILTER:{FUTURE:{ID:0,NAME:"FUTURE"},PAST:{ID:1,NAME:"PAST"}}},OPPORTUNITIES:{FILTER:{OPEN:{ID:1,NAME:"OPPORTUNITY_STATUS_OPEN",FILTER:"TYPE"},SUCCESS:{ID:2,NAME:"OPPORTUNITY_STATUS_SUCCESS",FILTER:"TYPE"},FAILURE:{ID:3,NAME:"OPPORTUNITY_STATUS_FAILED",FILTER:"TYPE"}}},CRUD_POST:"POST",CRUD_PUT:"PUT",CRUD_DELETE:"DELETE",MESSAGE_INFO:"INFO",MESSAGE_SUCCESS:"SUCCESS",MESSAGE_WARNING:"WARNING",MESSAGE_ERROR:"ERROR",MESSAGE_WARNING_VALIDATION_BEFORE_CRUD:"WARNING_VALIDATION_BEFORE_CRUD",MESSAGE_WARNING_VALIDATION_PIPELINE_STAGE_NOT_FOUND:"VALIDATION_PIPELINE_STAGE_NOT_FOUND",MESSAGE_CONNECTION_LOST:"CONNECTION_LOST",MESSAGE_INFO_MODAL:"INFO_MODAL",MESSAGE_SUCCESS_MODAL:"SUCCESS_MODAL",MESSAGE_WARNING_MODAL:"WARNING_MODAL",MESSAGE_WARNING_MODAL_CONN_LOST:"WARNING_MODAL_CONN_LOST",MESSAGE_INFO_IMPORT_CSV:"INFO_IMPORT_CSV",MESSAGE_ERROR_MODAL:"ERROR_MODAL",MESSAGE_EXEC_REVOKE_PEOPLE:"REVOKE_PEOPLE",MESSAGE_EXEC_REVOKE_PEOPLE_SUCCESS:"REVOKE_PEOPLE_SUCCESS",MESSAGE_EXEC_REVOKE_PEOPLE_ERROR:"REVOKE_PEOPLE_ERROR",MESSAGE_EXEC_DELETE_ITEM:"INFO_RECORD_DELETE_ITEM_CONFIRM",MESSAGE_EXEC_DELETE_ITEM_SUCCESS:"INFO_RECORD_DELETE_ITEM_SUCCESS",MESSAGE_EXEC_DELETE_ITEM_ERROR:"INFO_RECORD_DELETE_ITEM_ERROR",MESSAGE_EXEC_REPLACE_STAGE_AND_DELETE:"INFO_REPLACE_STAGE_AND_DELETE_CONFIRM",MESSAGE_EXEC_REPLACE_STAGE_AND_DELETE_SUCCESS:"INFO_REPLACE_STAGE_AND_DELETE_CONFIRM_SUCCESS",MESSAGE_EXEC_REPLACE_STAGE_AND_DELETE_ERROR:"INFO_REPLACE_STAGE_AND_DELETE_CONFIRM_ERROR",MESSAGE_TEXTAREA_OVERFLOW:"WARNING_TEXTAREA_OVERFLOW",MESSAGE_TEXT_CONNECTION_SOON_LOST:"CONNECTION_SOON_LOST",MESSAGE_TEXT_CONNECTION_SOON_LOST2:"CONNECTION_SOON_LOST2",MESSAGE_TEXT_CONNECTION_SOON_LOST3:"CONNECTION_SOON_LOST3",MESSAGE_TEXT_CONNECTION_SOON_LOST_TITLE:"CONNECTION_SOON_LOST_TITLE",MESSAGE_TEXT_CONNECTION_LOST:"CONNECTION_LOST_WITH_TIMEOUT",MESSAGE_TEXT_OPPORTUNITY_STATUS_SUCCESS_SUCCESS:"OPPORTUNITY_STATUS_SUCCESS_SUCCESS",MESSAGE_TEXT_OPPORTUNITY_STATUS_FAILED_SUCCESS:"OPPORTUNITY_STATUS_FAILED_SUCCESS",MESSAGE_TEXT_OPPORTUNITY_OPEN_CLOSED_SUCCESS:"OPPORTUNITY_OPEN_CLOSED_SUCCESS",MESSAGE_TEXT_YES:"YES",MESSAGE_TEXT_NO:"NO",TYPE_CALENDAR_EVENT_REMINDER:"REMINDER",TYPE_CALENDAR_EVENT_APPOINTMENT:"APPOINTMENT",FULLCALENDAR_WEEK_AGENDA:"agendaWeek",TIMELINE_DATE_CURRENT:"TODAY",TIMELINE_DATE_PRIOR:"YESTERDAY",TIMELINE_DATE_NEXT:"TOMORROW",AGENDA_TYPE_APPOINTMENT_PHONE_CALL:"APPOINTMENT_PHONE_CALL",AGENDA_TYPE_APPOINTMENT_BUSINESS_MEETING:"APPOINTMENT_BUSINESS_MEETING",AGENDA_TYPE_APPOINTMENT_OTHER:"APPOINTMENT_OTHER",AGENDA_TYPE_APPOINTMENT_ALL_DAY_EVENT:"APPOINTMENT_ALL_DAY_EVENT",AGENDA_TYPE_APPOINTMENT:"APPOINTMENT",AGENDA_TYPE_TASK:"TASK",AGENDA_TYPE_REMINDER:"REMINDER",AGENDA_TYPE_BIRTHDAY:"BIRTHDAY",AGENDA_TYPE_ANNIVERSARY:"ANNIVERSARY",PRIORITY:[{id:0,name:"LOW"},{id:1,name:"MEDIUM"},{id:2,name:"HIGH"}],CONNECTION_LOST_TIME_LOGOUT:6e4,APPOINTMENT_TYPES:{PHONE_CALL:1,ALL_DAY_EVENT:2,BUSINESS_MEETING:3,OTHER_APPOINTMENT:4},SEARCH_STR_LENGTH:"SEARCH_STR_LENGTH",ROUTES:{LOGIN:"/login",PERSON:"/person/",PROJECT:"/project/",TASKS:"/tasks/",TASK:"/task/",OPPORTUNITY:"/opportunity/",APPOINTMENT:"/appointment/",COMPANY:"/company/",COMPANIES_IMPORT:"/companies-import/"},EMPTY_PERSON_PICTURE:"/images/avatar-unisex.png",EMPTY_PRODUCT_PICTURE:"/images/no-picture.png",IMPORT_CSV_FILE_SIZE_LIMIT:"100MB",OPPORTUNITY_STATUS:{OPEN:{ID:0,NAME:"OPPORTUNITY_STATUS_OPEN"},SUCCESS:{ID:1,NAME:"OPPORTUNITY_STATUS_SUCCESS"},FAILED:{ID:2,NAME:"OPPORTUNITY_STATUS_FAILED"}},MESSAGE_EXEC_DELETE_TEXT:"INFO_DELETE_TEXT_CONFIRM",MESSAGE_EXEC_DELETE_TEXT_SUCCESS:"INFO_DELETE_TEXT_CONFIRM_SUCCESS",MESSAGE_EXEC_DELETE_TEXT_ERROR:"INFO_DELETE_TEXT_CONFIRM_ERROR"}}),angular.module("crmPostgresWebApp").service("Meta",["$rootScope","UsersService","Tools",function(a,b,c){var d=null;return{setMetaInformations:function(){return d?null:b.get().then(function(b){return a.meta={title:b.data.loginName,language:b.data.language,ownerId:b.data.id,ownerName:b.data.ownerName,version:"v"+b.data.version||"v000",env:b.data.env},b.data.language&&(d=!0),c.setLanguage(b.data.language||"en-us")})}}}]),angular.module("crmPostgresWebApp").directive("footer",function(){return{templateUrl:"views/directives/d_footer.html",restrict:"E"}}),angular.module("crmPostgresWebApp").controller("TestCtrl",["$scope","$translate","$translatePartialLoader","$rootScope","$timeout","CountriesService","PageAncestor","DateService","CompaniesService","$locale","DatepickerFactory",function(a,b,c,d,e,f,g,h,i,j,k){c.addPart("test"),b.refresh(),a.boxItems=[],a.box="",a.countries=[],a.form={},a.datum=null,a.datumStr="",a.localData=[{id:1,name:"Martin Boháč"},{id:2,name:"Iva Hlinková"}],a.tmpSearch={},a.dt=(new Date).toISOString(),a.dp=k.getInstance(),a.dp.init(a),a.test=function(b){a.testm2=b.which},a.dateToWord=function(b,c){13===b.keyCode&&(a.datum=h.wordFromDateRange(h.strToDate(c),h.strToDate("7.8.2014")))},a.setDatepicker=function(){console.log("setDatepicker"),angular.bootstrap()},a.getCountries=function(){f.list().then(function(b){a.countries=b.data})},a.save=function(){g.post(function(){return e(function(){console.log("POST")},1e3)})},a.del=function(){g.del(function(){return e(function(){console.log("DELETE")},1e3)})},a.getCountries(),g.init({scope:a,formObject:"form",table:"TEST"}),d.$on("$translateChangeSuccess",function(b,c,d){
a.getCountries()})}]),angular.module("crmPostgresWebApp").service("CountriesService",["$http",function(a){return{list:function(){return a.get("/api/countries/").error(function(a){console.log(a)})}}}]),angular.module("crmPostgresWebApp").controller("CompanyCtrl",["$scope","$location","$translatePartialLoader","$translate","CompaniesService","PageAncestor","initialData","Tools","Constants","MessengerService","PeopleService","PeopleCompaniesService","usSpinnerService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){c.addPart("company"),d.refresh(),a.company=g.company,a.company.person={roleBox:[],positionBox:[]},a.people=[],a.opportunities=[],a.addressFields=["address_tag_@","address_street_@","address_city_@","address_region_@","address_zip_@","address_country_@","phone_1_@","phone_1_@_tag","phone_2_@","phone_2_@_tag","phone_3_@","phone_3_@_tag","email_1_@","email_1_@_tag","email_2_@","email_2_@_tag","email_3_@","email_3_@_tag","fax_1_@","fax_1_@_tag","fax_2_@","fax_2_@_tag","website_@","google_@","facebook_@","twitter_@"],a.addressActive=1,a.address=[],a.phone={items:[]},a.email={items:[]},a.fax={items:[]},a.pills=[{name:"INTRO",hide:function(){return!0}},{name:"CLASSIFICATION"},{name:"AGENDA"},{name:"INFO",hide:function(){return!0}},{name:"PLACES",dropDown:[{name:a.company.address_tag_1},{name:a.company.address_tag_2},{name:a.company.address_tag_3}]},{name:"PEOPLE",disabled:a.company.id?!1:!0},{name:"TIMELINE",hide:function(){return!0}},{name:"SETTINGS",hide:function(){return!0}},{name:"OPPORTUNITIES",disabled:a.company.id?!1:!0},{name:"SALES",disabled:a.company.id?!1:!0},{name:"ATTACHMENTS",disabled:a.company.id?!1:!0}],a.activePillsIndex=1,a.peoplePaging={},a.peoplePaging.infoPaging={},a.peoplePaging.dataLoader=e.people,a.peoplePaging.dataLoaderParams={sortField:"subject",sortDirection:"asc",loadCount:!0},a.opportunitiesPaging={},a.opportunitiesPaging.infoPaging={},a.opportunitiesPaging.dataLoader=e.opportunities,a.opportunitiesPaging.dataLoaderParams={sortField:"created",sortDirection:"asc",loadCount:!0},a.pageAncestor={},a.localDataCountries=g.countries,a.addressCountry1="",a.addressCountry2="",a.addressCountry3="",a.validatePhone=h.validatePhone,a.validateEmail=h.validateEmail,a.ratingMax=5,a.ratingIsReadonly=!1,a.actionButtons=[],a.showPersonForm=!1,a.selectedPeopleObj={},a.selectedPeople={},a.loadDataForAgendaList=e.listForAgenda,a.dataForAgenda={},a.attachmentsTable=i.ATTACHMENTS_TYPES.COMPANY,a.initButtons=function(){var b={};a.actionButtons=[{name:"DELETE",dropDown:[{name:"DELETE_COMPANY",onClick:a.del,disabled:function(){return!a.company.id}},{name:"DELETE_COMPANY_ADDRESS",onClick:a.deleteAddressConfirm,disabled:function(){return 0===a.address.length}}],disabled:!a.company.id},{name:"CANCEL",onClick:a.pageAncestor.cancel,disabled:function(){return!a.pageAncestor.log.changes.isChanged}}],b=a.company.id?{name:"SAVE",onClick:a.put,disabled:function(){return!1}}:{name:"SAVE",onClick:a.post,disabled:function(){return!1}},a.actionButtons.push(b)},a.initAbstractFields=function(){a.setAbstractField(a.phone,"phone",3),a.setAbstractField(a.email,"email",3),a.setAbstractField(a.fax,"fax",2)},a.initAbstractFieldsAll=function(){a.setNavbarAddress(),a.initAbstractFields()},a.showAddressPlus=function(){return(!a.existsAddress(1)||!a.existsAddress(2))&&a.existsAddress(0)},a.deleteAddress=function(){var b,c;for(b=0,c=a.addressFields.length;c>b;b+=1)a.company[a.addressFields[b].replace(/@/g,a.addressActive)]=null;a.setNavbarAddress(),a.addressActive=a.address.length},a.deleteAddressConfirm=function(){var b,c=[{},{}];b=function(){a.deleteAddress()},c[0].name="OK",c[0].onClick=b,c[1].name="STORNO",c[1].onClick=null,a.pageAncestor.addAlert({type:i.MESSAGE_WARNING_MODAL,message:"INFO_RECORD_ADDRESS_DELETE",title:"WARNING",buttons:c})},a.existsAddress=function(b){var c,d,e="";for(c=0,d=a.addressFields.length;d>c;c+=1)a.company[a.addressFields[c].replace(/@/g,b+1)]&&(e+=a.company[a.addressFields[c].replace(/@/g,b+1)]);return e.length>0},a.setActiveAddress=function(b){a.addressActive=b+1,a.initAbstractFields()},a.addAddressNavbar=function(){a.setNavbarAddress(),a.setActiveAddress(a.address.length)},a.post=function(){a.verifyForm()&&(a.setDefault(),a.pageAncestor.post(function(){return e.post(a.company).then(function(a){return a.data.id&&b.path("/company/"+a.data.id),a})}))},a.put=function(){a.verifyForm()&&(a.setDefault(),a.pageAncestor.put(function(){return e.put(a.company).then(function(b){return a.initAbstractFieldsAll(),b})}))},a.del=function(){a.pageAncestor.del(function(){return e.del(a.company).then(function(a){return a.data&&a.data.message&&a.data.message.type===i.MESSAGE_SUCCESS&&(a.data.id?b.path("/company/"+a.data.id):b.path("/companies")),a})})},a.addressMove=function(b,c){var d,e;for(d=0,e=a.addressFields.length;e>d;d+=1)a.company[a.addressFields[d].replace(/@/g,c)]=a.company[a.addressFields[d].replace(/@/g,b)],a.company[a.addressFields[d].replace(/@/g,b)]=null},a.moveDataWithTag=function(b,c,d){a.company[b+"_"+d+"_"+a.addressActive]=a.company[b+"_"+c+"_"+a.addressActive],a.company[b+"_"+d+"_"+a.addressActive+"_tag"]=a.company[b+"_"+c+"_"+a.addressActive+"_tag"],a.company[b+"_"+c+"_"+a.addressActive]=null,a.company[b+"_"+c+"_"+a.addressActive+"_tag"]=null},a.setNavbarAddress=function(){a.address=[],a.existsAddress(0)?a.address.push({name:a.company.address_tag_1||"1"}):a.existsAddress(1)&&a.addressMove(2,1),a.existsAddress(1)?a.address.push({name:a.company.address_tag_2||"2"}):a.existsAddress(2)&&a.addressMove(3,2),a.existsAddress(2)&&a.address.push({name:a.company.address_tag_3||"3"})},a.setAbstractField=function(b,c,d){var e;for(b.items=[1],e=1;d>=e;e+=1)a.company[c+"_"+e+"_"+a.addressActive]?b.items[e-1]=e:a.company[c+"_"+(e+1)+"_"+a.addressActive]&&(a.moveDataWithTag(c,e+1,e),b.items[e-1]=e)},a.addAbstractField=function(a,b,c){c&&a.items.length<b&&(a.items[a.items.length]=a.items.length+1)},a.deleteFieldWithTag=function(b,c,d,e){e&&(d>0?b.items.splice(d,1):b.items[0]=null,a.company[c+"_"+(d+1)+"_"+a.addressActive]=null,a.company[c+"_"+(d+1)+"_"+a.addressActive+"_tag"]=null)},a.verifyForm=function(){var b,c,d=!0,e=[];for(e.push({message:"WARNING_FIELD_VALUE_INVALID"}),a.company.company_name||(d=!1,e.push({message:"COMPANY_NAME"})),!a.company.address_country_1&&$("#XXX8_value").val()&&(d=!1,e.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"COUNTRY"})),!a.company.address_country_2&&$("#XXX82_value").val()&&(d=!1,e.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"COUNTRY"})),!a.company.address_country_3&&$("#XXX83_value").val()&&(d=!1,e.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"COUNTRY"})),a.company.email_1_1&&!h.validateEmail(a.company.email_1_1)&&(d=!1,e.push({message:"EMAIL",sufix:"1 (adresa: "+a.company.address_tag_1+")"})),a.company.email_2_1&&!h.validateEmail(a.company.email_2_1)&&(d=!1,e.push({message:"EMAIL",sufix:"2 (adresa: "+a.company.address_tag_1+")"})),a.company.email_3_1&&!h.validateEmail(a.company.email_3_1)&&(d=!1,e.push({message:"EMAIL",sufix:"3 (adresa: "+a.company.address_tag_1+")"})),a.company.email_1_2&&!h.validateEmail(a.company.email_1_2)&&(d=!1,e.push({message:"EMAIL",sufix:"1 (adresa: "+a.company.address_tag_2+")"})),a.company.email_2_2&&!h.validateEmail(a.company.email_2_2)&&(d=!1,e.push({message:"EMAIL",sufix:"2 (adresa: "+a.company.address_tag_2+")"})),a.company.email_3_2&&!h.validateEmail(a.company.email_3_2)&&(d=!1,e.push({message:"EMAIL",sufix:"3 (adresa: "+a.company.address_tag_2+")"})),a.company.email_1_3&&!h.validateEmail(a.company.email_1_3)&&(d=!1,e.push({message:"EMAIL",sufix:"1 (adresa: "+a.company.address_tag_3+")"})),a.company.email_2_3&&!h.validateEmail(a.company.email_2_3)&&(d=!1,e.push({message:"EMAIL",sufix:"2 (adresa: "+a.company.address_tag_3+")"})),a.company.email_3_3&&!h.validateEmail(a.company.email_3_3)&&(d=!1,e.push({message:"EMAIL",sufix:"3 (adresa: "+a.company.address_tag_3+")"})),a.company.phone_1_1&&!h.validatePhone(a.company.phone_1_1)&&(d=!1,e.push({message:"PHONE",sufix:"1 (adresa: "+a.company.address_tag_1+")"})),a.company.phone_2_1&&!h.validatePhone(a.company.phone_2_1)&&(d=!1,e.push({message:"PHONE",sufix:"2 (adresa: "+a.company.address_tag_1+")"})),a.company.phone_3_1&&!h.validatePhone(a.company.phone_3_1)&&(d=!1,e.push({message:"PHONE",sufix:"3 (adresa: "+a.company.address_tag_1+")"})),a.company.phone_1_2&&!h.validatePhone(a.company.phone_1_2)&&(d=!1,e.push({message:"PHONE",sufix:"1 (adresa: "+a.company.address_tag_2+")"})),a.company.phone_2_2&&!h.validatePhone(a.company.phone_2_2)&&(d=!1,e.push({message:"PHONE",sufix:"2 (adresa: "+a.company.address_tag_2+")"})),a.company.phone_3_2&&!h.validatePhone(a.company.phone_3_2)&&(d=!1,e.push({message:"PHONE",sufix:"3 (adresa: "+a.company.address_tag_2+")"})),a.company.phone_1_3&&!h.validatePhone(a.company.phone_1_3)&&(d=!1,e.push({message:"PHONE",sufix:"1 (adresa: "+a.company.address_tag_3+")"})),a.company.phone_2_3&&!h.validatePhone(a.company.phone_2_3)&&(d=!1,e.push({message:"PHONE",sufix:"2 (adresa: "+a.company.address_tag_3+")"})),a.company.phone_3_3&&!h.validatePhone(a.company.phone_3_3)&&(d=!1,e.push({message:"PHONE",sufix:"3 (adresa: "+a.company.address_tag_3+")"})),a.company.fax_1_1&&!h.validatePhone(a.company.fax_1_1)&&(d=!1,e.push({message:"FAX",sufix:"1 (adresa: "+a.company.address_tag_1+")"})),a.company.fax_2_1&&!h.validatePhone(a.company.fax_2_1)&&(d=!1,e.push({message:"FAX",sufix:"2 (adresa: "+a.company.address_tag_1+")"})),a.company.fax_1_2&&!h.validatePhone(a.company.fax_1_2)&&(d=!1,e.push({message:"FAX",sufix:"1 (adresa: "+a.company.address_tag_2+")"})),a.company.fax_2_2&&!h.validatePhone(a.company.fax_2_2)&&(d=!1,e.push({message:"FAX",sufix:"2 (adresa: "+a.company.address_tag_2+")"})),a.company.fax_1_3&&!h.validatePhone(a.company.fax_1_3)&&(d=!1,e.push({message:"FAX",sufix:"1 (adresa: "+a.company.address_tag_3+")"})),a.company.fax_2_3&&!h.validatePhone(a.company.fax_2_3)&&(d=!1,e.push({message:"FAX",sufix:"2 (adresa: "+a.company.address_tag_3+")"})),a.company.address_zip_1&&!h.validateZip(a.company.address_zip_1)&&(d=!1,e.push({message:"ZIP",sufix:" (adresa: "+a.company.address_tag_1+")"})),a.company.address_zip_2&&!h.validateZip(a.company.address_zip_2)&&(d=!1,e.push({message:"ZIP",sufix:" (adresa: "+a.company.address_tag_2+")"})),a.company.address_zip_3&&!h.validateZip(a.company.address_zip_3)&&(d=!1,e.push({message:"ZIP",sufix:" (adresa: "+a.company.address_tag_3+")"})),b=0,c=e.length;c>b;b+=1)b>1&&(e[b].prefix=", ");return d||a.pageAncestor.addAlert({type:i.MESSAGE_WARNING_VALIDATION_BEFORE_CRUD,messages:e}),d},a.setDefault=function(){a.existsAddress(0)&&!a.company.address_tag_1&&(a.company.address_tag_1="1"),a.existsAddress(1)&&!a.company.address_tag_2&&(a.company.address_tag_2="2"),a.existsAddress(2)&&!a.company.address_tag_3&&(a.company.address_tag_3="3")},a.createAppointment=function(){j.setData({company:[{id:a.company.id,name:a.company.company_name}]}),b.path("/appointment")},a.clearPersonForm=function(){a.company.person={roleBox:[],positionBox:[]},a.showPersonForm=!1},a.verifyFormPerson=function(){var b,c,d=!0,e=[];for(e.push({message:"WARNING_FIELD_VALUE_INVALID"}),a.company.person.first_name||(d=!1,e.push({message:"FIRSTNAME"})),a.company.person.last_name||(d=!1,e.push({message:"LASTNAME"})),a.company.person.email&&!h.validateEmail(a.company.person.email)&&(d=!1,e.push({message:"EMAIL"})),a.company.person.business_phone&&!h.validatePhone(a.company.person.business_phone)&&(d=!1,e.push({message:"BUSINESS_PHONE"})),a.company.person.mobile_phone&&!h.validatePhone(a.company.person.mobile_phone)&&(d=!1,e.push({message:"MOBILE_PHONE"})),$("#PERSON_ROLE_value").val()&&!a.company.person.roleBox[0]&&(d=!1,e.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"ROLE"})),$("#PERSON_POSITION_value").val()&&!a.company.person.positionBox[0]&&(d=!1,e.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"POSITION"})),b=0,c=e.length;c>b;b+=1)b>1&&(e[b].prefix=", ");return d||a.pageAncestor.addAlert({type:i.MESSAGE_WARNING_VALIDATION_BEFORE_CRUD,messages:e}),d},a.insertPerson=function(){a.company.person.companies_id=a.company.id,a.company.person.company_name=a.company.company_name,a.verifyFormPerson()&&a.pageAncestor.postPart(function(){return k.post(a.company.person).then(function(b){return a.clearPersonForm(),a.reloadPeople(),b})})},a.reloadPeople=function(){a.peoplePaging.dataLoaderParams.reloadHash=Math.random()},a.revokePeople=function(){var b={};b.people=h.objectWithBooleanToArray(a.selectedPeopleObj),b.companyId=a.company.id,Object.keys(a.selectedPeopleObj).length<1||a.pageAncestor.confirm(function(){return m.spin("spinner-revoke-people"),l.revokePeople(b).then(function(c){return a.refreshDataAfterRevokePeople(c.data,b),m.stop("spinner-revoke-people"),c})},i.MESSAGE_EXEC_REVOKE_PEOPLE,i.MESSAGE_EXEC_REVOKE_PEOPLE_SUCCESS,i.MESSAGE_EXEC_REVOKE_PEOPLE_ERROR)},a.refreshDataAfterRevokePeople=function(b,c){b.message&&b.message.type===i.MESSAGE_SUCCESS&&(a.people=a.people.filter(function(a,b){return-1===c.people.indexOf(String(a.id))}))},a.newOpportunity=function(){j.setData({company:[{id:a.company.id,name:a.company.company_name}]}),b.path("/opportunity")},a.isSelectedPeople=function(){var b=Object.keys(a.selectedPeopleObj);return(b?b.length:0)>0},a.$watch("company",function(b,c){c!==b&&a.setNavbarAddress()},!0),a.initDataForAgenda=function(){a.dataForAgenda.appointment={},a.dataForAgenda.appointment.company=[{id:a.company.id,name:a.company.company_name}],a.dataForAgenda.task={},a.dataForAgenda.task.company=[{id:a.company.id,name:a.company.company_name}]},a.initAbstractFieldsAll(),a.pageAncestor=f.getInstance(),a.pageAncestor.init({scope:a,formObject:"company",table:"COMPANIES"}),a.initButtons(),a.initDataForAgenda()}]),angular.module("crmPostgresWebApp").service("LogData",["$http","$q","Tools",function(a,b,c){var d=function(){var d,e,f,g={isChanged:!1};this["default"]=function(a){c.setObject(e,a)},this.clear=function(){var a;for(a in d)d.hasOwnProperty(a)&&"table"!==a&&delete d[a];for(a in f)f.hasOwnProperty(a)&&(e[a]=f[a],delete f[a]);g.isChanged=!1},this.addChanges=function(a){f=c.createObject(a)},this.init=function(a,b,h){var i=this;e=c.createObject(a[b]),f={},d={},d.table=h,a.$watch(b,function(a,b){a!==b&&(i.addChanges(a),g.isChanged="{}"!==JSON.stringify(c.getChangedProperties(e,f)))},!0)},this.save=function(g){var h=b.defer();return d.old=c.getChangedProperties(f,e),d.id||(d.id=g.id||e.id),d["new"]="DELETE"===g.method?{}:c.getChangedProperties(e,f),d.method=g.method,"{}"!==JSON.stringify(d.old)?a.post("/api/log",JSON.stringify(d)).success(function(a){h.resolve("log has send")}).error(function(a){h.reject(a)}):h.reject("nothing to log"),h.promise},this.getChanges=function(){return{oldObject:e,newObject:f,logObject:d,changes:g}}};this.getInstance=function(){return new d}}]),angular.module("crmPostgresWebApp").service("PageAncestor",["$filter","$location","$rootScope","Tools","LogData","Constants","AlertsService",function(a,b,c,d,e,f,g){var h=function(){var a,h,i,j;i=e.getInstance(),j=this,this.routes=f.ROUTES,this.init=function(b){a=b.scope,h=b.formObject,this.initFormChangeWatcher(a),i.init(a,b.formObject,b.table),this.log=i.getChanges()},this.cancel=function(){d.setObject(a[h],i.getChanges().oldObject),d.setObject(i.getChanges().newObject,i.getChanges().oldObject)},this.openUrl=d.openUrl,this.setDefault=i.clear,this.post=function(b){var c=this;b&&(a.inProcess=!0,b().then(function(b){g.prepareMessage(b,"INFO_RECORD_POST_SUCCESS","INFO_RECORD_POST_ERROR")&&(i.clear(),i.save({method:f.CRUD_POST,id:b.data.id})),a.inProcess=!1},function(b){c.addAlert({type:f.MESSAGE_ERROR_MODAL,message:"INFO_RECORD_POST_ERROR",message2:"("+decodeURIComponent(b.data.message.msg)+")",title:"ERROR"}),a.inProcess=!1}))},this.put=function(b){var c=this;b&&(a.inProcess=!0,b().then(function(b){g.prepareMessage(b,"INFO_RECORD_PUT_SUCCESS","INFO_RECORD_PUT_ERROR")&&(i.clear(),i.save({method:f.CRUD_PUT})),a.inProcess=!1},function(b){c.addAlert({type:f.MESSAGE_ERROR_MODAL,message:"INFO_RECORD_PUT_ERROR",message2:"("+decodeURIComponent(b.data.message.msg)+")",title:"ERROR"}),a.inProcess=!1}))},this.del=function(b){var c,d,e=this,j=[{},{}];b&&(a.inProcess=!0,c=function(){i["default"](a[h]),b().then(function(b){g.prepareMessage(b,"INFO_RECORD_DELETE_SUCCESS","INFO_RECORD_DELETE_ERROR")&&i.save({method:f.CRUD_DELETE}),a.inProcess=!1},function(b){e.addAlert({type:f.MESSAGE_ERROR_MODAL,message:"INFO_RECORD_DELETE_ERROR",message2:"("+decodeURIComponent(b.data.message.msg)+")",title:"ERROR"}),a.inProcess=!1})},d=function(){a.inProcess=!1},j[0].name="OK",j[0].onClick=c,j[1].name="STORNO",j[1].onClick=d,e.addAlert({type:f.MESSAGE_WARNING_MODAL,message:"INFO_RECORD_DELETE_CONFIRM",title:"DELETE",buttons:j}))},this.initFormChangeWatcher=function(a){var d,e,f=this,h=[{},{}];a.$on("$locationChangeStart",function(a,k,l){j.log.changes.isChanged&&0===g.getModal().length&&(a.preventDefault(),d=function(){i.clear(),b.$$parse(k)},e=function(){c.showFormChanges=!0},h[0].name="OK",h[0].onClick=d,h[1].name="STORNO",h[1].onClick=e,f.addAlert({type:"WARNING_MODAL",message:"FORM_CHANGE_ONCLOSE_CONFIRM",title:"WARNING",buttons:h}))})},this.addAlert=function(a){g.add(a)},this.confirm=function(b,c,d,e){var h,i,j=this,k=[{},{}];b&&(a.inProcess=!0,h=function(){b().then(function(b){g.prepareMessage(b,d||"INFO_CONFIRM_SUCCESS",e||"INFO_CONFIRM_ERROR")&&console.log("success"),a.inProcess=!1},function(b){j.addAlert({type:f.MESSAGE_ERROR_MODAL,message:e||"INFO_CONFIRM_ERROR",message2:"("+decodeURIComponent(b.data.message.msg)+")",title:"ERROR"}),a.inProcess=!1})},i=function(){a.inProcess=!1},k[0].name="OK",k[0].onClick=h,k[1].name="STORNO",k[1].onClick=i,j.addAlert({type:f.MESSAGE_WARNING_MODAL,message:c||"INFO_CONFIRM",title:"CONFIRM",buttons:k}))},this.postPart=function(b){var c=this;b&&(a.inProcess=!0,b().then(function(b){g.prepareMessage(b,"INFO_RECORD_POST_SUCCESS","INFO_RECORD_POST_ERROR")&&(i.clear(),i["default"](a[h]),i.save({method:f.CRUD_PUT,id:b.data.id})),a.inProcess=!1},function(b){c.addAlert({type:f.MESSAGE_ERROR_MODAL,message:"INFO_RECORD_POST_ERROR",message2:"("+decodeURIComponent(b.data.message.msg)+")",title:"ERROR"}),a.inProcess=!1}))},this["default"]=function(){i["default"](a[h])}};this.getInstance=function(){return new h}}]),angular.module("crmPostgresWebApp").service("SalesPipelineStagesService",["$http","Tools",function(a,b){return{list:function(){return a.get("/api/sales-pipeline-stages/").error(function(a){console.log(a)})},get:function(b){return a.get("/api/sales-pipeline/stages/"+b).error(function(a){console.log(a)})},owners:function(){return a.get("/api/sales-pipeline/stages/all/owners/").error(function(a){console.log(a)})},post:function(b){return a.post("/api/sales-pipeline-stages",b).error(function(a){console.log(a)})},put:function(b){return a.put("/api/sales-pipeline-stages/"+b.id,b).error(function(a){console.log(a)})},del:function(b){return a["delete"]("/api/sales-pipeline-stages/"+b.id).error(function(a){console.log(a)})},replace:function(b){return a.put("/api/sales-pipeline-stages/replace/"+b.id,b).error(function(a){console.log(a)})}}}]),angular.module("crmPostgresWebApp").service("SalesPipelineService",["$http",function(a){return{get:function(b){return a.get("/api/sales-pipeline/"+b).error(function(a){console.log(a)})},list:function(b){return a.post("/api/sales-pipeline/stages/",b).error(function(a){console.log(a)})},listMyStages:function(){return a.get("/api/sales-pipeline/my/stages/",{cache:!1}).error(function(a){console.log(a)})}}}]),angular.module("crmPostgresWebApp").service("CompaniesService",["$http","$q","Tools","AlertsService","Constants",function(a,b,c,d,e){return{list:function(b){return a.get("/api/companies?"+c.objectToQueryString(b)).error(function(a){console.log(a)})},get:function(b){return a.get("/api/companies/"+b,{cache:!1}).error(function(a){console.log(a)})},del:function(b){return a["delete"]("/api/companies/"+b.id).error(function(a){console.log(a)})},post:function(b){return a.post("/api/companies",b).error(function(a){console.log(a)})},put:function(b){return a.put("/api/companies/"+b.id,b).error(function(a){console.log(a)})},people:function(b){return a.get("/api/companies/"+b.id+"/people?"+c.objectToQueryString(b)).error(function(a){console.log(a)})},searchGlobal:function(b){return a.get("/api/companies/search-all/"+b.str).error(function(a){console.log(a)})},listForAgenda:function(b){return a.get("/api/agenda/list/company/"+b.id+"?"+c.objectToQueryString(b),{cache:!1}).then(function(a){var b=a.data.message;return b&&b.type===e.MESSAGE_ERROR_MODAL&&d.add({type:b.type,message:b.msg}),a})},opportunities:function(b){return a.get("/api/companies/"+b.id+"/opportunities?"+c.objectToQueryString(b)).error(function(a){console.log(a)})}}}]),angular.module("crmPostgresWebApp").controller("CompaniesCtrl",["$scope","$location","companies","$translatePartialLoader","$translate","CompaniesService","Constants","MessengerService",function(a,b,c,d,e,f,g,h){d.addPart("companies"),e.refresh();var i=h.getData();a.searchStr="",a.dataLoaderParams={filter:{},sortField:"company_name",sortDirection:"asc"},a.dataLoaderParams.filter.type=i&&i.people&&i.people.filter?i.people.filter.type:-1,a.infoPaging={},a.selectedItemsObject={},a.ROUTES=g.ROUTES,a.types=[g.COMPANIES.FILTER.OPEN_OPPORTUNITIES],a.typesList=[{ID:-1,NAME:"ALL"}],a.typesList=a.typesList.concat(a.types),a.setSearch=function(b){13===b.which&&(a.dataLoaderParams.searchStr=a.searchStr)},a.newCompany=function(){b.path("/company")},a.getType=function(){return a.typesList.filter(function(b){return b.ID===a.dataLoaderParams.filter.type})[0]},a.companies=c,a.dataLoader=f.list}]),angular.module("crmPostgresWebApp").service("DateService",["$filter","$locale","uibDatepickerConfig","uibDatepickerPopupConfig","Constants",function(a,b,c,d,e){var f="d.M.yyyy",g=b.DATETIME_FORMATS.shortTime;return{setFormat:function(a){f=a},getFormat:function(){return f},setFormatTime:function(a){g=a},getFormatTime:function(){return g},lastDay:function(a){var b=a.getFullYear(),c=a.getMonth();return new Date(b,c,0)},addMonths:function(a,b){var c,d,e,f;if(d=a.getFullYear(),e=a.getMonth()+1,b>=0)for(f=0;b>f;f+=1)12===e?(e=1,d+=1):e+=1;else for(f=0;-1*b>f;f+=1)1===e?(e=12,d-=1):e-=1;return c=new Date(d,e,0,a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()),a.getDate()>c.getDate()?c:new Date(d,e-1,a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds())},addYears:function(a,b){return new Date(a.getFullYear()+b,a.getMonth(),a.getDate())},strToDate:function(a){var b=a.split(".");return new Date(b[2],b[1]-1,b[0])},wordFromDateRange:function(b,c){var d,e,f,g,h,i,j,k,l,m="";for(k=this,g=function(a,b,c){var d,e,f=new Date(a.setHours(0,0,0,0));switch(isNaN(b)?(b.indexOf("M")>-1&&(d=1),b.indexOf("Y")>-1&&(d=2),b.indexOf("E")>-1&&(d=3)):d=0,d){case 0:f.setDate(a.getDate()-parseInt(b,10)+-1*c);break;case 1:e=k.addMonths(a,-1*(b.split("M").length-1)),f=e.setDate(e.getDate()+-1*c);break;case 2:e=k.addYears(a,-1*(b.split("Y").length-1)),f=e.setDate(e.getDate()+-1*c);break;case 3:f=new Date(1900,1,1);break;default:f=null}return f},l=c.getDate()+(new Date(b.getFullYear(),b.getMonth()+1,0).getDate()-b.getDate()),d=[{from:"0",fromDay:0,to:"0",toDay:0,text:"",sufix:"TODAY"},{from:"1",fromDay:0,to:"1",toDay:0,text:"",sufix:"YESTERDAY"},{from:"2",fromDay:0,to:"2",toDay:0,text:"2 ",sufix:"DAYS"},{from:"3",fromDay:0,to:"26",toDay:0,text:l+" ",sufix:"DAYS2"},{from:"27",fromDay:0,to:"M",toDay:-1,text:"≈ 1 ",sufix:"MONTH"},{from:"M",fromDay:0,to:"M",toDay:0,text:"1 ",sufix:"MONTH"},{from:"M",fromDay:1,to:"M",toDay:4,text:"≈ 1 ",sufix:"MONTH"},{from:"M",fromDay:5,to:"MM",toDay:-5,text:"> 1 ",sufix:"MONTH"},{from:"MM",fromDay:-4,to:"MM",toDay:-1,text:"≈ 2 ",sufix:"MONTH2"},{from:"MM",fromDay:0,to:"MM",toDay:0,text:"2 ",sufix:"MONTH2"},{from:"MM",fromDay:1,to:"MM",toDay:4,text:"≈ 2 ",sufix:"MONTH2"},{from:"MM",fromDay:5,to:"MMM",toDay:-5,text:"> 2 ",sufix:"MONTH2"},{from:"MMM",fromDay:-4,to:"MMM",toDay:-1,text:"≈ 3 ",sufix:"MONTH2"},{from:"MMM",fromDay:0,to:"MMM",toDay:0,text:"3 ",sufix:"MONTH2"},{from:"MMM",fromDay:1,to:"MMM",toDay:4,text:"≈ 3 ",sufix:"MONTH2"},{from:"MMM",fromDay:5,to:"MMMM",toDay:-5,text:"> 3 ",sufix:"MONTH2"},{from:"MMMM",fromDay:-4,to:"MMMM",toDay:-1,text:"≈ 4 ",sufix:"MONTH2"},{from:"MMMM",fromDay:0,to:"MMMM",toDay:0,text:"4 ",sufix:"MONTH2"},{from:"MMMM",fromDay:1,to:"MMMM",toDay:4,text:"≈ 4 ",sufix:"MONTH2"},{from:"MMMM",fromDay:5,to:"MMMMM",toDay:-5,text:"> 4 ",sufix:"MONTH2"},{from:"MMMMM",fromDay:-4,to:"MMMMM",toDay:-1,text:"≈ 5 ",sufix:"MONTH3"},{from:"MMMMM",fromDay:0,to:"MMMMM",toDay:0,text:"5 ",sufix:"MONTH3"},{from:"MMMMM",fromDay:1,to:"MMMMM",toDay:4,text:"≈ 5 ",sufix:"MONTH3"},{from:"MMMMM",fromDay:5,to:"MMMMMM",toDay:-5,text:"> 5 ",sufix:"MONTH3"},{from:"MMMMMM",fromDay:-4,to:"MMMMMM",toDay:-1,text:"≈ 6 ",sufix:"MONTH3"},{from:"MMMMMM",fromDay:0,to:"MMMMMM",toDay:0,text:"6 ",sufix:"MONTH3"},{from:"MMMMMM",fromDay:1,to:"MMMMMM",toDay:4,text:"≈ 6 ",sufix:"MONTH3"},{from:"MMMMMM",fromDay:5,to:"MMMMMMM",toDay:-5,text:"> 6 ",sufix:"MONTH3"},{from:"MMMMMMM",fromDay:-4,to:"MMMMMMM",toDay:-1,text:"≈ 7 ",sufix:"MONTH3"},{from:"MMMMMMM",fromDay:0,to:"MMMMMMM",toDay:0,text:"7 ",sufix:"MONTH3"},{from:"MMMMMMM",fromDay:1,to:"MMMMMMM",toDay:4,text:"≈ 7 ",sufix:"MONTH3"},{from:"MMMMMMM",fromDay:5,to:"MMMMMMMM",toDay:-5,text:"> 7 ",sufix:"MONTH3"},{from:"MMMMMMMM",fromDay:-4,to:"MMMMMMMM",toDay:-1,text:"≈ 8 ",sufix:"MONTH3"},{from:"MMMMMMMM",fromDay:0,to:"MMMMMMMM",toDay:0,text:"8 ",sufix:"MONTH3"},{from:"MMMMMMMM",fromDay:1,to:"MMMMMMMM",toDay:4,text:"≈ 8 ",sufix:"MONTH3"},{from:"MMMMMMMM",fromDay:5,to:"MMMMMMMMM",toDay:-5,text:"> 8 ",sufix:"MONTH3"},{from:"MMMMMMMMM",fromDay:-4,to:"MMMMMMMMM",toDay:-1,text:"≈ 9 ",sufix:"MONTH3"},{from:"MMMMMMMMM",fromDay:0,to:"MMMMMMMMM",toDay:0,text:"9 ",sufix:"MONTH3"},{from:"MMMMMMMMM",fromDay:1,to:"MMMMMMMMM",toDay:4,text:"≈ 9 ",sufix:"MONTH3"},{from:"MMMMMMMMM",fromDay:5,to:"MMMMMMMMMM",toDay:-5,text:"> 9 ",sufix:"MONTH3"},{from:"MMMMMMMMMM",fromDay:-4,to:"MMMMMMMMMM",toDay:-1,text:"≈ 10 ",sufix:"MONTH3"},{from:"MMMMMMMMMM",fromDay:0,to:"MMMMMMMMMM",toDay:0,text:"10 ",sufix:"MONTH3"},{from:"MMMMMMMMMM",fromDay:1,to:"MMMMMMMMMM",toDay:4,text:"≈ 10 ",sufix:"MONTH3"},{from:"MMMMMMMMMM",fromDay:5,to:"MMMMMMMMMMM",toDay:-5,text:"> 10 ",sufix:"MONTH3"},{from:"MMMMMMMMMMM",fromDay:5,to:"Y",toDay:30,text:"1 ",sufix:"YEAR"},{from:"Y",fromDay:31,to:"Y",toDay:150,text:"> 1 ",sufix:"YEAR"},{from:"Y",fromDay:151,to:"Y",toDay:210,text:"1,5 ",sufix:"YEAR2"},{from:"Y",fromDay:211,to:"YY",toDay:-31,text:"< 2 ",sufix:"YEAR3"},{from:"YY",fromDay:-30,to:"YY",toDay:30,text:"2 ",sufix:"YEAR3"},{from:"YYY",fromDay:31,to:"E",toDay:0,text:"",sufix:"OUT_OF_DATE"}],e=0,f=d.length;f>e;e+=1)if(h=g(c,d[e].from,d[e].fromDay),i=g(c,d[e].to,d[e].toDay),j=new Date(b.setHours(0,0,0,0)),j>=i&&h>=j){m=d[e].text+a("translate")(d[e].sufix);break}return m},setDatepicker:function(){c.showWeeks=!1,d.currentText=a("translate")("TODAY"),d.clearText=a("translate")("CLEAR"),d.closeText=a("translate")("CLOSE")},setDate:function(a,b){if(!a||!b)return b;var c=new Date(b),d=new Date(a);return d.setDate(c.getDate()),d.setMonth(c.getMonth()),d.setFullYear(c.getFullYear()),d},setTime:function(a,b){var c=new Date;return c.setTime(b),a?(a.setHours(c.getHours()),a.setMinutes(c.getMinutes()),new Date(a)):c},addMilliseconds:function(a,b){var c=new Date(a);return"NWD"===b?c=this.nextWorkDay(c):"M"===b?c=this.addMonths(c,1):c.setMilliseconds(b),new Date(c)},round:function(a,b,c){var d,e,f,g=new Date(a),h=0,i=[0,15,30,45,60];if(i=b||i,"MI"===c.toUpperCase()&&(f=a.getMinutes(),-1===i.indexOf(f))){for(d=0,e=i.length;e>d;d+=1)if(f<=i[d]){h=i[d];break}g.setMinutes(h)}return new Date(g)},getTimeFromTwoDate:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o=["DAY_SMART","HOUR_SMART","MINUTE_SMART","SECONDS_SMART"],p="",q="0 min.";return b&&c?(e=d?864e5:new Date(c)-new Date(b),g=864e5,i=36e5,k=6e4,m=1e3,n=e,0===e?q:(f=Math.floor(n/g),f&&(n-=f*g,p+=" "+f+" "+a("translate")(o[0])),h=Math.floor(n/i),h&&(n-=h*i,p+=" "+h+" "+a("translate")(o[1])),j=Math.floor(n/k),j&&(n-=j*k,p+=" "+j+" "+a("translate")(o[2])),l=Math.floor(n/m),n-=l*m,l&&(p+=" "+l+" "+a("translate")(o[3])),p)):q},getDateWithMomemtJs:function(a,b){var c,d,e,f,g,h;return f=this.getFormat(),e=f.replace(/d/gi,"").replace(/m/gi,"").replace(/y/gi,"").replace(/ /g,"")[0],c=f.split(e),d=b.split(e),c.length!==d.length||0===d.length||d.indexOf("")>-1||d.indexOf("0")>-1?null:(c[0].length===d[0].length&&c[1].length===d[1].length&&c[2].length===d[2].length?g=new Date(a):(f=f.indexOf("yyyy")>-1||f.indexOf("YYYY")>-1?f:f.replace(/yy/gi,"yyyy"),c=f.split(e),h=c[0].substring(0,d[0].length).toUpperCase()+e+c[1].substring(0,d[1].length).toUpperCase()+e+c[2].substring(0,d[2].length).toUpperCase(),g=new Date(moment(b,h))),g)},getDateTimeWithMomemtJs:function(a,b,c){var d,e,f,g,h,i,j,k,l;return g=this.getFormatTime(),f=g.replace(/h/gi,"").replace(/m/gi,"").replace(/a/gi,"").replace(/ /gi,"")[0],d=g.split(f),e=c.split(f),d.length!==e.length||2===d[1].length&&e[1].length!==d[1].length||d[1].length>2&&(" pm"===e[1].substring(d[1].indexOf("a"),3).toLowerCase()||" am"===e[1].substring(d[1].indexOf("a"),3).toLowerCase())||0===e.length||e.indexOf("")>-1?null:(e[0].length>=d[0].length&&(2===d[1].length&&d[1].length===e[1].length||5===e[1].length)?h=new Date(b):(j=d[0].substring(0,e[0].length),j=g.indexOf("a")>-1||g.indexOf("A")>-1?j.toLowerCase():j.toUpperCase(),k=a?new Date(a):new Date,l=k.getFullYear()+"."+(k.getMonth()+1)+"."+k.getDate()+" ",i="YYYY.M.D "+j+f+d[1].substring(0,e[1].length).toLowerCase(),h=new Date(moment(l+c,i))),h>new Date(1899,0,1)?h:k)},nextWorkDay:function(a){var b=864e5;switch(a.getDay()){case 0:case 1:case 2:case 3:case 4:break;case 5:b=3*b;break;case 6:b=2*b}return a.setMilliseconds(b),new Date(a)},setDateAsUTC0:function(a){return a?new Date(new Date(a).setMilliseconds(60*new Date(a).getTimezoneOffset()*1e3*-1)):null},getTimeLineString:function(a){var b,c,d,f,g;return b=new Date((new Date).setHours(0,0,0,0)),c=new Date(new Date(a).setHours(0,0,0,0)),f=this.addMilliseconds(b,-864e5),g=this.addMilliseconds(b,864e5),b.toISOString()===c.toISOString()&&(d=e.TIMELINE_DATE_CURRENT),f.toISOString()===c.toISOString()&&(d=e.TIMELINE_DATE_PRIOR),g.toISOString()===c.toISOString()&&(d=e.TIMELINE_DATE_NEXT),d||""},moveToDayOfWeek:function(a,b){var c,d,e,f=1;return c=1===f&&0===b?7:b,e=new Date(a).getDay(),e=1===f&&0===e?7:e,d=e===c?0:24*(c-e)*60*60*1e3,this.addMilliseconds(a,d)},getTimeFromDateObject:function(a){var b="";return b+=a.hours?-1*a.hours+":":"00:",b+=a.minutes?-1*a.minutes:"00"},clearISOTime:function(a){return a.substr(0,10)+"T00:00:00.000Z"},getAge:function(a){var b=new Date,c=new Date(a),d=b.getFullYear()-c.getFullYear(),e=b.getMonth()-c.getMonth();return 0>e||0===e&&b.getDate()<c.getDate()?d-1:d},getDaysToDate:function(a){var b,c=new Date,d=new Date(a),e=864e5;return c.setHours(0,0,0,0),d.setHours(0,0,0,0),b=d-c,Math.floor(b/e)},setDateAfterToday:function(a){var b,c=this,d=new Date,e=new Date(a);return d.setHours(0,0,0,0),b=d.getFullYear(),e=new Date(b,e.getMonth(),e.getDate()),d>e?c.addYears(e,1):e}}}]),angular.module("crmPostgresWebApp").directive("pillsNotia",function(){return{templateUrl:"views/directives/d_pills.html",restrict:"E",replace:!0,scope:{items:"=",active:"=",name:"@"},link:function(a,b,c){a.setActive=function(b){var c,d;for(c=0,d=(a.items||[]).length;d>c;c+=1)a.items[c].active=b===c,a.items[c].active&&(a.active=c)},a.setActive(parseInt(a.active,10)),a.$watch("items[0].hash",function(b,c){b!==c&&a.items[a.active].hide&&a.items[a.active].hide()&&a.setActive(0)},!0)}}}),angular.module("crmPostgresWebApp").service("AlertsService",["$location","$timeout","Constants","Tools",function(a,b,c,d){var e={items:[]},f=[],g=[c.MESSAGE_INFO,c.MESSAGE_SUCCESS,c.MESSAGE_WARNING,c.MESSAGE_ERROR,c.MESSAGE_WARNING_VALIDATION_BEFORE_CRUD],h=[c.MESSAGE_INFO_MODAL,c.MESSAGE_SUCCESS_MODAL,c.MESSAGE_WARNING_MODAL,c.MESSAGE_ERROR_MODAL,c.MESSAGE_WARNING_MODAL_CONN_LOST],i=20,j=1e4;
return{add:function(a){a&&(a.id=Math.random(),e.items.length>i&&b(function(){e.items.splice(0,e.items.length)},j),f.length>i&&b(function(){f.splice(0,f.length)},j),g.indexOf(a.type)>-1&&(e.items.push(a),b(function(){d.deleteItemOfArrayObjects(e,"items",a.id,"id")},j)),h.indexOf(a.type)>-1&&f.push(a))},get:function(){return e},getModal:function(){return f},deleteType:function(a){d.deleteItemOfArrayObjects(e,"items",a,"type")},prepareMessage:function(a,b,d){var e,f,g=!1,h=!1,i=[];if(a.data.message&&a.data.message.type===c.MESSAGE_ERROR_MODAL)this.add({type:c.MESSAGE_ERROR_MODAL,message:d,message2:"("+decodeURIComponent(a.data.message.msg)+")",title:"ERROR"});else{for(i.push({message:d}),e=0,f=a.data.length;f>e;e+=1)a.data[e].message.type===c.MESSAGE_ERROR_MODAL&&(h=!0,i.push({message:"("+decodeURIComponent(a.data[e].message.msg)+")"}));h?this.add({type:c.MESSAGE_ERROR_MODAL,messages:i,title:"ERROR"}):(g=!0,this.deleteType(c.MESSAGE_WARNING_VALIDATION_BEFORE_CRUD),this.add({type:c.MESSAGE_SUCCESS,message:b}))}return g},clear:function(){e={items:[]},f=[]},closeModalMessage:function(){$("#alertModal").modal("hide")}}}]),angular.module("crmPostgresWebApp").directive("alerts",["$timeout","AlertsService",function(a,b){return{templateUrl:"views/directives/d_alerts.html",restrict:"E",scope:{},link:function(a,c,d){a.alerts=b.get(),a.close=function(b){a.alerts.items&&a.alerts.items.splice(b,1)}}}}]),angular.module("crmPostgresWebApp").directive("alertsModal",["$timeout","AlertsService",function(a,b){return{templateUrl:"views/directives/d_alerts_modal.html",restrict:"E",scope:{},link:function(a,c,d){a.items=b.getModal(),a.item={},a.isClicked=!1,a.cancel=function(){a.item.cancelButton&&a.item.cancelButton.onClick&&a.item.cancelButton.onClick(),a.refresh()},a.close=function(){a.item.closeButton&&a.item.closeButton.onClick&&a.item.closeButton.onClick(),a.refresh()},$("#alertModal").on("hide.bs.modal",function(b){a.items.splice(0,1),a.isClicked||a.cancel(),a.isClicked=!1}),a.refresh=function(){a.items.length>0&&(a.item=a.items[0],$("#alertModal").modal())},a.onClick=function(b){a.isClicked=!0,a.item.buttons[b].onClick()},a.$watch("items",function(b,c){b!==c&&a.refresh()},!0)}}}]),angular.module("crmPostgresWebApp").directive("ratingNotia",function(){return{templateUrl:"views/directives/d_ratingnotia.html",restrict:"EA",require:["ratingNotia","ngModel"],scope:{readonly:"=?",onHover:"&",onLeave:"&"},controller:["$scope","$attrs",function(a,b){var c,d,e={$setViewValue:angular.noop},f={max:5,stateOn:null,stateOff:null};this.init=function(c){e=c,e.$render=this.render,this.stateOn=angular.isDefined(b.stateOn)?a.$parent.$eval(b.stateOn):f.stateOn,this.stateOff=angular.isDefined(b.stateOff)?a.$parent.$eval(b.stateOff):f.stateOff;var d=angular.isDefined(b.ratingStates)?a.$parent.$eval(b.ratingStates):new Array(angular.isDefined(b.max)?a.$parent.$eval(b.max):f.max);a.range=this.buildTemplateObjects(d)},this.buildTemplateObjects=function(a){for(c=0,d=a.length;d>c;c+=1)a[c]=angular.extend({index:c},{stateOn:this.stateOn,stateOff:this.stateOff},a[c]);return a},a.rate=function(b){!a.readonly&&b>=0&&b<=a.range.length&&(e.$setViewValue(b),e.$render())},a.enter=function(b){a.readonly||(a.value=b),a.onHover({value:b})},a.reset=function(){a.value=e.$viewValue,a.onLeave()},a.onKeydown=function(b){/(37|38|39|40)/.test(b.which)&&(b.preventDefault(),b.stopPropagation(),a.rate(a.value+(38===b.which||39===b.which?1:-1)))},this.render=function(){a.value=e.$viewValue}}],replace:!0,link:function(a,b,c,d){var e=d[0],f=d[1];f&&e.init(f)}}}),angular.module("crmPostgresWebApp").directive("angucomplete",["$timeout","$location","$templateCache","$parse","$http","$compile","$q","$sce","Tools",function(a,b,c,d,e,f,g,h,i){var j=function(a){var b,d,f=["views/directives/d_angucomplete.html","views/directives/d_angucomplete_box.html"];return b=g.defer(),d=c.get(f[a]),d?b.resolve(d):e.get(f[a],{cache:!0}).success(function(d){c.put(f[a],d),b.resolve(c.get(f[a]))}).error(function(a){b.reject(a)}),b.promise};return{restrict:"EA",replace:!0,scope:{id:"@",placeholder:"@",model:"=",modelObject:"=?",modelType:"@",selectedObjectId:"@",url:"@",dataField:"@",titleField:"@",selectedField:"@",descriptionField:"@",imageField:"@",inputClass:"@",userPause:"@pause",localData:"=?",searchFields:"@",searchFieldsWithoutSpec:"@",searchStr:"=?",matchClass:"@",showAsBox:"=",boxItems:"=?",multiple:"=",dropDown:"=?",tabindex:"@",inputAllData:"=?",labelName:"@",labelClass:"@",disabled:"=?",menuLeft:"=?",onDeleteBoxItem:"=?",onSelectItem:"=?",recordUrl:"@"},templateUrl:"views/directives/d_root_element.html",link:function(c,d,g){var k,l,m,n;c.lastSearchTerm=null,c.currentIndex=null,c.justChanged=!1,c.searchTimer=null,c.searching=!1,c.pause=500,c.minLengthForSearch=1,c.startServerSearch=!1,c.existsItemInArray=i.existsItemInArray,c.results=[],c.dropDownMenuLeft=c.menuLeft||!1,c.dropDownMenuRight=!c.menuLeft,c.focusInput=!0,c.inProcess=!1,c.loading={offset:0,limit:10},c.invalid=!1,c.clickOnNextRows=!1,c.searchStrIsChanging=!1,c.modelIsChanging=!1,j(c.showAsBox?1:0).then(function(a){d.html(a).show(),f(d.contents())(c)}),c.dropDownClick=function(b){b.onClick?b.onClick(b):(c.searchStrIsChanging=!0,c.searchStr=b[c.selectedField||c.titleField],"undefined"!==c.modelObject&&(c.modelObject=b)),c.onSelectItem&&a(function(){c.onSelectItem(Object.create(b))})},c.clearAutocomplete=function(){c.showDropdown=!1,c.results=[]},c.userPause&&(c.pause=c.userPause),k=function(a,b){var c;return c=b?a[b]:a},l=function(a,b){return a.length>=parseInt(c.minLengthForSearch,10)&&(c.localData?a!==b:c.startServerSearch)},c.processResults=function(a,b,d){var e,f,g,i,j,l,m,n,o,p;if(a&&a.length>0)for(d||(c.results=[]),i=[],c.titleField&&""!==c.titleField&&(i=c.titleField.split(",")),e=0;e<a.length;e+=1){for(g="",f=0;f<i.length;f+=1)f>0&&(g+=" + ' ' + "),g+=a[e][i[f]];j="",c.descriptionField&&(j=k(a[e],c.descriptionField)),l="",c.imageField&&(l=k(a[e],c.imageField)),m=g,c.matchClass&&(n=new RegExp(b,"i"),o=m.match(n)[0],m=h.trustAsHtml(m.replace(n,'<span class="'+c.matchClass+'">'+o+"</span>"))),p={title:m,description:j,image:l,originalObject:a[e]},c.results.push(p)}else d||(c.results=[])},c.searchTimerComplete=function(a){var b,d,e,f,g,h,i;if(a.length>=parseInt(c.minLengthForSearch,10))if(c.showDropdown=!0,c.localData){for(e=c.searchFields.split(","),f=[],b=0;b<c.localData.length;b+=1){for(g=!1,d=0;d<e.length;d+=1)h=!1,c.localData&&c.localData[b][e[d]]&&(h=c.localData[b][e[d]].toLowerCase().indexOf(a.toLowerCase())>=0),g=g||h;if(c.searchFieldsWithoutSpec)for(i=c.searchFieldsWithoutSpec.split(","),d=0;d<i.length;d+=1)h=!1,c.localData&&c.localData[b][i[d]]&&(h=c.localData[b][i[d]].toLowerCase().indexOf(a.toLowerCase())>=0),g=g||h;g&&(f[f.length]=c.localData[b])}c.searching=!1,c.processResults(f,a),c.$apply()}else c.inProcess=!0,c.loadServerData(a)},c.loadServerData=function(a,b){return e.get(c.url+a+"?"+i.objectToQueryString({offset:c.loading.offset,limit:c.loading.limit}),{}).success(function(d,e,f,g){c.searching=!1;var h=k(d,c.dataField);c.processResults(h,a,b),c.inProcess=!1,c.showDropdown=!0}).error(function(a,b,d,e){c.inProcess=!1})},c.hoverRow=function(a){c.currentIndex=a},c.keyPressed=function(a){13===a.which&&(c.localData||!c.localData&&c.showDropdown)&&c.modifyInput(),38!==a.which&&40!==a.which&&13!==a.which||13===a.which&&!c.localData?(13===a.which&&(c.showDropdown?a.preventDefault():c.startServerSearch=!0),c.searchStr&&""!==c.searchStr?l(c.searchStr,c.lastSearchTerm)&&(c.lastSearchTerm=c.searchStr,c.currentIndex=-1,c.results=[],c.startServerSearch=!1,c.searchTimer&&clearTimeout(c.searchTimer),c.searching=!0,c.searchTimer=setTimeout(function(){c.searchTimerComplete(c.searchStr)},c.pause)):(c.showDropdown=!1,c.lastSearchTerm=null)):a.preventDefault(),c.startServerSearch=!1},c.selectResult=function(b){a.cancel(m),c.matchClass&&(b.title=b.title.toString().replace(/(<([^>]+)>)/gi,"")),c.searchStrIsChanging=!0,c.searchStr=c.lastSearchTerm=c.selectedField?b.originalObject[c.selectedField]:b.title,c.currentObject=b,c.showDropdown=!1,c.results=[],"undefined"!==c.model&&(c.model=c.currentObject.originalObject[c.selectedObjectId]),"undefined"!==c.modelObject&&(c.modelObject=c.currentObject.originalObject),c.showAsBox&&(c.searchStr=""),c.addItem(c.currentObject.originalObject),c.onSelectItem&&c.onSelectItem(Object.create(c.currentObject.originalObject)),c.currentObject={}},c.addItem=function(a){var b,d,e=!1;if(a&&c.boxItems){for(b=0;b<c.boxItems.length;b+=1)d=c.boxItems[b],d.id===a.id&&(e=!0);e||c.boxItems.push(a)}},c.init=function(){c.showAsBox||c.multiple||c.searchStr||!c.localData||(c.searchStr=i.getItemFromArray(c.model,c.selectedObjectId,c.localData,c.selectedField||c.titleField))},c.clearModel=function(){c.model="",c.modelObject=""},c.onBlur=function(){a(function(){c.clickOnNextRows||(c.focusInput=!1),c.clickOnNextRows=!1,c.testValidation()},400)},c.testValidation=function(){$("#"+c.id+"_value").val()&&(!c.boxItems||c.boxItems&&0===c.boxItems.length)?c.invalid=!0:c.invalid=!1},c.onNewRecordClick=function(){var b=c.searchStr;a(function(){c.focusInput=!1},200),b&&(m=a(function(){n(null,!1)},200))},c.onClickSearch=function(a){a.which=13,c.keyPressed(a)},c.setFocus=function(b){a(function(){c.focusInput=b},200)},c.onDelete=function(a){c.boxItems.splice(a,1),c.searchStr="",c.lastSearchTerm="",c.onDeleteBoxItem&&c.onDeleteBoxItem(a)},c.init(),d.bind("keyup",function(a){40===a.which?(c.currentIndex+1<c.results.length&&(c.currentIndex+=1,c.$apply(),a.preventDefault(),a.stopPropagation()),c.$apply()):38===a.which?c.currentIndex>=0&&(c.currentIndex-=1,c.$apply(),a.preventDefault(),a.stopPropagation()):13===a.which?c.currentIndex>=0&&c.currentIndex<c.results.length?(c.selectResult(c.results[c.currentIndex]),c.$apply(),a.preventDefault(),a.stopPropagation()):(c.localData||!c.localData&&c.showDropdown)&&n(a,!0):27===a.which?(c.results=[],c.showDropdown=!1,c.loading={offset:0,limit:10},c.$apply()):8===a.which&&(c.currentObject=null,c.$apply())}),n=function(a,b){var d=c.searchStr,e=Math.random().toString().substring(2);c.inputAllData&&c.showAsBox&&(c.multiple||(c.boxItems=[],b&&$("#"+c.id+"_angc").focus()),d&&c.addItem({id:"id_"+e,name:d,"new":!0}),c.showDropdown=!1),c.showAsBox&&(c.searchStr=""),c.lastSearchTerm="",c.localData||(c.results=[]),c.$apply(),a&&(a.preventDefault(),a.stopPropagation())},c.nextData=function(a){c.clickOnNextRows=!0,c.loading.offset+=c.loading.limit,c.inProcessNextPage=!0,c.loadServerData(c.searchStr,!0).then(function(){c.inProcessNextPage=!1})},c.onChangeInput=function(){c.showDropdown=c.showDropdown?!1:c.showDropdown,c.invalid=!1},c.modifyInput=function(){var b,d=0,e=26,f=2,g=3;a(function(){$("#"+c.id+"_value").css("width","100"),$("#"+c.id+"_angc .n-label-autocomplete").each(function(){d+=parseInt($(this).outerWidth(!0),10)+f}),b=parseInt($("#"+c.id+"_angc").css("width"),10)-d-e-g,$("#"+c.id+"_value").css("width",b).focus()},300)},c.showNewRecord=function(){return c.inputAllData&&c.results.every(function(a){return c.searchStr!==a.title})},c.openRecord=function(a){a.id&&b.path(c.recordUrl+a.id)},c.initAfterCancelChanges=function(){c.showAsBox||c.multiple||!c.localData||(c.searchStrIsChanging=!0,c.modelIsChanging=!0,c.searchStr=i.getItemFromArray(c.model,c.selectedObjectId,c.localData,c.selectedField||c.titleField))},c.$watch("results",function(a,b){a!==b&&c.modifyInput()},!0),c.$watch("model",function(b,d){b!==d&&(c.showAsBox||c.searchStrIsChanging||c.initAfterCancelChanges(),a(function(){c.modelIsChanging=!1},1e3))},!0),c.$watch("searchStr",function(b,d){b!==d&&(c.showAsBox||c.multiple||!c.localData||c.modelIsChanging||(b?c.model=i.getItemFromArray(c.searchStr,c.selectedField||c.titleField,c.localData,c.selectedObjectId):c.model=null),a(function(){c.searchStrIsChanging=!1},1e3))},!0)}}}]),angular.module("crmPostgresWebApp").controller("ActionButtonsCtrl",["$scope",function(a){a.clickBtn=function(a){a.disabled()||a.onClick()}}]).directive("actionButtons",[function(){return{templateUrl:"views/directives/d_action_buttons.html",restrict:"E",replace:!0,scope:{buttons:"="},controller:"ActionButtonsCtrl"}}]),angular.module("crmPostgresWebApp").factory("authHttpResponseInterceptor",["$q","$location","AlertsService","Constants",function(a,b,c,d){return{response:function(e){return 401===e.status&&(b.path("/login"),c.add({type:d.MESSAGE_ERROR,message:d.MESSAGE_CONNECTION_LOST})),203===e.status&&c.add({type:d.MESSAGE_WARNING_MODAL,message:d.MESSAGE_CONNECTION_SOON_LOST}),e||a.when(e)},responseError:function(e){return 401===e.status&&(b.path("/login"),c.add({type:d.MESSAGE_ERROR,message:d.MESSAGE_CONNECTION_LOST})),a.reject(e)}}}]),angular.module("crmPostgresWebApp").service("Language",function(){var a,b=null,c={},d=[];return c.cs=["leden","únor","březen","duben","květen","červen","červenec","srpen","září","říjen","listopad","prosinec"],c.sk=["január","február","marec","apríl","máj","jún","júl","august","september","október ","november","december"],c.en=["january","february","march","april","may","june","july","august","september","october","november","december"],d=c[a||"en"],{getLanguage:function(){return b},setLanguage:function(a){b=a,this.setLanguageCalendar(a)},getLanguageCalendar:function(){return a},setLanguageCalendar:function(b){"cs-cz"===b?a="cs":"sk-sk"===b?a="sk":"en-us"===b&&(a="en"),d=c[a]},getMonthNames:function(){return d}}}),angular.module("crmPostgresWebApp").factory("SocketFactory",["$rootScope",function(a){var b=io.connect();return{on:function(c,d){b.on(c,function(){var c=arguments;a.$apply(function(){d.apply(b,c)})})},emit:function(c,d,e){b.emit(c,d,function(){var c=arguments;a.$apply(function(){e&&e.apply(b,c)})})},reconnect:function(a){console.log("reconnect"),console.log(a),console.log(b)},disconnect:function(){b.disconnect()}}}]),angular.module("crmPostgresWebApp").controller("AppointmentCtrl",["$scope","$rootScope","$location","$filter","$timeout","$translate","$translatePartialLoader","PageAncestor","AppointmentService","DateService","TimeZonesService","PeopleService","Tools","SalesPipelineService","UsersService","Constants","DatepickerFactory","MessengerService","TasksService","initialData",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){g.addPart("appointment"),f.refresh(),a.appointment=t.appointment,a.appointmentTypes=t.types,a.appointmentPlaces=t.places,a.appointmentTmp={},a.openCalendar=!1,a.isSettingTypeEvent=!1,a.isEnableCalculate=!0;var u,v,w,x,y;if(a.listDateFrom=[{prefix:"",name:"NEXT_FREE_TIME",value:"NEXT_FREE_TIME"},{prefix:"",name:"TOMORROW",value:864e5,rounding:[0,15,30,45,60],roundingLevel:"mi"}],a.listDateTo={allDay:[{prefix:"1",name:"DAY",value:864e5},{prefix:"2",name:"DAYS",value:1728e5},{prefix:"3",name:"DAYS",value:2592e5},{prefix:"A",name:"WEEK",value:6048e5},{prefix:"2",name:"WEEKS",value:12096e5},{prefix:"A",name:"MONTH",value:"M"}],other:[{prefix:"5",name:"MINUTES",value:3e5},{prefix:"15",name:"MINUTES",value:9e5},{prefix:"30",name:"MINUTES",value:18e5},{prefix:"1",name:"HOUR",value:36e5},{prefix:"90",name:"MINUTES",value:54e5},{prefix:"2",name:"HOURS",value:72e5},{prefix:"3",name:"HOURS",value:108e5}]},a.listReminder=[{prefix:"",name:"NONE",value:0},{prefix:"5",name:"MINUTES",value:300},{prefix:"10",name:"MINUTES",value:600},{prefix:"15",name:"MINUTES",value:900},{prefix:"30",name:"MINUTES",value:1800},{prefix:"1",name:"HOUR",value:3600},{prefix:"1",name:"DAY",value:86400}],a.appointment.start_time?(w=new Date(a.appointment.start_time),u=j.addMilliseconds(w,60*w.getTimezoneOffset()*1e3)):u=j.round(new Date,[0,30,60],"mi"),a.appointment.end_time?(w=new Date(a.appointment.end_time),v=j.addMilliseconds(w,60*w.getTimezoneOffset()*1e3)):v=new Date,a.appointment.id||a.appointment.isCopy){for(a.appointmentTmp.tmpReminderIndex=0,a.appointmentTmp.tmpAttendeeReminderIndex=0,a.appointmentTmp.tmpTeamReminderIndex=0,x=0,y=a.listReminder.length;y>x;x+=1)a.listReminder[x].value===parseInt(a.appointment.reminder_seconds,10)&&(a.appointmentTmp.tmpReminderIndex=x),a.listReminder[x].value===parseInt(a.appointment.team_reminder_seconds,10)&&(a.appointmentTmp.tmpTeamReminderIndex=x),a.listReminder[x].value===parseInt(a.appointment.attendee_reminder_seconds,10)&&(a.appointmentTmp.tmpAttendeeReminderIndex=x);a.appointmentTmp.tmpSalesPipelineStage=a.appointment.sales_pipeline_stage_name,e(function(){a.appointmentTmp.tmpReminder=a.listReminder[a.appointmentTmp.tmpReminderIndex].name,a.appointmentTmp.tmpReminderPrefix=a.listReminder[a.appointmentTmp.tmpReminderIndex].prefix,a.appointmentTmp.tmpTeamReminder=a.listReminder[a.appointmentTmp.tmpTeamReminderIndex].name,a.appointmentTmp.tmpTeamReminderPrefix=a.listReminder[a.appointmentTmp.tmpTeamReminderIndex].prefix,a.appointmentTmp.tmpAttendeeReminder=a.listReminder[a.appointmentTmp.tmpAttendeeReminderIndex].name,a.appointmentTmp.tmpAttendeeReminderPrefix=a.listReminder[a.appointmentTmp.tmpAttendeeReminderIndex].prefix},500)}else a.appointmentTmp.tmpReminderIndex=2,a.appointmentTmp.tmpTeamReminderIndex=5,a.appointmentTmp.tmpAttendeeReminderIndex=5,a.appointmentTmp.tmpReminderIndex&&(a.appointment.reminder=0===a.listReminder[a.appointmentTmp.tmpReminderIndex].value?0:1,a.appointment.reminder_seconds=a.listReminder[a.appointmentTmp.tmpReminderIndex].value,e(function(){a.appointmentTmp.tmpReminder=a.listReminder[a.appointmentTmp.tmpReminderIndex].name,a.appointmentTmp.tmpReminderPrefix=a.listReminder[a.appointmentTmp.tmpReminderIndex].prefix},500)),a.appointmentTmp.tmpTeamReminderIndex&&(a.appointment.team_reminder=0===a.listReminder[a.appointmentTmp.tmpTeamReminderIndex].value?0:1,a.appointment.team_reminder_seconds=a.listReminder[a.appointmentTmp.tmpTeamReminderIndex].value,e(function(){a.appointmentTmp.tmpTeamReminder=a.listReminder[a.appointmentTmp.tmpTeamReminderIndex].name,a.appointmentTmp.tmpTeamReminderPrefix=a.listReminder[a.appointmentTmp.tmpTeamReminderIndex].prefix},500)),a.appointmentTmp.tmpAttendeeReminderIndex&&(a.appointment.attendee_reminder=0===a.listReminder[a.appointmentTmp.tmpAttendeeReminderIndex].value?0:1,a.appointment.attendee_reminder_seconds=a.listReminder[a.appointmentTmp.tmpAttendeeReminderIndex].value,e(function(){a.appointmentTmp.tmpAttendeeReminder=a.listReminder[a.appointmentTmp.tmpAttendeeReminderIndex].name,a.appointmentTmp.tmpAttendeeReminderPrefix=a.listReminder[a.appointmentTmp.tmpAttendeeReminderIndex].prefix},500));u.setSeconds(0),u.setMilliseconds(0),u=new Date(u),v.setSeconds(0),v.setMilliseconds(0),v=new Date(v),a.getFormat=j.getFormat,a.getTimeFromTwoDate=j.getTimeFromTwoDate,a.calculateDateTime=function(b,c,d,e,f){i.calculateDateTime(a,b,c,d,e,f)},a.setType=function(b){a.isSettingEvent=!0,i.setType(a,b)},a.setDefaultPlaces=function(b){i.setDefaultPlaces(a)},a.salesPipelineStages=[],a.appointment.appointment_tags=a.appointment.appointment_tags||[],a.appointment.company=a.appointment.company||[],a.appointment.salesPipeline=a.appointment.salesPipeline||[],a.appointment.teamReminderMembers=a.appointment.teamReminderMembers||[],a.appointment.attendeeReminderMembers=a.appointment.attendeeReminderMembers||[],a.appointment.locationBox=a.appointment.locationBox||[],a.localDataTags=[],a.localDataAddress=[],a.localDataUsers=[],a.appointment.start_time=u,a.appointment.end_time=v,a.appointmentTmp.tmpStartTime=u,a.appointmentTmp.tmpStartDate=u,a.appointmentTmp.tmpEndDate=v,a.appointmentTmp.tmpEndTime=v,a.timeFromReadOnly=!1,a.timeToReadOnly=!1,a.timeSize="",a.timeZones=[],a.appointment.projects=a.appointment.projects||[],a.appointment.text=a.appointment.text||{},a.attachmentsTable=p.ATTACHMENTS_TYPES.APPOINTMENT,a.attachmentsInfo={config:{selectFileHash:null}},a.tasks=[],a.taskPaging={},a.taskPaging.infoPaging={},a.taskPaging.dataLoader=s.listForAppointment,a.taskPaging.dataLoaderParams={sortField:"id",sortDirection:"asc",loadCount:!0},a.initButtons=function(){a.actionButtons=[{name:"DELETE",dropDown:[{name:"DELETE_APPOINTMENT",onClick:a.del,disabled:function(){return!a.appointment.id}}],disabled:!a.appointment.id},{name:"CANCEL",onClick:a.pageAncestor.cancel,disabled:function(){return!a.pageAncestor.log.changes.isChanged}},{name:"SAVE",dropDown:[{name:"SAVE",onClick:function(){var b;a.appointment.id?(b={eventAfterOperation:a.afterUpdate},a.put(b)):(b={eventAfterOperation:a.openRecord},a.post(b))},disabled:function(){return!1}},{name:"SAVE_OPEN_CALENDAR",onClick:function(){var b={eventAfterOperation:a.openInCalendar};a.appointment.id?a.put(b):a.post(b)},disabled:function(){return!1}},{name:"SAVE_OPEN_AGENDA",onClick:function(){var b={eventAfterOperation:a.openInAgenda};a.appointment.id?a.put(b):a.post(b)},disabled:function(){return!1}}]}]},a.verifyForm=function(){var b,c,d=!0,e=[];for(e.push({message:"WARNING_FIELD_VALUE_INVALID"}),a.appointment.type_id||(d=!1,e.push({message:"TYPE"})),a.appointment.place||(d=!1,e.push({message:"PLACE"})),a.appointment.start_time&&new Date(a.appointment.start_time)>new Date(1899,0,1)||(d=!1,e.push({message:"DATE_FROM"})),a.appointment.end_time&&new Date(a.appointment.end_time)>new Date(1899,0,1)||(d=!1,e.push({message:"DATE_TO"})),a.appointment.end_time&&a.appointment.start_time&&new Date(a.appointment.end_time)<new Date(a.appointment.start_time)&&(d=!1,e.push({message:"DATE_RANGE"})),a.appointment.timezone_name||(d=!1,e.push({message:"TIMEZONE"})),$("#XXX6_value").val()&&!a.appointment.appointment_tags[0]&&(d=!1,e.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"TAGS"})),$("#XXX11_value").val()&&!a.appointment.company[0]&&(d=!1,e.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"COMPANY"})),$("#XXX12_value").val()&&!a.appointment.salesPipeline[0]&&(d=!1,e.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"SALES_PIPELINE"})),$("#XXX23_value").val()&&!a.appointment.teamReminderMembers[0]&&(d=!1,e.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"TEAM_MEMBERS"})),$("#XXX22_value").val()&&!a.appointment.attendeeReminderMembers[0]&&(d=!1,e.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"ATTENDEE"})),b=0,c=e.length;c>b;b+=1)b>1&&(e[b].prefix=", ");return d||a.pageAncestor.addAlert({type:p.MESSAGE_WARNING_VALIDATION_BEFORE_CRUD,messages:e}),d},a.post=function(b){a.verifyForm()&&(a.appointment.start_time=j.setDateAsUTC0(a.appointment.start_time),a.appointment.end_time=j.setDateAsUTC0(a.appointment.end_time),a.pageAncestor.post(function(){return i.post(a.appointment).then(function(a){return b&&b.eventAfterOperation&&b.eventAfterOperation(a.data),a})}))},a.put=function(b){a.verifyForm()&&(a.appointment.start_time=j.setDateAsUTC0(a.appointment.start_time),a.appointment.end_time=j.setDateAsUTC0(a.appointment.end_time),a.pageAncestor.put(function(){return i.put(a.appointment).then(function(a){return b&&b.eventAfterOperation&&b.eventAfterOperation(a.data),a})}))},a.del=function(){a.pageAncestor.del(function(){return i.del(a.appointment).then(function(a){return a.data.id?c.path("/appointment"+a.data.id):c.path("/appointments"),a})})},a.loadTags=function(){i.tags().then(function(b){a.localDataTags=b.data})},a.loadTimeZones=function(){var b,c;k.list().then(function(d){if(a.timeZones=d.data,!a.appointment.id){for(b=0,c=a.timeZones.length;c>b;b+=1)if(1===a.timeZones[b]["default"])return void(a.appointment.timezone_name=a.timeZones[b].name);a.timeZones&&(a.appointment.timezone_name=a.timeZones[0].name)}})},a.loadLatestAddress=function(){l.latestAddress().then(function(b){a.localDataAddress=b.data})},a.loadUsers=function(){o.list().then(function(b){a.localDataUsers=b.data})},a.loadSalesPipelineStages=function(){n.listMyStages().then(function(b){a.salesPipelineStages=b.data})},a.getCompanyId=function(){var b=0;return a.appointment.company&&a.appointment.company[0]&&m.isNumber(a.appointment.company[0].id)&&(b=a.appointment.company[0].id),b},a.setSalesPipelineStage=function(b){a.appointment.sales_pipeline_stage_id=a.salesPipelineStages[b].id,a.appointmentTmp.tmpSalesPipelineStage=a.salesPipelineStages[b].name},a.setTimeZone=function(b){a.appointment.timezone_name=a.timeZones[b].name},a.setDateTimeTo=function(b){b||(b=a.getMillisecondsForType()),a.appointmentTmp.tmpEndDate=j.addMilliseconds(a.appointment.start_time,b).toISOString(),a.appointmentTmp.tmpEndTime=j.addMilliseconds(a.appointment.start_time,b).toISOString(),a.appointment.end_time=j.addMilliseconds(a.appointment.start_time,b).toISOString()},a.getMillisecondsForType=function(){var b,c,d=0;if(a.appointment.type_id)for(b=0,c=a.appointmentTypes.length;c>b;b+=1)if(parseInt(a.appointmentTypes[b].id,10)===parseInt(a.appointment.type_id,10)){d=a.appointmentTypes[b].addMs;break}return d},a.setDateFrom=function(b){var c,d,e=a.listDateFrom[b];c=(new Date).toISOString(),"NEXT_FREE_TIME"===e.value?i.nextFreeTime().then(function(b){d=new Date(b.data.next_free_time),d<new Date&&(d=new Date,d.setSeconds(0),d.setMilliseconds(0)),a.appointment.start_time=new Date(d)}):a.appointment.start_time=j.round(j.addMilliseconds(c,e.value),e.rounding,e.roundingLevel),a.calculateDateTime(a.appointment.start_time,!0,null,null,null)},a.setReminder=function(b){a.appointment.reminder=0===a.listReminder[b].value?0:1,a.appointment.reminder_seconds=a.listReminder[b].value,a.appointmentTmp.tmpReminder=a.listReminder[b].name,a.appointmentTmp.tmpReminderPrefix=a.listReminder[b].prefix,a.appointmentTmp.tmpReminderIndex=a.listReminder[b].id},a.setReminderTeamMembers=function(b){a.appointment.team_reminder=0===a.listReminder[b].value?0:1,a.appointment.team_reminder_seconds=a.listReminder[b].value,a.appointmentTmp.tmpTeamReminderPrefix=a.listReminder[b].prefix,a.appointmentTmp.tmpTeamReminder=a.listReminder[b].name},a.setReminderAttendees=function(b){a.appointment.attendee_reminder=0===a.listReminder[b].value?0:1,a.appointment.attendee_reminder_seconds=a.listReminder[b].value,a.appointmentTmp.tmpAttendeeReminderPrefix=a.listReminder[b].prefix,a.appointmentTmp.tmpAttendeeReminder=a.listReminder[b].name},a.setPlace=function(b){switch(a.appointment.place=a.appointmentPlaces[b].name,a.appointmentTmp.tmpPlaceId=a.appointmentPlaces[b].id,parseInt(a.appointmentTmp.tmpPlaceId,10)){case 1:l.businessAddress().then(function(b){var c=b.data;a.appointment.location=m.join([c.business_addr_street,c.business_addr_city,c.business_addr_zip,c.business_addr_country],", ")});break;case 2:l.homeAddress().then(function(b){var c=b.data;a.appointment.location=m.join([c.home_addr_street,c.home_addr_city,c.home_addr_zip,c.home_addr_country],", ")});break;case 3:a.appointment.location="";break;default:a.appointment.location=""}},a.openRecord=function(b){b&&!a.appointment.id&&c.path("/appointment/"+b.id)},a.onSelectOpportunity=function(b){var c=0;a.salesPipelineStages.map(function(a,d){a.id===b.stageId&&(c=d)}),a.setSalesPipelineStage(c)},a.onDeleteOpportunity=function(b){a.setSalesPipelineStage(0)},a.newAppointment=function(){"/appointment"===c.path()&&(a.appointment={}),c.path("/appointment")},a.copyAppointmentAsNew=function(){a.appointment.id&&(r.clear(),a.appointment.id=null,a.appointment.isCopy=!0,r.setData({appointment:a.appointment}),c.path("/appointment"))},a.openInAgenda=function(){a.appointment.id&&(r.clear(),r.setData({selectedDate:a.appointment.start_time}),c.path("/agenda"))},a.openInCalendar=function(){if(a.appointment.id){var b,d;d=new Date(a.appointment.start_time).toISOString(),b=d.substring(d.indexOf("T")+1,d.indexOf(".")),r.clear(),r.setData({appointmentId:a.appointment.id,scrollTime:b,defaultView:p.FULLCALENDAR_WEEK_AGENDA,defaultCalendarDate:d}),c.path("/calendar")}},a.showPill=function(b){var c,d;for(c=0,d=a.pills.length;d>c;c+=1)a.activePillsIndex=c===b?c:a.activePillsIndex,a.pills[c].active=c===b},a.deleteDetailedDescription=function(){a.pageAncestor.confirm(function(){var b={id:a.appointment.text.id};return i.deleteDetailedDescription(b).then(function(b){return a.appointment.text={},a.setPillsDefault(),b})},p.MESSAGE_EXEC_DELETE_TEXT,p.MESSAGE_EXEC_DELETE_TEXT_SUCCESS,p.MESSAGE_EXEC_DELETE_TEXT_ERROR)},a.setPillsDefault=function(){a.pills=[{name:"MAIN"},{name:"EDITOR",count:function(){return a.appointment.text&&a.appointment.text.id?1:null}},{name:"TASKS",count:function(){return a.tasks.length}},{name:"ATTACHMENTS",count:function(){return a.attachmentsInfo.paging&&a.attachmentsInfo.paging.summary?parseInt(a.attachmentsInfo.paging.summary.count,10)||0:0}}],a.activePillsIndex=0,a.pills[0].active=!0},a.afterUpdate=function(b){b&&(a.appointment.text.id=b.textId)},a.getAttachmentsCount=function(){return a.attachmentsInfo.paging&&a.attachmentsInfo.paging.summary&&a.attachmentsInfo.paging.summary.count?parseInt(a.attachmentsInfo.paging.summary.count,10):0},a.addAttachment=function(){a.appointment.id&&(a.showPill(3),a.attachmentsInfo.config.selectFileHash=Math.random())},a.addTask=function(){if(a.appointment.id){var b=a.defaultObjectForTask();r.setData(b),c.path(p.ROUTES.TASK)}},a.defaultObjectForTask=function(){return{task:{subject:a.appointment.subject,company:a.appointment.company,salesPipeline:a.appointment.salesPipeline,appointmentId:a.appointment.id,pathAfterUpdateExt:p.ROUTES.APPOINTMENT+a.appointment.id}}},a.$watch("appointment.company",function(b,c){c!==b&&(a.appointment.salesPipeline=[],a.setSalesPipelineStage(0),a.appointmentTmp.tmpSalesPipeline=null)},!0),a.$watch("appointment.salesPipeline",function(b,c){if(c!==b&&!a.appointment.sales_pipeline_stage_id){var d,e,f=[],g=[];for(d=0,e=a.salesPipelineStages.length;e>d;d+=1)g[d]=f[d]=parseInt(a.salesPipelineStages[d].id,10);a.setSalesPipelineStage(g.indexOf(f.sort()[0]))}},!0),a.$watch("appointment.start_time",function(b,c){c!==b&&e(function(){a.timeSize=a.getTimeFromTwoDate(a.appointment.start_time,a.appointment.end_time,a.appointment.type_id===p.APPOINTMENT_TYPES.ALL_DAY_EVENT)},400)},!0),a.$watch("appointment.end_time",function(b,c){c!==b&&e(function(){a.timeSize=a.getTimeFromTwoDate(a.appointment.start_time,a.appointment.end_time,a.appointment.type_id===p.APPOINTMENT_TYPES.ALL_DAY_EVENT)},400)},!0),a.$watch("appointment.locationBox",function(b,c){c!==b&&(a.appointment.location=a.appointment.locationBox?a.appointment.locationBox[0].name:null)},!0),a.$watch("attachmentsInfo.paging.summary.count",function(b,c){parseInt(c||"0",10)!==parseInt(b||"0",10)&&a.pills.map(function(a){a.hash=Math.random()})},!0),a.pageAncestor=h.getInstance(),a.pageAncestor.init({scope:a,formObject:"appointment",table:"APPOINTMENT"}),a.dp=q.getInstance(),a.dp.init(a),i.setDefaultType(a),a.setDefaultPlaces(),a.loadTags(),a.loadTimeZones(),a.loadLatestAddress(),a.loadSalesPipelineStages(),a.loadUsers(),a.setPillsDefault(),e(function(){a.timeSize=a.getTimeFromTwoDate(a.appointment.start_time,a.appointment.end_time,a.appointment.type_id===p.APPOINTMENT_TYPES.ALL_DAY_EVENT)},600),a.initButtons(),e(function(){a.pageAncestor.setDefault()},1e3),$("#btTimeStart").focusout(function(){$("#groupTimepickerStart .timepicker").remove(),a.showTPstart=!1,a.$apply()}),$("#btTimeEnd").focusout(function(){$("#groupTimepickerEnd .timepicker").remove(),a.showTPend=!1,a.$apply()})}]),angular.module("crmPostgresWebApp").service("AppointmentService",["$http","$timeout","DateService","Tools",function(a,b,c,d){return{types:function(){return a.get("/api/appointment/types",{cache:!1}).error(function(a){console.log(a)})},places:function(){return a.get("/api/appointment/places",{cache:!1}).error(function(a){console.log(a)})},tags:function(){return a.get("/api/appointment/tags",{cache:!1}).error(function(a){console.log(a)})},nextFreeTime:function(){return a.get("/api/appointment/login-user/next-free-time",{cache:!1}).error(function(a){console.log(a)})},post:function(b){return a.post("/api/appointments",b).error(function(a){console.log(a)})},put:function(b){return a.put("/api/appointments/"+b.id,b).error(function(a){console.log(a)})},get:function(b){return a.get("/api/appointments/"+b,{cache:!1}).error(function(a){console.log(a)})},del:function(b){return a["delete"]("/api/appointments/"+b.id,{cache:!1}).error(function(a){console.log(a)})},listForCalendar:function(b){var c=b.ownerId?"?":"";return a.get("/api/appointments/calendar/current/"+(b.ownerId||"")+c+d.objectToQueryString(b),{
cache:!1}).error(function(a){console.log(a)})},putFromCalendar:function(b,c){return a.put("/api/appointments/"+b+"/calendar",c).error(function(a){console.log(a)})},calculateDateTime:function(a,d,e,f,g,h){(!a.appointment.id||a.isEnableCalculate)&&b(function(){var b,i,j,k,l,m,n,o=!1,p=!1,q=!0;b=c.getDateWithMomemtJs(a.appointmentTmp.tmpStartDate,$("#XXX11").val()),i=c.getDateWithMomemtJs(a.appointmentTmp.tmpEndDate,$("#XXX13").val()),j=c.getDateTimeWithMomemtJs(a.appointment.start_time,a.appointmentTmp.tmpStartTime,$("#XXX12").val()),k=c.getDateTimeWithMomemtJs(a.appointment.end_time,a.appointmentTmp.tmpEndTime,$("#XXX14").val()),2===parseInt(a.appointment.type_id,10)?(a.timeFromReadOnly=!0,a.timeToReadOnly=!0,i=b,j&&(j=new Date(j.setHours(0,0,0,0))),a.appointment.start_time&&(a.appointment.start_time=new Date(a.appointment.start_time.setHours(0,0,0,0)))):(a.timeFromReadOnly=!1,a.timeToReadOnly=!1),i&&b&&b>i&&"end_time"===g&&(a.appointment.end_time=k?c.setTime(i,k):i,o=!0,p=!0,q=!1),k&&j&&j>k&&"end_time"===g&&(a.appointment.end_time=k?c.setTime(b,k):b,i=b,k=j,o=!0,p=!0,q=!1,$("#XXX14").is(":focus")||(h=!0)),k&&j&&j>k&&"start_time"===g&&(a.appointment.end_time=k?c.setTime(b,k):b,o=!0,q=!0),e||o?(d?l=new Date(d):(p?a.appointment.end_time&&(n=j?c.setTime(new Date(a.appointment.end_time),j):new Date(a.appointment.end_time).setHours(0,0,0,0)):a.appointment.start_time&&(n=j?c.setTime(new Date(a.appointment.start_time),j):a.appointment.start_time),n?l=new Date(n):(l=new Date,l=l.setSeconds(0),l=l.setMilliseconds(0))),m=q?new Date(new Date(l).setMilliseconds(a.appointmentTmp.tmpTypeItem.addMs)):c.setTime(new Date(l),k)):(l=j?c.setTime(b,j):b,m=k?c.setTime(i,k):i),a.appointment.start_time=l,a.appointment.end_time=m,f&&"tmpStartDate"===f||(a.appointmentTmp.tmpStartDate=l.toISOString()),f&&"tmpEndDate"===f||(a.appointmentTmp.tmpEndDate=m.toISOString()),f&&"tmpStartTime"===f||(a.appointmentTmp.tmpStartTime=l.toISOString()),f&&"tmpEndTime"===f||(a.appointmentTmp.tmpEndTime=m.toISOString()),h&&(a.appointmentTmp[f]=new Date(a.appointment[g]).toISOString())},400)},setDefaultType:function(a){var b,c;for(a.appointment.type_id=parseInt(a.appointment.type_id,10)||3,b=0,c=a.appointmentTypes.length;c>b;b+=1){switch(parseInt(a.appointmentTypes[b].id,10)){case 1:a.appointmentTypes[b].addMs=9e5;break;case 2:a.appointmentTypes[b].addMs=0;break;case 3:a.appointmentTypes[b].addMs=72e5;break;case 4:a.appointmentTypes[b].addMs=36e5}a.appointment.type_id===parseInt(a.appointmentTypes[b].id,10)&&(a.appointmentTmp.tmpTypeName=a.appointmentTypes[b].name,a.appointmentTmp.tmpTypeItem=a.appointmentTypes[b])}this.calculateDateTime(a,null,a.appointment.id?!1:!0,null,null,null)},setType:function(a,b){var d=null;a.appointment.type_id=a.appointmentTypes[b].id,a.appointmentTmp.tmpTypeName=a.appointmentTypes[b].name,a.appointmentTmp.tmpTypeItem=a.appointmentTypes[b],2!==parseInt(a.appointment.type_id,10)&&(d=c.round(new Date,[0,30,60],"mi")),this.calculateDateTime(a,d,!0,null,null,null)},setDefaultPlaces:function(a){var b,c;if(!a.appointment.place)for(a.appointmentTmp.tmpPlaceId=3,b=0,c=a.appointmentPlaces.length;c>b;b+=1)parseInt(a.appointmentPlaces[b].id,10)===a.appointmentTmp.tmpPlaceId&&(a.appointment.place=a.appointmentPlaces[b].name)},list:function(b){return a.get("/api/appointments?"+d.objectToQueryString(b)).error(function(a){console.log(a)})},deleteDetailedDescription:function(b){return a["delete"]("/api/texts/"+b.id).error(function(a){console.log(a)})}}}]),angular.module("crmPostgresWebApp").service("TimeZonesService",["$http",function(a){return{list:function(){return a.get("/api/timezones",{cache:!1}).error(function(a){console.log(a)})}}}]),angular.module("crmPostgresWebApp").service("DatepickerFactory",["$timeout","$locale","Tools","DateService","Language",function(a,b,c,d,e){var f=function(){var f={};this.init=function(a){f=a,f.opened={},f.minDate=new Date(1899,1,1),f.format="d.M.yyyy",f.formatTime=b.DATETIME_FORMATS.shortTime,f.getLanguage=e.getLanguage,f.$watch("getLanguage()",function(a,c){a!==c&&(f.format="d.M.yyyy",f.formatTime=b.DATETIME_FORMATS.shortTime,d.setFormat(f.format),d.setFormatTime(b.DATETIME_FORMATS.shortTime),f.minDate=new Date(f.minDate.getTime()))})},this.open=function(b,c){a(function(){f.opened[b]=!f.opened[b],$("#"+c).focus()},100)},this.invalidDate=function(a){return $("#"+a).val()?!c.validateDate($("#"+a).val(),null):!1},this.disabledDateTo=function(a,b,c){return"day"===b&&a<new Date(new Date(c)).setHours(0,0,0,0)}};this.getInstance=function(){return new f}}]),angular.module("crmPostgresWebApp").controller("ReminderCtrl",["$scope","$location","$timeout","$translate","$translatePartialLoader","PageAncestor","Tools","ReminderService","DatepickerFactory","DateService","Constants","initialData",function(a,b,c,d,e,f,g,h,i,j,k,l){var m;e.addPart("reminder"),d.refresh(),a.reminder=l.reminder,a.reminderTmp={},a.reminderTmp.remindBox=[],a.reminderTmp.remindPersonName="",a.reminderTmp.remindPersonNameModel="",a.validateEmail=g.validateEmail,a.reminderTimes=[{prefix:"",name:"RIGHT_NOW",value:0},{prefix:"",name:"NEXT_WORKING_DAY",value:"NWD"},{prefix:"",name:"IN_24_HOURS",value:864e5},{prefix:"",name:"IN_A_WEEK",value:6048e5},{prefix:"",name:"IN_A_MONTH",value:"M"}],a.loginUserEmails=[],a.reminder.id||"{}"!==JSON.stringify(l.reminder)?(a.reminderTmp.type={},a.reminderTmp.remind=a.reminder.remind,a.reminderTmp.originalDate=a.reminder.original_time,a.reminderTmp.originalTime=a.reminder.original_time,2===parseInt(a.reminder.remind,10)&&(a.reminderTmp.remindPersonName=a.reminder.remind_person_name,a.reminderTmp.remindPersonNameModel=a.reminder.remind_person_name,a.reminderTmp.remindBox[0]={id:a.reminder.remind_id,name:a.reminder.remind_name,name2:a.reminder.remind_person_name,email:a.reminder.remind_email,email2:a.reminder.remind_email2})):(m=j.round(new Date,[0,60],"mi"),m.setSeconds(0),m.setMilliseconds(0),m=m.toISOString(),a.reminder.original_time=m,a.reminder.recipient_id=a.meta.ownerId,a.reminderTmp.originalDate=m,a.reminderTmp.originalTime=m,a.reminderTmp.remind=1,a.reminderTmp.type={}),a.setRecipient=function(){var b=function(){return a.reminderTmp.remindBox.length>0?a.reminderTmp.remindBox[0].id:null};a.reminder.recipient_id=1===parseInt(a.reminderTmp.remind,10)?a.meta.ownerId:b()},a.initType=function(){a.reminderTmp.type.subject=a.reminder.type_subject,a.reminder.appointment_id&&(a.reminderTmp.type.name="APPOINTMENT"),a.reminder.task_id&&(a.reminderTmp.type.name="TASK"),a.reminder.goal_id&&(a.reminderTmp.type.name="GOAL"),a.reminderTmp.type.exist=a.reminderTmp.type.name?!0:!1},a.initEmails=function(){var b,c;1===parseInt(a.reminderTmp.remind,10)?(b=l.people.email,c=l.people.email2):(b=a.reminderTmp.remindBox[0]?a.reminderTmp.remindBox[0].email:null,c=a.reminderTmp.remindBox[0]?a.reminderTmp.remindBox[0].email2:null),a.loginUserEmails=[],b&&a.loginUserEmails.push(b),c&&a.loginUserEmails.push(c)},a.onRecipientPersonChange=function(){a.reminderTmp.remindBox.length>0&&a.reminderTmp.remindBox[0].name2!==a.reminderTmp.remindPersonName&&(a.reminderTmp.remindBox=[],a.setRecipient())},a.initButtons=function(){var b={};a.actionButtons=[{name:"DELETE",dropDown:[{name:"DELETE_REMINDER",onClick:a.del,disabled:function(){return!a.reminder.id}}],disabled:!a.reminder.id},{name:"CANCEL",onClick:a.pageAncestor.cancel,disabled:function(){return!a.pageAncestor.log.changes.isChanged}}],b=a.reminder.id?{name:"SAVE",onClick:a.put,disabled:function(){return!1}}:{name:"SAVE",onClick:a.post,disabled:function(){return!1}},a.actionButtons.push(b)},a.setDate=function(b){var c=j.addMilliseconds(new Date,a.reminderTimes[b].value).toISOString();a.reminder.original_time=c,a.reminderTmp.originalDate=c,a.reminderTmp.originalTime=c},a.verifyForm=function(){var b,c,d=!0,e=[];for(e.push({message:"WARNING_FIELD_VALUE_INVALID"}),a.reminder.recipient_id||(d=!1,e.push({message:"RECIPIENT_ID"})),a.reminder.subject||(d=!1,e.push({message:"SUBJECT"})),a.reminder.original_time&&new Date(a.reminder.original_time)>new Date(1899,0,1)||(d=!1,e.push({message:"DATE_TIME"})),!a.reminder.email_rem||g.validateEmail(a.reminder.email)&&""!==a.reminder.email&&null!==a.reminder.email&&void 0!==a.reminder.email||(d=!1,e.push({message:"EMAIL"})),b=0,c=e.length;c>b;b+=1)b>1&&(e[b].prefix=", ");return d||a.pageAncestor.addAlert({type:k.MESSAGE_WARNING_VALIDATION_BEFORE_CRUD,messages:e}),d},a.post=function(){a.verifyForm()&&a.pageAncestor.post(function(){return h.post(a.reminder).then(function(a){return a.data.id&&b.path("/reminder/"+a.data.id),a})})},a.put=function(){a.verifyForm()&&a.pageAncestor.put(function(){return h.put(a.reminder).then(function(a){return a})})},a.del=function(){a.pageAncestor.del(function(){return h.del(a.reminder).then(function(a){return a.data.id?b.path("/reminder/"+a.data.id):b.path("/reminders"),a})})},a.$watch("reminderTmp.remindBox",function(b,c){c!==b&&(a.initEmails(),a.setRecipient())},!0),a.$watch("reminderTmp.remind",function(b,c){c!==b&&a.initEmails()},!0),a.$watch("reminderTmp.remindPersonName",function(b,c){c!==b&&""!==c&&a.reminderTmp.remindBox.length>0&&a.onRecipientPersonChange()},!0),a.$watch("reminderTmp.originalDate",function(b,c){var d,e;c!==b&&(d=j.getDateWithMomemtJs(a.reminderTmp.originalDate,$("#XXX7").val()),e=j.getDateTimeWithMomemtJs(a.reminder.original_time,a.reminderTmp.originalTime,$("#XXX8").val()),a.reminder.original_time=b?new Date(e?j.setTime(d,e):d):null)},!0),a.$watch("reminderTmp.originalTime",function(b,c){var d,e;c!==b&&(d=j.getDateWithMomemtJs(a.reminderTmp.originalDate,$("#XXX7").val())||new Date,e=j.getDateTimeWithMomemtJs(a.reminder.original_time,a.reminderTmp.originalTime,$("#XXX8").val()),a.reminder.original_time=b?new Date(e?j.setTime(d,e):d):null)},!0),a.pageAncestor=f.getInstance(),a.pageAncestor.init({scope:a,formObject:"reminder",table:"REMINDER"}),a.dp=i.getInstance(),a.dp.init(a),a.initButtons(),a.initEmails(),a.initType(),c(function(){a.pageAncestor.setDefault()},1e3),$("#btTimeStart").focusout(function(){$("#groupTimepickerStart .timepicker").remove(),a.showTPstart=!1,a.$apply()})}]),angular.module("crmPostgresWebApp").controller("RemindersCtrl",["$scope","$location","$translate","$translatePartialLoader","ReminderService","initialData",function(a,b,c,d,e,f){d.addPart("reminders"),c.refresh(),a.reminders=[],a.searchStr="",a.dataLoaderParams={sortField:"original_time",sortDirection:"desc"},a.infoPaging={},a.setSearch=function(b){13===b.which&&(a.dataLoaderParams.searchStr=a.searchStr)},a.newReminder=function(){a.reminder={},b.path("/reminder")},a.reminders=f.reminders,a.dataLoader=e.list}]),angular.module("crmPostgresWebApp").service("MessengerService",["Tools",function(a){var b={},c=!1;this.setData=function(a){b=a},this.getData=function(){var d=a.createObject(b);return c&&(b={}),d},this.clear=function(){b={}},this.setDeleteObjectAfterTransfer=function(a){c=a}}]),angular.module("crmPostgresWebApp").service("ReminderService",["$http","Tools",function(a,b){return{post:function(b){return a.post("/api/reminder",b).error(function(a){console.log(a)})},put:function(b){return a.put("/api/reminder/"+b.id,b).error(function(a){console.log(a)})},get:function(b){return a.get("/api/reminder/"+b,{cache:!1}).error(function(a){console.log(a)})},del:function(b){return a["delete"]("/api/reminder/"+b,{cache:!1}).error(function(a){console.log(a)})},list:function(c){return a.get("/api/reminders?"+b.objectToQueryString(c),{cache:!1}).error(function(a){console.log(a)})},listForCalendar:function(c){var d=c.ownerId?"?":"";return a.get("/api/reminders/calendar/current/"+(c.ownerId||"")+d+b.objectToQueryString(c),{cache:!1}).error(function(a){console.log(a)})},putFromCalendar:function(b,c){return a.put("/api/reminder/"+b+"/calendar",c).error(function(a){console.log(a)})},markAsDone:function(b){return a.post("/api/reminder/"+b+"/mark-as-done",{id:b}).error(function(a){console.log(a)})}}}]),angular.module("crmPostgresWebApp").controller("CalendarCtrl",["$rootScope","$scope","$location","$compile","$filter","$timeout","$translate","$translatePartialLoader","uiCalendarConfig","$popover","Language","ReminderService","AppointmentService","DateService","PageAncestor","Constants","DatepickerFactory","$tooltip","TimeZonesService","Tools","initialData",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){h.addPart("calendar"),g.refresh(),b.getLanguage=k.getLanguage,b.calculateDateTime=function(a,c,d,e,f){m.calculateDateTime(b,a,c,d,e,f)},b.setAppointmentType=function(a){m.setType(b,a)},b.usersWithoutOwner=u.usersWithoutOwner,b.mw=[],b.mwn={},b.appointment={},b.appointmentTmp={},b.templatesPopover=["views/calendar_item_popover_appointment.html","views/calendar_item_popover_reminder.html"],b.showNewRecordDialogAppointment=!1,b.appointmentTypes=[],b.appointmentPlaces=[],b.timeZones=[],b.stopPropagation=!1,b.defaultTimezoneName="",b.timeFromReadOnly=!1,b.timeToReadOnly=!1,b.radioOwner=1,b.showReminders=!0,b.selectOwner={},b.appointmentsCalendar=u.appointmentsCalendar,b.reminderCalendar=u.reminderCalendar,b.eventSources=[u.appointmentsCalendar,u.reminderCalendar],b.defaultCalendarDate=new Date("2015-05-10T00:00:00.000Z"),b.dayOnClick=function(a,c,d){b.mwn.left=c.pageX,b.mwn.top=c.pageY,b.mwn.dateFormat=n.getFormat(),b.mwn.timeFormat=n.getFormatTime(),b.initNewAppointment(a,c,d)},b.eventOnDrop=function(a,b,c,d,e,f){var g,h;a.type===p.TYPE_CALENDAR_EVENT_APPOINTMENT?m.putFromCalendar(a.id,{id:a.id,start_time:a.start._d,end_time:a.end._d}):a.type===p.TYPE_CALENDAR_EVENT_REMINDER&&(h=b._milliseconds+24*b._days*60*60*1e3,g=n.addMonths(n.addMilliseconds(a.reminder_time,h),b._months),l.putFromCalendar(a.id,{id:a.id,original_time:a.start._d,reminder_time:g}))},b.eventOnResize=function(a,b,c,d,e,f){a.type===p.TYPE_CALENDAR_EVENT_APPOINTMENT?m.putFromCalendar(a.id,{id:a.id,start_time:a.start._d,end_time:a.end._d}):a.type===p.TYPE_CALENDAR_EVENT_REMINDER&&c()},b.changeView=function(a,b){i.calendars[b].fullCalendar("changeView",a)},b.renderCalender=function(a){i.calendars[a]&&i.calendars[a].fullCalendar("render")},b.eventRender=function(a,c,d){b.markEventAppointment(a,c),b.setDblClickForEvent(a,c),b.setViewForEvent(a,c,d),b.mw[a.id]=a,b.mw[a.id].attendeesArray=a.attendees?a.attendees.split(","):[],j(c,{content:a.id,scope:b,html:!0,trigger:"hover",placement:"top",template:"APPOINTMENT"===a.type?b.templatesPopover[0]:b.templatesPopover[1],container:"body"})},b.initNewAppointment=function(a,c,d){var e,f=new Date,g=new Date(a._d);b.appointment={},b.appointment.timezoneName=b.defaultTimezoneName,e="month"===d.name?n.setTime(g,f):g,b.appointment.start_time=e,b.appointment.end_time=null,b.appointmentTmp.tmpStartDate=e.toISOString(),b.appointmentTmp.tmpStartTime=e.toISOString(),b.appointmentTmp.tmpEndDate=e.toISOString(),b.appointmentTmp.tmpEndTime=e.toISOString(),b.showNewRecordDialogAppointment=!0,m.setDefaultType(b),m.setDefaultPlaces(b)},b.goToEvent=function(a){a.type===p.TYPE_CALENDAR_EVENT_REMINDER?c.path("/reminder/"+a.id):a.type===p.TYPE_CALENDAR_EVENT_APPOINTMENT&&c.path("/appointment/"+a.id)},b.postAppointment=function(){var a={};a.recipient_id=b.meta.ownerId,a.type_id=b.appointment.type_id,a.subject=b.appointment.subject,a.place=b.appointment.place,a.start_time=n.setDateAsUTC0(b.appointment.start_time),a.end_time=n.setDateAsUTC0(b.appointment.end_time),a.timezone_name=b.appointment.timezoneName,a.type=p.TYPE_CALENDAR_EVENT_APPOINTMENT,b.verifyFormAppointment(a)&&b.pageAncestor.post(function(){return m.post(a).then(function(c){return c.data.id&&b.appointmentCalendar.push({id:c.data.id,type:a.type,typeId:String(a.type_id),place:a.place,title:a.subject,start:b.appointment.start_time.toISOString(),end:b.appointment.end_time.toISOString(),backgroundColor:t.getColorEventForCalendar({type:a.type,typeId:a.type_id}),editable:!(new Date(a.end)-new Date(a.start)<18e5||a.allDay)}),c})}),b.showNewRecordDialogAppointment=!1},b.verifyFormAppointment=function(a){var c,d,e=!0,f=[];for(f.push({message:"WARNING_FIELD_VALUE_INVALID"}),a.recipient_id||(e=!1,f.push({message:"RECIPIENT_ID"})),a.type_id||(e=!1,f.push({message:"TYPE_ID"})),a.subject||(e=!1,f.push({message:"SUBJECT"})),a.start_time&&new Date(a.start_time)>new Date(1899,0,1)||(e=!1,f.push({message:"DATE_FROM"})),a.end_time&&new Date(a.end_time)>new Date(1899,0,1)||(e=!1,f.push({message:"DATE_TO"})),a.timezone_name||(e=!1,f.push({message:"TIME_ZONE"})),c=0,d=f.length;d>c;c+=1)c>1&&(f[c].prefix=", ");return e||b.pageAncestor.addAlert({type:p.MESSAGE_WARNING_VALIDATION_BEFORE_CRUD,messages:f}),e},b.loadAppointmentTypes=function(){m.types().then(function(a){b.appointmentTypes=a.data})},b.loadAppointmentPlaces=function(){m.places().then(function(a){b.appointmentPlaces=a.data})},b.loadTimeZones=function(){var a,c;s.list().then(function(d){for(b.timeZones=d.data,a=0,c=b.timeZones.length;c>a;a+=1)if(1===b.timeZones[a]["default"])return void(b.defaultTimezoneName=b.timeZones[a].name)})},b.setPlace=function(a){b.appointment.place=b.appointmentPlaces[a].name,b.appointmentTmp.tmpPlaceId=b.appointmentPlaces[a].id},b.setTimeZone=function(a){b.appointment.timezoneName=b.timeZones[a].name},b.getTimezone=function(){b.showTimezone=!b.showTimezone,b.timezone=(new Date).toString()},b.changeCalendarConditions=function(a){f(function(){var c=0===parseInt(b.radioOwner,10)?b.selectOwner.id:b.meta.ownerId;c&&(a.ownerId=c,m.listForCalendar(a).then(function(a){b.appointmentCalendar=a.data,b.eventSources[0]=b.appointmentCalendar}),l.listForCalendar(a).then(function(a){b.reminderCalendar=a.data,b.eventSources[1]=b.reminderCalendar}))},100)},b.remindersChange=function(a){a&&(b.showReminders=!b.showReminders),b.showReminders?b.eventSources[1]=b.reminderCalendar:b.eventSources.splice(1,1)},b.markEventAppointment=function(a,b){u.appointmentId&&parseInt(a.id,10)===parseInt(u.appointmentId,10)&&a.type===p.TYPE_CALENDAR_EVENT_APPOINTMENT&&(b.fadeOut(700).delay(300).fadeIn(600),u.appointmentId=null)},b.setDblClickForEvent=function(a,c){c.bind("dblclick",function(){$(".popover").hide(),b.goToEvent(a),b.$apply()})},b.setViewForEvent=function(a,b,c){a.type===p.TYPE_CALENDAR_EVENT_APPOINTMENT&&b.append('<div class="fc-title">'+(a.location||"")+"</div>")},b.events=function(a,c,d,e){b.changeCalendarConditions({startTime:a._d.toISOString(),endTime:c._d.toISOString()}),e({})},b.uiConfig={calendar:{defaultDate:u.defaultCalendarDate,eventSources:b.eventSources,timezone:"local",lang:k.getLanguageCalendar(),monthNames:k.getMonthNames(),selectable:!0,scrollTime:u.scrollTime||"06:00:00",slotDuration:"00:30:00",snapDuration:"00:30:00",defaultTimedEventDuration:"00:00:00",timeFormat:n.getFormatTime()||"H:mm",eventLimit:{agenda:3,"default":!0},firstDay:1,buttonText:{today:e("translate")("TODAY"),day:e("translate")("DAY"),week:e("translate")("WEEK"),month:e("translate")("MONTH")},defaultView:u.defaultView||"agendaWeek",height:600,editable:!0,header:{left:"month agendaWeek agendaDay",center:"title",right:"today prev,next"},eventDrop:b.eventOnDrop,eventResize:b.eventOnResize,eventRender:b.eventRender,events:b.events,dayClick:b.dayOnClick}},b.$watch("getLanguage()",function(a,c){a!==c&&$("#calendar").fullCalendar(b.uiConfig.calendar)},!0),b.pageAncestor=o.getInstance(),b.pageAncestor.init({scope:b,formObject:"reminder",table:"REMINDER"}),b.dp=q.getInstance(),b.dp.init(b),b.loadAppointmentTypes(),b.loadAppointmentPlaces(),b.loadTimeZones(),$(".btTimeStart").focusout(function(){$(".groupTimepickerStart .timepicker").remove(),b.showTPstart=!1,b.$digest()}),$(".btTimeEnd").focusout(function(){$(".groupTimepickerEnd .timepicker").remove(),b.showTPend=!1,b.$digest()}),$("html").click(function(){b.stopPropagation||(b.showNewRecordDialogAppointment=!1,b.$digest())}),$("#mwnCalendarAppointment").click(function(a){b.opened.appointmentDateFrom=!1,b.opened.appointmentDateTo=!1,b.$digest(),b.stopPropagation=!0})}]),angular.module("crmPostgresWebApp").controller("AgendaCtrl",["$scope","$filter","$window","$location","$q","$locale","$translate","$translatePartialLoader","DateService","Tools","AgendaService","Constants","DatepickerFactory","ReminderService","PageAncestor","TasksService","AlertsService","MessengerService","AppointmentService","UsersService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){h.addPart("agenda"),g.refresh();var u=i.setDateAsUTC0(new Date((new Date).setHours(0,0,0,0)));a.usersWithoutOwner=[],a.allUsersMenuItem={id:-1,name:b("translate")("TEAM_AGENDA")},a.selectedTeamUser=a.allUsersMenuItem,a.weeks={},a.daysOfWeek=[{id:1,name:f.DATETIME_FORMATS.DAY[1]},{id:2,name:f.DATETIME_FORMATS.DAY[2]},{id:3,name:f.DATETIME_FORMATS.DAY[3]},{id:4,name:f.DATETIME_FORMATS.DAY[4]},{id:5,name:f.DATETIME_FORMATS.DAY[5]},{id:6,name:f.DATETIME_FORMATS.DAY[6]},{id:0,name:f.DATETIME_FORMATS.DAY[0]}],a.routeCurrentDate=r.getData().selectedDate,a.routeStartDate=a.routeCurrentDate?i.moveToDayOfWeek(a.routeCurrentDate,1):null,a.startISODate=i.clearISOTime((a.routeStartDate||new Date(u.setDate(u.getDate()-(u.getDay()-1)))).toISOString()),a.weekStartDate=a.startISODate,a.weekEndDate=new Date(a.startISODate).setMilliseconds(24*(a.daysOfWeek.length-1)*60*60*1e3),a.agenda={},a.agenda.weekSelectDate=new Date(a.startISODate),a.collapseDays={},a.sortDayTypes=[l.AGENDA_TYPE_APPOINTMENT_PHONE_CALL,l.AGENDA_TYPE_APPOINTMENT_BUSINESS_MEETING,l.AGENDA_TYPE_APPOINTMENT_OTHER,l.AGENDA_TYPE_APPOINTMENT_ALL_DAY_EVENT,l.AGENDA_TYPE_TASK,l.AGENDA_TYPE_REMINDER,l.AGENDA_TYPE_BIRTHDAY,l.AGENDA_TYPE_ANNIVERSARY],a.actionsForDay=[{type:l.AGENDA_TYPE_APPOINTMENT_PHONE_CALL,name:b("translate")("PHONE_CALL")},{type:l.AGENDA_TYPE_APPOINTMENT_BUSINESS_MEETING,name:b("translate")("BUSINESS_MEETING")},{type:l.AGENDA_TYPE_APPOINTMENT_OTHER,name:b("translate")("OTHER_APPOINTMENT")},{type:l.AGENDA_TYPE_APPOINTMENT_ALL_DAY_EVENT,name:b("translate")("ALL_DAY_EVENT")},{type:l.AGENDA_TYPE_REMINDER,name:b("translate")("REMINDER")}],a.timeFormat=i.getFormatTime(),a.show={myAgenda:!0,teamAgenda:!1},a.usersForFilter=[{id:a.meta.ownerId,name:a.meta.ownerName}],a.showAsList=!1,a.dataLoaderParams={sortField:'"datePrimary"',sortDirection:"asc",datePrimary:i.clearISOTime(new Date(null).toISOString())},a.infoPaging={},a.list=[],a.loadDataForList=null,a.directionButton=2,a.dashboardsToggle={},a.agenda.dataForMenuActions={},a.loadDataWeek=function(a,b){var c=e.defer();return b&&b.length>0?c.resolve(b):k.listForWeek(a).then(function(a){c.resolve(a)}),c.promise},a.createWeek=function(b,c){var d=i.clearISOTime(new Date(b).toISOString());a.weeks[d]||(a.weeks[d]={days:[]},a.createDays(d,a.weeks[d]),a.loadDataWeek(d,c).then(function(b){var c,e;for(c=0,e=b.data.length;e>c;c+=1)new Date(b.data[c].datePrimary)instanceof Date&&(b.data[c].datePrimary=i.clearISOTime(i.setDateAsUTC0(new Date(b.data[c].datePrimary).setHours(0,0,0,0)).toISOString()));a.loadDataForDays(a.weeks[d],b.data),a.initCollapse(a.weeks[d].days)}))},a.createDays=function(b,c){var d,e,f,g={};for(d=0,e=a.daysOfWeek.length;e>d;d+=1)g=Object.create(a.daysOfWeek[d]),f=i.moveToDayOfWeek(b,g.id).toISOString(),g.prefix=i.getTimeLineString(f),g.date=i.clearISOTime(f),c.days.push(g)},a.loadDataForDays=function(b,c){var d,e,f;for(f=j.objectFromArrayByGroup(c,"datePrimary"),d=0,e=b.days.length;e>d;d+=1)b.days[d].types=f[b.days[d].date]?j.sortArrayWithObjectsIntoGroups(f[b.days[d].date].rows,"type",a.sortDayTypes):{count:0},b.days[d].dayEvents=f[b.days[d].date]?f[b.days[d].date].rows:[]},a.setCollapse=function(b){a.collapseDays[b]=!a.collapseDays[b]},a.collapseAll=function(b){var c;for(c in a.collapseDays)a.collapseDays.hasOwnProperty(c)&&(a.collapseDays[c]=b)},a.prevWeek=function(){a.startISODate=i.clearISOTime(i.addMilliseconds(a.startISODate,24*a.daysOfWeek.length*60*60*1e3*-1).toISOString()),a.createWeek(a.startISODate,null)},a.nextWeek=function(){a.startISODate=i.clearISOTime(i.addMilliseconds(a.startISODate,24*a.daysOfWeek.length*60*60*1e3).toISOString()),a.createWeek(a.startISODate,null)},a.customWeek=function(){a.startISODate=i.clearISOTime(new Date(a.agenda.weekSelectDate).toISOString()),a.createWeek(a.startISODate,null)},a.thisWeek=function(){a.startISODate=i.clearISOTime(new Date(u.setDate(u.getDate()-(u.getDay()-1))).toISOString()),a.createWeek(a.startISODate,null)},a.twoWeek=function(){a.startISODate=i.clearISOTime(new Date(new Date(u.setDate(u.getDate()-(u.getDay()-1))).setMilliseconds(24*a.daysOfWeek.length*60*60*1e3)).toISOString()),a.createWeek(a.startISODate,null)},a.recalculateWeekDateRange=function(){var b=a.agenda.weekSelectDate;a.weekStartDate=new Date(b.setDate(b.getDate()-(b.getDay()-1))),a.weekEndDate=new Date(new Date(a.weekStartDate).setMilliseconds(24*(a.daysOfWeek.length-1)*60*60*1e3))},a.selectTeamUser=function(b){a.selectedTeamUser=-1===b?a.allUsersMenuItem:a.usersWithoutOwner[b],a.changeUserFilter(b)},a.changeUserFilter=function(){var b,c;if(a.usersForFilter.splice(0,a.usersForFilter.length),a.show.teamAgenda)if(-1===a.selectedTeamUser.id)for(b=0,c=a.usersWithoutOwner.length;c>b;b+=1)a.usersForFilter.push(a.usersWithoutOwner[b]);else a.usersForFilter.push(a.selectedTeamUser);a.show.myAgenda&&a.usersForFilter.push({id:a.meta.ownerId,name:a.meta.ownerName})},a.getEventsForDay=function(c){var d,e,f,g,h,i=[];if(!c||!c.types)return 0;for(d=0,e=a.sortDayTypes.length;e>d;d+=1)if(h=c.types[a.sortDayTypes[d]])for(f=0,g=h.length;g>f;f+=1)i.push(h[f]);return b("filterOwner")(i,{list:a.usersForFilter}).length},a.delReminder=function(b,c){a.pageAncestor.del(function(){return n.del(b.id).then(function(d){return a.deleteDayEvent(b,c),d})})},a.delTask=function(b,c){a.pageAncestor.del(function(){return p.del(b.id).then(function(d){return a.deleteDayEvent(b,c),d})})},a.delAppointment=function(b,c){a.pageAncestor.del(function(){return s.del(b).then(function(d){return a.deleteDayEvent(b,c),d})})},a.deleteDayEvent=function(a,b){var c,d,e;for(c=b.types[a.type],d=0,e=c.length;e>d;d+=1)if(c[d].id===a.id){c.splice(d,1);break}if(b.dayEvents)for(c=b.dayEvents,d=0,e=c.length;e>d;d+=1)if(c[d].id===a.id){c.splice(d,1);break}},a.sendEmail=function(a){c.location.href="mailto:"+a},a.markAsDone=function(c,d){c.type===l.AGENDA_TYPE_REMINDER&&n.markAsDone(c.id).then(function(e){e.data.message&&e.data.message.type===l.MESSAGE_SUCCESS&&(a.deleteDayEvent(c,d),q.add({type:l.MESSAGE_ERROR,message:b("translate")("MARK_AS_DONE_EXECUTE_SUCCESS")}))}),c.type===l.AGENDA_TYPE_TASK&&p.markAsDone(c.id).then(function(e){e.data.message&&e.data.message.type===l.MESSAGE_SUCCESS&&(a.deleteDayEvent(c,d),q.add({type:l.MESSAGE_ERROR,message:b("translate")("MARK_AS_DONE_EXECUTE_SUCCESS")}))})},a.copyToNew=function(a){var b;r.clear(),a.type===l.AGENDA_TYPE_REMINDER&&n.get(a.id).then(function(a){b=a.data,b.id=null,r.setData(b),d.path("/reminder")}),a.type===l.AGENDA_TYPE_TASK&&p.get(a.id).then(function(a){b=a.data,b.id=null,r.setData({task:b}),d.path("/task")}),(a.type===l.AGENDA_TYPE_APPOINTMENT_ALL_DAY_EVENT||a.type===l.AGENDA_TYPE_APPOINTMENT_BUSINESS_MEETING||a.type===l.AGENDA_TYPE_APPOINTMENT_OTHER||a.type===l.AGENDA_TYPE_APPOINTMENT_PHONE_CALL)&&s.get(a.id).then(function(a){b=a.data,b.id=null,r.setData({appointment:b}),d.path("/appointment")})},a.dayAction=function(a,b){var c,e,f,g=i.round(new Date,[0,30,60],"mi");f=i.setDateAsUTC0(new Date(b.date).setHours(g.getHours(),g.getMinutes(),g.getSeconds(),0)).toISOString(),r.clear(),a.type===l.AGENDA_TYPE_APPOINTMENT_PHONE_CALL&&(c={appointment:{start_time:f,end_time:f,type_id:"1"}},e="/appointment"),a.type===l.AGENDA_TYPE_APPOINTMENT_ALL_DAY_EVENT&&(c={appointment:{start_time:f,end_time:f,type_id:"2"}},e="/appointment"),a.type===l.AGENDA_TYPE_APPOINTMENT_BUSINESS_MEETING&&(c={appointment:{start_time:f,end_time:f,type_id:"3"}},e="/appointment"),a.type===l.AGENDA_TYPE_APPOINTMENT_OTHER&&(c={appointment:{start_time:f,end_time:f,type_id:"4"}},e="/appointment"),a.type===l.AGENDA_TYPE_REMINDER&&(c={original_time:f},e="/reminder"),r.setData(c),d.path(e)},a.loadUsers=function(){t.listWithoutOwner().then(function(b){a.usersWithoutOwner=b.data})},a.dataLoader=function(b){return a.loadDataForList(b).then(function(b){if(void 0!==b.data.count)return b;var c,d,e,f,g,h=[];for(c=0,d=b.data.length;d>c;c+=1)new Date(b.data[c].datePrimary)instanceof Date&&(b.data[c].datePrimary=i.clearISOTime(i.setDateAsUTC0(new Date(b.data[c].datePrimary).setHours(0,0,0,0)).toISOString()));f=j.objectFromArrayByGroup(b.data,"datePrimary");for(g in f)f.hasOwnProperty(g)&&(e=f[g].rows,h.push({date:g,types:j.sortArrayWithObjectsIntoGroups(e,"type",a.sortDayTypes),dayEvents:e}));return a.initCollapse(h),{data:h}})},a.setFilterRecent=function(){a.dataLoaderParams.datePrimary=i.clearISOTime((new Date).toISOString()),a.dataLoaderParams.sortDirection="desc",a.dataLoaderParams.direction="<=",a.dataLoaderParams.searchStr=Math.random()},a.setFilterOncomming=function(){a.dataLoaderParams.datePrimary=i.clearISOTime((new Date).toISOString()),a.dataLoaderParams.sortDirection="asc",a.dataLoaderParams.direction=">=",a.dataLoaderParams.searchStr=Math.random()},a.setFilterAll=function(){a.dataLoaderParams.datePrimary=i.clearISOTime(new Date(null).toISOString()),a.dataLoaderParams.sortDirection="asc",a.dataLoaderParams.direction=">=",a.dataLoaderParams.searchStr=Math.random()},a.collapseAllFromToday=function(b){var c,d;for(c=0,d=b.length;d>c;c+=1)a.collapseDays[b[c].date]=(new Date(b[c].date)>=new Date((new Date).setHours(0,0,0,0))||a.collapseDays[b[c].date])===!0},a.initCollapse=function(b){var c;a.routeCurrentDate&&(c=i.clearISOTime(a.routeCurrentDate.toISOString()),a.collapseDays[c]=!0),a.collapseAllFromToday(b)},a.newAppointment=function(){r.clear(),r.setData(a.agenda.dataForMenuActions),d.path("/appointment")},a.newTask=function(){r.clear(),r.setData(a.agenda.dataForMenuActions),d.path("/task")},a.pageAncestor=o.getInstance(),a.pageAncestor.init({scope:a}),a.dp=m.getInstance(),a.dp.init(a),a.loadUsers(),a.createWeek(a.startISODate,[])}]),angular.module("crmPostgresWebApp").service("AgendaService",["$http","$filter","Constants","AlertsService","Tools",function(a,b,c,d,e){this.listForWeek=function(b){return a.get("/api/agenda/week/"+new Date(b).toISOString(),{cache:!1}).then(function(a){var b=a.data.message;return b&&b.type===c.MESSAGE_ERROR_MODAL&&d.add({type:b.type,message:b.msg}),a})},this.sendEmail=function(e){return a.post("/api/agenda/email",{person:e}).then(function(a){var e=a.data.message;e&&e.type===c.MESSAGE_SUCCESS&&d.add({type:c.MESSAGE_SUCCESS,message:b("translate")("EMAIL_HAS_SEND")})})}}]),angular.module("crmPostgresWebApp").controller("TaskCtrl",["$scope","$timeout","$location","$translate","$translatePartialLoader","PageAncestor","DatepickerFactory","TasksService","DateService","Constants","TimeZonesService","Tools","SalesPipelineService","MessengerService","initialData",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){e.addPart("task"),d.refresh(),a.task=o.task,a.usersWithoutOwner=o.usersWithoutOwner,a.taskTmp={},a.localDataTags=[],a.task.taskTags=a.task.taskTags||[],a.task.company=a.task.company||[],a.task.person=a.task.person||[],a.task.project=a.task.project||[],a.task.salesPipeline=a.task.salesPipeline||[],a.timeZones=[],a.listReminder=[{prefix:"",name:"NONE",value:0},{prefix:"5",name:"MINUTES",value:300},{prefix:"10",name:"MINUTES",value:600},{prefix:"15",name:"MINUTES",value:900},{prefix:"30",name:"MINUTES",value:1800},{prefix:"1",name:"HOUR",value:3600},{prefix:"1",name:"DAY",value:86400}],a.priority=j.PRIORITY,a.selectedPriority=a.priority[1],a.salesPipelineStages=[],a.tabsRelated=[!0,!1,!1],a.relatedTasksList=[],a.relatedIndex=0,a.relatedPrecedingIndex=1,a.relatedFollowingIndex=2,a.relatedTaskIndex=0;var p,q,r;if(a.task.id){for(a.task.startDate=i.addMilliseconds(new Date(a.task.startDate),60*new Date(a.task.startDate).getTimezoneOffset()*1e3).toISOString(),a.taskTmp.startDate=a.task.startDate,a.taskTmp.startTime=a.task.startDate,a.task.dueDate=i.addMilliseconds(new Date(a.task.dueDate),60*new Date(a.task.dueDate).getTimezoneOffset()*1e3).toISOString(),a.taskTmp.dueDate=a.task.dueDate,a.taskTmp.dueTime=a.task.dueDate,a.task.finishDate&&(a.task.finishDate=i.addMilliseconds(new Date(a.task.finishDate),60*new Date(a.task.finishDate).getTimezoneOffset()*1e3).toISOString(),
a.taskTmp.finishDate=a.task.finishDate,a.taskTmp.finishTime=a.task.finishDate),a.taskTmp.tmpReminderIndex=0,q=0,r=a.listReminder.length;r>q;q+=1)if(a.listReminder[q].value===parseInt(a.task.reminderSeconds,10)){a.taskTmp.tmpReminderIndex=q;break}if(b(function(){a.taskTmp.tmpReminder=a.listReminder[a.taskTmp.tmpReminderIndex].name,a.taskTmp.tmpReminderPrefix=a.listReminder[a.taskTmp.tmpReminderIndex].prefix},500),a.selectedPriority=a.priority[a.task.priority],a.task.ownerId===a.task.assignedToId)a.taskTmp.assignedToTeam=!1;else for(a.taskTmp.assignedToTeam=!0,q=0,r=a.usersWithoutOwner.length;r>q;q+=1)if(a.usersWithoutOwner[q].id===a.task.assignedToId){a.selectedTeamUser=a.usersWithoutOwner[q];break}}else a.task.priority="0",a.taskTmp.tmpReminderIndex=2,p=i.round(new Date,[0,30,60],"mi"),p.setSeconds(0),p.setMilliseconds(0),p=new Date(p).toISOString(),a.task.startDate=p,a.task.dueDate=p,a.taskTmp.startDate=p,a.taskTmp.startTime=p,a.taskTmp.dueDate=p,a.taskTmp.dueTime=p,a.taskTmp.tmpReminderIndex&&(a.task.reminderSeconds=a.listReminder[a.taskTmp.tmpReminderIndex].value,b(function(){a.taskTmp.tmpReminder=a.listReminder[a.taskTmp.tmpReminderIndex].name,a.taskTmp.tmpReminderPrefix=a.listReminder[a.taskTmp.tmpReminderIndex].prefix},500)),a.taskTmp.assignedToTeam=!1;a.newTask=function(){c.path("/task")},a.verifyForm=function(){var b,c,d=!0,e=[];for(e.push({message:"WARNING_FIELD_VALUE_INVALID"}),a.task.subject||(d=!1,e.push({message:"SUBJECT"})),a.task.startDate&&new Date(a.task.startDate)>new Date(1899,0,1)||(d=!1,e.push({message:"START_DATE"})),a.task.dueDate&&new Date(a.task.dueDate)>new Date(1899,0,1)||(d=!1,e.push({message:"DUE_DATE"})),a.task.startDate>a.task.dueDate&&(d=!1,e.push({message:"RANGE_DATE_START_AND_DUE"})),a.task.timezoneName||(d=!1,e.push({message:"TIMEZONE"})),a.taskTmp.assignedToTeam&&(a.selectedTeamUser.id&&l.isNumber(a.selectedTeamUser.id)||(d=!1,e.push({message:"ASSIGNEE_TO_TEAM"}))),a.meta.ownerId||(d=!1,e.push({message:"ASSIGNEE_TO_ME"})),$("#XXX2_value").val()&&!a.task.project[0]&&(d=!1,e.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"PROJECT"})),$("#XXX4_value").val()&&!a.task.taskTags[0]&&(d=!1,e.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"TAGS"})),$("#XXX15_value").val()&&!a.task.company[0]&&(d=!1,e.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"COMPANY"})),$("#XXX16_value").val()&&!a.task.person[0]&&(d=!1,e.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"PERSON"})),$("#XXX17_value").val()&&!a.task.salesPipeline[0]&&(d=!1,e.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"SALES_PIPELINE"})),b=0,c=e.length;c>b;b+=1)b>1&&(e[b].prefix=", ");return d||a.pageAncestor.addAlert({type:j.MESSAGE_WARNING_VALIDATION_BEFORE_CRUD,messages:e}),d},a.post=function(){a.verifyForm()&&(a.task.assignedToId=a.taskTmp.assignedToTeam?a.selectedTeamUser.id:null,a.task.startDate=i.setDateAsUTC0(a.task.startDate),a.task.dueDate=i.setDateAsUTC0(a.task.dueDate),a.task.finishDate=a.task.finishDate?i.setDateAsUTC0(a.task.finishDate):a.task.finishDate,a.pageAncestor.post(function(){return h.post(a.task).then(function(b){if(b.data.id){var d=a.task.pathAfterUpdateExt||"/task/"+b.data.id;c.path(d)}return b})}))},a.put=function(){a.verifyForm()&&(a.task.assignedToId=a.taskTmp.assignedToTeam?a.selectedTeamUser.id:null,a.task.startDate=i.setDateAsUTC0(a.task.startDate),a.task.dueDate=i.setDateAsUTC0(a.task.dueDate),a.task.finishDate=a.task.finishDate?i.setDateAsUTC0(a.task.finishDate):a.task.finishDate,a.pageAncestor.put(function(){return h.put(a.task).then(function(a){return a})}))},a.del=function(){a.pageAncestor.del(function(){return h.del(a.task).then(function(a){return a.data.id?c.path("/task/"+a.data.id):c.path("/tasks"),a})})},a.initButtons=function(){var b={};a.actionButtons=[{name:"DELETE",dropDown:[{name:"DELETE_TASK",onClick:a.del,disabled:function(){return!a.task.id}}],disabled:!a.task.id},{name:"CANCEL",onClick:a.pageAncestor.cancel,disabled:function(){return!a.pageAncestor.log.changes.isChanged}}],b=a.task.id?{name:"SAVE",onClick:a.put,disabled:function(){return!1}}:{name:"SAVE",onClick:a.post,disabled:function(){return!1}},a.actionButtons.push(b)},a.loadTags=function(){h.tags().then(function(b){a.localDataTags=b.data})},a.loadTimeZones=function(){var b,c;k.list().then(function(d){if(a.timeZones=d.data,!a.task.id){for(b=0,c=a.timeZones.length;c>b;b+=1)if(1===a.timeZones[b]["default"])return void(a.task.timezoneName=a.timeZones[b].name);a.timeZones&&(a.task.timezoneName=a.timeZones[0].name)}})},a.setTimeZone=function(b){a.task.timezoneName=a.timeZones[b].name},a.setReminder=function(b){a.task.reminder=0===a.listReminder[b].value?0:1,a.task.reminderSeconds=a.listReminder[b].value,a.taskTmp.tmpReminder=a.listReminder[b].name,a.taskTmp.tmpReminderPrefix=a.listReminder[b].prefix,a.taskTmp.tmpReminderIndex=b},a.setPriority=function(b){a.task.priority=a.priority[b].id,a.selectedPriority=a.priority[b]},a.selectTeamUser=function(b){a.selectedTeamUser=a.usersWithoutOwner[b]},a.getCompanyId=function(){var b=0;return a.task.company&&a.task.company[0]&&l.isNumber(a.task.company[0].id)&&(b=a.task.company[0].id),b},a.setSalesPipelineStage=function(b){a.task.salesPipelineStageId=a.salesPipelineStages[b].id,a.taskTmp.tmpSalesPipelineStage=a.salesPipelineStages[b].name},a.loadSalesPipelineStages=function(){m.listMyStages().then(function(b){for(a.salesPipelineStages=b.data,q=0,r=a.salesPipelineStages.length;r>q;q+=1)if(a.salesPipelineStages[q].id===a.task.salesPipelineStageId){a.taskTmp.tmpSalesPipelineStage=a.salesPipelineStages[q].name;break}})},a.loadRelatedTasks=function(){a.task.id&&h.relatedList(a.task).then(function(b){a.relatedTasksList[a.relatedIndex]=b.data})},a.loadRelatedPrecedingTasks=function(){a.task.id&&h.relatedPrecedingList(a.task).then(function(b){a.relatedTasksList[a.relatedPrecedingIndex]=b.data})},a.loadRelatedFollowingTasks=function(){a.task.id&&h.relatedFollowingList(a.task).then(function(b){a.relatedTasksList[a.relatedFollowingIndex]=b.data})},a.setTabsRelated=function(b){a.tabsRelated=[!1,!1,!1],a.tabsRelated[b]=!0,a.relatedTaskIndex=b},a.recalculateDateTime=function(){var b,c,d,e;b=i.getDateWithMomemtJs(a.taskTmp.startDate,$("#XXX1010").val()),c=i.getDateTimeWithMomemtJs(a.task.startDate,a.taskTmp.startTime,$("#XXX1111").val()),d=i.getDateWithMomemtJs(a.taskTmp.dueDate,$("#XXX88").val()),e=i.getDateTimeWithMomemtJs(a.task.dueDate,a.taskTmp.dueTime,$("#XXX99").val()),a.task.startDate=c?i.setTime(b,c):b,a.task.dueDate=e?i.setTime(d,e):d,a.task.startDate>a.task.dueDate&&(a.task.dueDate=a.task.startDate,a.taskTmp.dueDate=a.task.startDate.toISOString(),a.taskTmp.dueTime=a.task.startDate.toISOString())},a.setFinishTime=function(){a.task.finishDate=i.setTime(a.task.finishDate,a.taskTmp.finishTime)},a.newTask=function(){a.task={},c.path("/task")},a.copyTaskAsNew=function(){n.clear(),a.task.id=null,n.setData(a.task),c.path("/task")},a.$watch("task.company",function(b,c){c!==b&&(a.task.salesPipeline=[],a.task.salesPipelineStageId=null,a.taskTmp.tmpSalesPipelineStage=null,a.taskTmp.tmpSalesPipeline=null)},!0),a.$watch("task.salesPipeline",function(b,c){if(c!==b&&!a.task.salesPipelineStageId){if(0===b.length)return;var d,e,f=[],g=[];for(d=0,e=a.salesPipelineStages.length;e>d;d+=1)g[d]=f[d]=parseInt(a.salesPipelineStages[d].id,10);a.setSalesPipelineStage(g.indexOf(f.sort()[0]))}},!0),a.pageAncestor=f.getInstance(),a.pageAncestor.init({scope:a,formObject:"task",table:"TASKS"}),a.dp=g.getInstance(),a.dp.init(a),a.initButtons(),a.loadTags(),a.loadTimeZones(),a.loadSalesPipelineStages(),a.loadRelatedTasks(),a.loadRelatedPrecedingTasks(),a.loadRelatedFollowingTasks(),b(function(){a.pageAncestor.setDefault()},1e3),$("#btTimeStart").focusout(function(){$("#groupTimepickerStart .timepicker").remove(),a.showTPstart=!1,a.$apply()}),$("#btTimeDue").focusout(function(){$("#groupTimepickerDue .timepicker").remove(),a.showTPdue=!1,a.$apply()}),$("#btTimeFinish").focusout(function(){$("#groupTimepickerFinish .timepicker").remove(),a.showTPfinish=!1,a.$apply()})}]),angular.module("crmPostgresWebApp").controller("SalesPlanCtrl",["$scope","$q","$filter","$translate","$translatePartialLoader","SalesPlanService","usSpinnerService","initialData",function(a,b,c,d,e,f,g,h){e.addPart("sales_plan"),d.refresh(),a.sum={},a.intervalTypes=[{id:1,name:c("translate")("MONTHLY")},{id:2,name:c("translate")("QUARTERLY")},{id:3,name:c("translate")("YEARLY")}],a.selectedIntervalType=a.intervalTypes[0],a.items={},a.years=h.years||[],a.year={},a.months=h.months||[],a.month={},a.quarter=h.quarter||[],a.monthsIndex=0,a.yearIndex=0,a.disabledPrior=!1,a.disabledNext=!1,a.disableInterval=!1,a.disableMonth=!1,a.disableYear=!1,a.current={},a.range="",a.salesItemsshowDetail=!1,a.sortFields=[{name:"REVENUE",sortField:"revenueSum"},{name:"NAME2",sortField:"name"}],a.salesItemsSortField=a.sortFields[1],a.groupFields=[{name:"PRODUCT",fce:f.listProductGroup},{name:"COMPANY",fce:f.listCompanyGroup}],a.salesItemsGroupField=a.groupFields[1],a.loadData=function(){if(!a.year||!a.month)return null;var c,d,e,h,i;return a.notLoaded()?(a.clearCurrent(),g.spin("spinner-load-data"),c=f.sumForCompany(a.createFilterObject()),d=f.sumForPersonal(a.createFilterObject()),e=f.sumForDomain(a.createFilterObject()),i=a.createFilterObject(),i.sortField=a.salesItemsSortField.sortField,h=f.listCompanyGroup(i),a.disableFilter(),b.all([c,d,e,h]).then(function(b){a.setResults(b),a.enableFilter(),a.setNavbar(),g.stop("spinner-load-data"),a.setRange(),a.setCurrent()})):(a.setRange(),a.setCurrent(),null)},a.setInterval=function(b){a.selectedIntervalType=a.intervalTypes[b],a.monthsIndex=0,a.yearIndex=0,a.initMonths(),a.setYear(a.yearIndex),a.setMonths(a.monthsIndex),a.setNavbar()},a.setTabsForItems=function(b){a.selectedTab=b},a.prevRange=function(){if(3===a.selectedIntervalType.id)return a.yearIndex+=1,a.setYear(a.yearIndex),void a.setNavbar();var b=c("filter")(a.months,{year:a.year.year});a.monthsIndex===b.length-1?(a.monthsIndex=0,a.yearIndex+=1,a.setYear(a.yearIndex)):a.monthsIndex+=1,a.setMonths(a.monthsIndex),a.setNavbar()},a.nextRange=function(){if(3===a.selectedIntervalType.id)return a.yearIndex-=1,a.setYear(a.yearIndex),void a.setNavbar();var b=c("filter")(a.months,{year:a.year.year});0===a.monthsIndex?(a.yearIndex-=1,a.setYear(a.yearIndex),b=c("filter")(a.months,{year:a.year.year}),a.monthsIndex=b.length-1):a.monthsIndex-=1,a.setMonths(a.monthsIndex),a.setNavbar()},a.setYear=function(b){a.year=a.years[b],a.monthsIndex=0,a.yearIndex=b,a.setMonths(a.monthsIndex)},a.setMonths=function(b){a.year&&(a.month=c("filter")(a.months,{year:a.year.year})[b],a.monthsIndex=b,a.setNavbar())},a.setNavbar=function(){a.disabledNext=!(0!==a.monthsIndex||0!==a.yearIndex),a.disabledPrior=!(a.monthsIndex!==c("filter")(a.months,{year:a.year.year}).length-1||a.yearIndex!==a.years.length-1)},a.disableFilter=function(){a.disabledPrior=!0,a.disabledNext=!0,a.disableInterval=!0,a.disableMonth=!0,a.disableYear=!0,a.disableShow=!0},a.enableFilter=function(){a.disabledPrior=!1,a.disabledNext=!1,a.disableInterval=!1,a.disableMonth=!1,a.disableYear=!1,a.disableShow=!1},a.clearCurrent=function(){a.current={company:{},team:{},domain:{},products:[]}},a.setRange=function(){a.range=3===a.selectedIntervalType.id?a.year.year:a.month.name+"/"+a.year.year},a.setCurrent=function(){a.current=3===a.selectedIntervalType.id?a.sum[a.year.name]:a.sum[a.year.year][a.month.name]},a.notLoaded=function(){return 3===a.selectedIntervalType.id?!a.sum[a.year.name]:!(a.sum[a.year.year]&&a.sum[a.year.year][a.month.name])},a.setResults=function(b){3===a.selectedIntervalType.id?(a.sum[a.year.name]=a.sum[a.year.name]||{},a.sum[a.year.name].company=b[0].data,a.sum[a.year.name].team=b[1].data,a.sum[a.year.name].domain=b[2].data,a.sum[a.year.name].products=b[3].data):(a.sum[a.year.year]=a.sum[a.year.year]||{},a.sum[a.year.year][a.month.name]={},a.sum[a.year.year][a.month.name].company=b[0].data,a.sum[a.year.year][a.month.name].team=b[1].data,a.sum[a.year.year][a.month.name].domain=b[2].data,a.sum[a.year.year][a.month.name].products=b[3].data)},a.createFilterObject=function(){var b;return b=3===a.selectedIntervalType.id?{year:a.year.year,from:1,to:12}:{year:a.year.year,from:a.month.from,to:a.month.to}},a.initMonths=function(){1===a.selectedIntervalType.id&&(a.months=h.months||[]),2===a.selectedIntervalType.id&&(a.months=h.quarter||[])},a.setSort=function(b){a.salesItemsSortField=a.sortFields[b],a.loadProducts(a.salesItemsGroupField.fce)},a.setGroup=function(b){a.salesItemsGroupField=a.groupFields[b],a.loadProducts(a.salesItemsGroupField.fce)},a.loadProducts=function(b){var c;c=a.createFilterObject(),c.sortField=a.salesItemsSortField.sortField,g.spin("spinner-load-data-sales-items"),b(c).then(function(b){g.stop("spinner-load-data-sales-items"),3===a.selectedIntervalType.id?a.sum[a.year.name].products=b.data:a.sum[a.year.year][a.month.name].products=b.data})},a.init=function(){return a.setYear(a.yearIndex),a.year&&"{}"!==JSON.stringify(a.year)?(a.setMonths(a.monthsIndex),a.loadData(),a.setNavbar(),void a.setTabsForItems(0)):void a.disableFilter()},a.init()}]),angular.module("crmPostgresWebApp").filter("filterOwner",function(){return function(a,b){var c,d,e,f,g=[];if(!b||!b.list||!a)return[];for(e=0,f=a.length;f>e;e+=1)for(c=0,d=b.list.length;d>c;c+=1)if(parseInt(b.list[c].id,10)===parseInt(a[e].ownerId,10)){g.push(a[e]);break}return g}}),angular.module("crmPostgresWebApp").service("TasksService",["$http","Tools",function(a,b){this.markAsDone=function(b){return a.post("/api/tasks/"+b+"/mark-as-done",{id:b}).error(function(a){console.log(a)})},this.get=function(b){return a.get("/api/tasks/"+b,{cache:!1}).error(function(a){console.log(a)})},this.del=function(b){return a["delete"]("/api/tasks/"+b.id,{cache:!1}).error(function(a){console.log(a)})},this.post=function(b){return a.post("/api/tasks",b).error(function(a){console.log(a)})},this.put=function(b){return a.put("/api/tasks/"+b.id,b).error(function(a){console.log(a)})},this.tags=function(){return a.get("/api/tasks/tags/all",{cache:!1}).error(function(a){console.log(a)})},this.relatedList=function(b){return a.get("/api/tasks/"+b.id+"/related/all/",{cache:!1}).error(function(a){console.log(a)})},this.relatedPrecedingList=function(b){return a.get("/api/tasks/"+b.id+"/related/preceding",{cache:!1}).error(function(a){console.log(a)})},this.relatedFollowingList=function(b){return a.get("/api/tasks/"+b.id+"/related/following",{cache:!1}).error(function(a){console.log(a)})},this.list=function(c){return a.get("/api/tasks?"+b.objectToQueryString(c),{cache:!1}).error(function(a){console.log(a)})},this.userCount=function(){return a.get("/api/tasks/user/count",{cache:!1}).error(function(a){console.log(a)})},this.userListOld=function(b){return a.get("/api/tasks/user/list/old/"+b.limit,{cache:!1}).error(function(a){console.log(a)})},this.userListToday=function(b){return a.get("/api/tasks/user/list/today/"+b.limit,{cache:!1}).error(function(a){console.log(a)})},this.userListTomorrow=function(b){return a.get("/api/tasks/user/list/tomorrow/"+b.limit,{cache:!1}).error(function(a){console.log(a)})},this.userListNew=function(b){return a.get("/api/tasks/user/list/new/"+b.limit,{cache:!1}).error(function(a){console.log(a)})},this.listForAppointment=function(c){return a.get("/api/tasks/appointment/"+(c.id||"0")+"?"+b.objectToQueryString(c),{cache:!1}).error(function(a){console.log(a)})}}]),angular.module("crmPostgresWebApp").controller("AppointmentsCtrl",["$scope","$location","$translate","$translatePartialLoader","AppointmentService","DateService","initialData","MessengerService","Constants",function(a,b,c,d,e,f,g,h,i){d.addPart("appointments"),c.refresh();var j=h.getData();a.appointments=[],a.searchStr="",a.dataLoaderParams={filter:{},sortField:"start_time",sortDirection:"asc"},a.dataLoaderParams.filter.type=j&&j.people&&j.people.filter?j.people.filter.type:-1,a.infoPaging={},a.getTimeFromDateObject=f.getTimeFromDateObject,a.types=[i.APPOINTMENTS.FILTER.FUTURE,i.APPOINTMENTS.FILTER.PAST],a.typesList=[{ID:-1,NAME:"ALL"}],a.typesList=a.typesList.concat(a.types),a.setSearch=function(b){13===b.which&&(a.dataLoaderParams.searchStr=a.searchStr)},a.newAppointment=function(){b.path("/appointment")},a.getType=function(){return a.typesList.filter(function(b){return b.ID===a.dataLoaderParams.filter.type})[0]},a.appointments=g.appointments,a.dataLoader=e.list}]),angular.module("crmPostgresWebApp").service("SalesPlanService",["$http","Tools",function(a,b){this.sumForCompany=function(c){return a.get("/api/sales-plan/my-company?"+b.objectToQueryString(c),{cache:!1}).error(function(a){console.log(a)})},this.sumForDomain=function(c){return a.get("/api/sales-plan/domain?"+b.objectToQueryString(c),{cache:!1}).error(function(a){console.log(a)})},this.sumForPersonal=function(c){return a.get("/api/sales-plan/personal?"+b.objectToQueryString(c),{cache:!1}).error(function(a){console.log(a)})},this.yearsForFilter=function(){return a.get("/api/sales-plan/filter/years",{cache:!1}).error(function(a){console.log(a)})},this.monthsForFilter=function(){return a.get("/api/sales-plan/filter/months",{cache:!1}).error(function(a){console.log(a)})},this.quarterForFilter=function(){return a.get("/api/sales-plan/filter/quarter",{cache:!1}).error(function(a){console.log(a)})},this.monthsArrayForFilter=function(a){var b,c,d=[];for(b=0,c=a.length;c>b;b+=1)d.push({id:b,name:a[b].name,month:a[b].month,year:a[b].year,from:a[b].from,to:a[b].to});return d},this.yearsArrayForFilter=function(a){var b,c,d=[];for(b=0,c=a.length;c>b;b+=1)d.push({id:b,name:"fullName"+a[b].year,year:a[b].year});return d},this.listCompanyGroup=function(c){return a.get("/api/sales-plan/products/group/company?"+b.objectToQueryString(c),{cache:!1}).error(function(a){console.log(a)})},this.listProductGroup=function(c){return a.get("/api/sales-plan/products/group/product?"+b.objectToQueryString(c),{cache:!1}).error(function(a){console.log(a)})}}]),angular.module("crmPostgresWebApp").controller("OurCompanyCtrl",["$scope","$translate","$translatePartialLoader",function(a,b,c){c.addPart("ourCompany"),b.refresh(),a.defaultFunction=function(a,b){}}]),angular.module("crmPostgresWebApp").service("PeopleCompaniesService",["$http",function(a){this.revokePeople=function(b){return a["delete"]("/api/people-companies/company/"+b.companyId+"/people/"+b.people.join(","),{cache:!1})}}]),angular.module("crmPostgresWebApp").directive("formatCurrency",["$filter","$parse",function(a,b){return{require:"ngModel",link:function(b,c,d,e){e.$parsers.push(function(a){var b=parseFloat(a);return isNaN(b)?void 0:b}),e.$formatters.push(function(b){return a("currency")(b)}),c.bind("focus",function(){c.val(e.$modelValue)}),c.bind("blur",function(){var b=a("currency")(e.$modelValue);c.val(b)})}}}]),angular.module("crmPostgresWebApp").directive("formatNumber",["$filter","$parse",function(a,b){return{require:"ngModel",link:function(c,d,e,f){var g=b(e.decimals)(c);f.$parsers.push(function(a){var b=parseFloat(a.replace(/,/g,"."));return isNaN(b)?void 0:b}),f.$formatters.push(function(b){return a("number")(b,g)}),d.bind("focus",function(){d.val(f.$modelValue)}),d.bind("blur",function(){var b=a("number")(f.$modelValue,g);d.val(b)})}}}]),angular.module("crmPostgresWebApp").controller("ProductsCtrl",["$scope","$location","$translate","$translatePartialLoader","ProductsService","initialData",function(a,b,c,d,e,f){d.addPart("products"),c.refresh(),a.products=f.products||[],a.searchStr="",a.dataLoaderParams={sortField:"name",sortDirection:"asc"},a.infoPaging={},a.setSearch=function(b){13===b.which&&(a.dataLoaderParams.searchStr=a.searchStr)},a.newProduct=function(){b.path("/product")},a.dataLoader=e.list}]),angular.module("crmPostgresWebApp").controller("ProductCtrl",["$scope","$location","$translate","$translatePartialLoader","PageAncestor","ProductsService","Constants","MessengerService","initialData","FilesService","AttachmentsService",function(a,b,c,d,e,f,g,h,i,j,k){d.addPart("product"),c.refresh(),a.product=i.product,a.localDataCurrency=i.currency,a.localDataUnits=i.units,a.pictureFile={},a.isPictureChange=!1,a.inProcess=!1,a.uploadPictureConfig={},a.initButtons=function(){var b={};a.actionButtons=[{name:"DELETE",dropDown:[{name:"DELETE_PRODUCT",onClick:a.del,disabled:function(){return!a.product.id}}],disabled:!a.product.id},{name:"CANCEL",onClick:a.pageAncestor.cancel,disabled:function(){return!a.pageAncestor.log.changes.isChanged}}],b=a.product.id?{name:"SAVE",onClick:a.put,disabled:function(){return a.inProcess}}:{name:"SAVE",onClick:a.post,disabled:function(){return a.inProcess}},a.actionButtons.push(b)},a.newProduct=function(){b.path("/product")},a.verifyForm=function(){var b,c,d=!0,e=[];for(e.push({message:"WARNING_FIELD_VALUE_INVALID"}),a.product.code||(d=!1,e.push({message:"ARTICLE_NUMBER"})),b=0,c=e.length;c>b;b+=1)b>1&&(e[b].prefix=", ");return d||a.pageAncestor.addAlert({type:g.MESSAGE_WARNING_VALIDATION_BEFORE_CRUD,messages:e}),d},a.post=function(){a.verifyForm()&&a.pageAncestor.post(function(){return f.post(a.product).then(function(a){return a.data.id&&b.path("/product/"+a.data.id),a})})},a.put=function(){a.verifyForm()&&a.pageAncestor.put(function(){return f.put(a.product).then(function(a){return a})})},a.del=function(){a.pageAncestor.del(function(){return f.del(a.product).then(function(a){return a.data.id?b.path("/product/"+a.data.id):b.path("/products"),a})})},a.copyProduct=function(){h.clear(),a.product.id=null,a.product.code=null,h.setData(a.product),b.path("/product")},a.setCurrency=function(b,c){-1===c?""===a.product["price"+b]&&(a.product["currency"+b]=null):a.product["currency"+b]=a.localDataCurrency[c].name},a.setUnit=function(b){a.product.unit=a.localDataUnits[b].name},a.uploadPicture=function(){j.uploadFile(a.pictureFile,a.uploadPictureConfig)},a.selectFile=function(b){a.pictureFile=b,a.isPictureChange=!0},a.removePicture=function(){a.isPictureChange=a.product.pictureId?!0:!1,a.pictureFile={}},a.showSavePictureAnchor=function(){return a.isPictureChange&&(a.pictureFile&&a.pictureFile.name?!0:!1)&&!a.inProcess},a.showDeletePictureAnchor=function(){return a.isPictureChange&&!(a.pictureFile&&a.pictureFile.name)&&!a.inProcess},a.showRemovePictureAnchor=function(){return a.product.pictureId&&!a.isPictureChange||(a.pictureFile&&a.pictureFile.name?!0:!1)},a.getProductPicture=function(){var b=null;return b=Object.keys(a.pictureFile||{}).length>0?"pictureFile":a.product.pictureId&&!a.isPictureChange?"/api/attachments/"+a.product.pictureId:g.EMPTY_PRODUCT_PICTURE},a.afterUploadProductPicture=function(b){a.isPictureChange=!1,a.product.pictureId=b.data.id,a.uploadPictureConfig.data.id=b.data.id,a.inProcess=!1},a.initPictureConfig=function(){a.uploadPictureConfig={url:"/api/product/"+a.product.id+"/picture/upload",errorMsg:"",callback:a.afterUploadProductPicture,data:{table:g.ATTACHMENTS_TYPES.PRODUCT,id:a.product.pictureId}}},a.deletePicture=function(){var b={id:a.product.pictureId};k.del(b).then(function(){a.product.pictureId=null,a.isPictureChange=!1,a.inProcess=!1})},a.pageAncestor=e.getInstance(),a.pageAncestor.init({scope:a,formObject:"product",table:"PRODUCTS"}),a.initButtons(),a.initPictureConfig()}]),angular.module("crmPostgresWebApp").controller("ProjectCtrl",["$scope","$location","$translatePartialLoader","$translate","PageAncestor","ProjectsService","Constants","DatepickerFactory","MessengerService","initialData",function(a,b,c,d,e,f,g,h,i,j){c.addPart("project"),d.refresh(),a.project=j.project,a.project.company=a.project.company||[],a.projectTmp={},a.pageAncestor={},a.tabs=[!1,!1],a.loadDataForAgendaList=f.listForAgenda,a.history=[],a.project.ownerName=a.project.ownerName||a.meta.ownerName,a.dataForAgenda={},a.initButtons=function(){var b={};a.actionButtons=[{name:"DELETE",dropDown:[{name:"DELETE_PROJECT",onClick:a.del,disabled:function(){return!a.project.id}}],disabled:!a.project.id},{name:"CANCEL",onClick:a.pageAncestor.cancel,disabled:function(){return!a.pageAncestor.log.changes.isChanged}}],b=a.project.id?{name:"SAVE",onClick:a.put,disabled:function(){return a.inProcess}}:{name:"SAVE",onClick:a.post,disabled:function(){return a.inProcess}},a.actionButtons.push(b)},a.newProject=function(){b.path("/project")},a.verifyForm=function(){var b,c,d=!0,e=[];for(e.push({message:"WARNING_FIELD_VALUE_INVALID"}),a.project.subject||(d=!1,e.push({message:"SUBJECT"})),$("#XXX4_value").val()&&!a.project.company[0]&&(d=!1,e.push({message:"ANGUCOMPLETE_NOT_SELECTED",sufix:"COMPANY"})),!a.project.startDate||new Date(a.project.startDate)>new Date(1899,0,1)||(d=!1,e.push({message:"START"})),!a.project.endDate||new Date(a.project.endDate)>new Date(1899,0,1)||(d=!1,e.push({message:"FINISH"})),b=0,c=e.length;c>b;b+=1)b>1&&(e[b].prefix=", ");return d||a.pageAncestor.addAlert({type:g.MESSAGE_WARNING_VALIDATION_BEFORE_CRUD,messages:e}),d},a.post=function(){a.verifyForm()&&a.pageAncestor.post(function(){return f.post(a.project).then(function(a){return a.data.id&&b.path("/project/"+a.data.id),a})})},a.put=function(){a.verifyForm()&&a.pageAncestor.put(function(){return f.put(a.project).then(function(a){return a})})},a.del=function(){a.pageAncestor.del(function(){return f.del(a.project).then(function(a){return a.data.id?b.path("/project/"+a.data.id):b.path("/projects"),a})})},a.setTabs=function(b){a.tabs=a.tabs.map(function(c,d){return d===b&&a.project.id})},a.loadHistory=function(){f.history(a.project).then(function(b){a.history=b.data})},a.startProject=function(){a.project.startDate=(new Date).toISOString()},a.startProjectCancel=function(){a.project.startDate=""},a.endProject=function(){a.project.endDate=(new Date).toISOString()},a.endProjectCancel=function(){a.project.endDate=""},a.copyProject=function(){i.clear(),a.project.id=null,a.project.ownerName=null,a.project.startDate=null,a.project.endDate=null,i.setData(a.project),b.path("/project")},a.initDataForAgenda=function(){a.dataForAgenda.appointment={},a.dataForAgenda.appointment.projects=[{id:a.project.id,name:a.project.subject}],a.dataForAgenda.task={},a.dataForAgenda.task.project=[{id:a.project.id,name:a.project.subject}]},a.pageAncestor=e.getInstance(),a.pageAncestor.init({scope:a,formObject:"project",table:"PROJECTS"}),a.dp=h.getInstance(),a.dp.init(a),a.initButtons(),a.setTabs(0),a.loadHistory(),a.initDataForAgenda()}]),angular.module("crmPostgresWebApp").controller("ProjectsCtrl",["$scope","$location","$translate","$translatePartialLoader","ProjectsService","initialData",function(a,b,c,d,e,f){d.addPart("projects"),c.refresh(),a.projects=f.projects||[],a.searchStr="",a.dataLoaderParams={sortField:"subject",sortDirection:"asc"},a.infoPaging={},a.setSearch=function(b){13===b.which&&(a.dataLoaderParams.searchStr=a.searchStr)},a.newProject=function(){b.path("/project")},a.dataLoader=e.list}]),angular.module("crmPostgresWebApp").service("ProductsService",["$http","Tools",function(a,b){return{list:function(c){return a.get("/api/products?"+b.objectToQueryString(c)).error(function(a){console.log(a)})},get:function(b){return a.get("/api/product/"+b,{cache:!1}).error(function(a){console.log(a)})},post:function(b){return a.post("/api/product",b).error(function(a){console.log(a)})},put:function(b){return a.put("/api/product/"+b.id,b).error(function(a){console.log(a)})},del:function(b){return a["delete"]("/api/product/"+b.id,{cache:!1}).error(function(a){console.log(a)})}}}]),angular.module("crmPostgresWebApp").service("ProjectsService",["$http","Tools","Constants","AlertsService",function(a,b,c,d){return{list:function(c){return a.get("/api/projects?"+b.objectToQueryString(c)).error(function(a){console.log(a)})},get:function(b){return a.get("/api/project/"+b,{cache:!1}).error(function(a){console.log(a)})},post:function(b){return a.post("/api/project",b).error(function(a){console.log(a)})},put:function(b){return a.put("/api/project/"+b.id,b).error(function(a){console.log(a)})},del:function(b){return a["delete"]("/api/project/"+b.id,{cache:!1}).error(function(a){console.log(a)})},listForAgenda:function(e){return a.get("/api/agenda/list/project/"+e.id+"?"+b.objectToQueryString(e),{cache:!1}).then(function(a){var b=a.data.message;return b&&b.type===c.MESSAGE_ERROR_MODAL&&d.add({type:b.type,message:b.msg}),a})},history:function(b){return a.get("/api/project/"+b.id+"/history",{cache:!1}).error(function(a){console.log(a)})},searchGlobal:function(b){return a.get("/api/projects/search-all/"+b.str).error(function(a){console.log(a)})}}}]),angular.module("crmPostgresWebApp").service("CurrencyService",["$http",function(a){return{list:function(){return a.get("/api/currency").error(function(a){console.log(a)})}}}]),angular.module("crmPostgresWebApp").controller("SearchCtrl",["$scope","$route","$translate","$translatePartialLoader","CompaniesService","PeopleService","ProjectsService","OpportunitiesService",function(a,b,c,d,e,f,g,h){d.addPart("search"),c.refresh(),a.searchCode=b.current?b.current.params.code:"",a.companies=[],a.people=[],a.team=[],a.opportunities=[],a.projects=[],a.search=function(){a.searchCompanies(),a.searchPeople(),a.searchTeam(),a.searchOpportunites(),a.searchProjects()},a.searchCompanies=function(){e.searchGlobal({str:a.searchCode}).then(function(b){a.companies=b.data||[]})},a.searchPeople=function(){f.searchGlobal({str:a.searchCode}).then(function(b){a.people=b.data||[]})},a.searchTeam=function(){f.searchGlobalTeam({str:a.searchCode}).then(function(b){a.team=b.data||[]})},a.searchOpportunites=function(){h.searchGlobal({str:a.searchCode}).then(function(b){a.opportunities=b.data||[]})},a.searchProjects=function(){g.searchGlobal({str:a.searchCode}).then(function(b){a.projects=b.data||[]})},a.search()}]),angular.module("crmPostgresWebApp").directive("textareaCalc",["AlertsService","Constants",function(a,b){return{templateUrl:"views/directives/d_textarea_calc.html",restrict:"E",replace:!0,scope:{textareaId:"@",textareaName:"@",textareaClass:"@",textareaPlaceholder:"@",textareaTabindex:"@",model:"=",textareaMaxlength:"@"},link:function(c,d,e){c.$watch("model",function(d,e){e!==d&&c.model&&c.model.length>parseInt(c.textareaMaxlength,10)&&a.add({type:b.MESSAGE_WARNING_VALIDATION_BEFORE_CRUD,messages:[{message:b.MESSAGE_TEXTAREA_OVERFLOW}]})})}}}]),angular.module("crmPostgresWebApp").controller("OpportunitiesCtrl",["$scope","$location","$translate","$translatePartialLoader","OpportunitiesService","MessengerService","Constants","SalesPipelineStagesService","initialData",function(a,b,c,d,e,f,g,h,i){d.addPart("opportunities"),c.refresh();var j=f.getData();a.opportunities=i.opportunities||[],a.searchStr="",a.dataLoaderParams={filter:{},sortField:"subject",sortDirection:"asc"},a.dataLoaderParams.filter.type=j&&j.opportunities&&j.opportunities.filter?j.opportunities.filter.type:-1,a.infoPaging={},a.types=[g.OPPORTUNITIES.FILTER.OPEN,g.OPPORTUNITIES.FILTER.SUCCESS,g.OPPORTUNITIES.FILTER.FAILURE],a.typesList=[{ID:-1,NAME:"ALL",FILTER:"TYPE"}],a.typesList=a.typesList.concat(a.types),a.owners=[],a.filters=[],a.setSearch=function(b){13===b.which&&(a.dataLoaderParams.searchStr=a.searchStr)},a.newOpportunity=function(){b.path("/opportunity")},a.viewSalesPipeline=function(){b.path("/sales-pipeline")},a.getType=function(){return a.typesList.filter(function(b){return b.ID===a.dataLoaderParams.filter.type})[0]},a.init=function(){a.loadOwnersForStages()},a.loadOwnersForStages=function(){h.owners().then(function(b){var c={};a.owners=[];var d,e;for(d=0,e=b.data.length;e>d;d+=1)c={},c.ID=b.data[d].owner_id,c.NAME=b.data[d].peoplename||b.data[d].last_name,c.FILTER="OWNER",a.owners.push(c);a.filters=a.typesList,a.filters=a.filters.concat(a.owners)})},a.setFilter=function(b){a.dataLoaderParams.filter.type="TYPE"===b.FILTER?b.ID:-1,a.dataLoaderParams.filter.owner="OWNER"===b.FILTER?b.ID:-1},a.dataLoader=e.list}]),angular.module("crmPostgresWebApp").service("UnitsService",["$http",function(a){return{list:function(){return a.get("/api/units").error(function(a){console.log(a)})}}}]),angular.module("crmPostgresWebApp").service("OpportunitiesService",["$http","Tools","Constants","AlertsService",function(a,b,c,d){
this.list=function(c){return a.get("/api/opportunities?"+b.objectToQueryString(c)).error(function(a){console.log(a)})},this.get=function(b){return a.get("/api/opportunities/"+b.id).error(function(a){console.log(a)})},this.put=function(b){return a.put("/api/opportunities/"+b.id,b).error(function(a){console.log(a)})},this.post=function(b){return a.post("/api/opportunities",b).error(function(a){console.log(a)})},this.del=function(b){return a["delete"]("/api/opportunities/"+b.id).error(function(a){console.log(a)})},this.listItems=function(c,d){return a.get("/api/opportunities/"+c.id+"/items?"+b.objectToQueryString(d)).error(function(a){console.log(a)})},this.postItem=function(b){return a.post("/api/opportunities/"+b.id+"/item",b).error(function(a){console.log(a)})},this.putItem=function(b){return a.put("/api/opportunities/"+b.id+"/item/"+b.item.number,b).error(function(a){console.log(a)})},this.delItem=function(b){return a["delete"]("/api/opportunities/"+b.id+"/item/"+b.number).error(function(a){console.log(a)})},this.tags=function(){return a.get("/api/opportunity/tags",{cache:!1}).error(function(a){console.log(a)})},this.history=function(b){return a.get("/api/opportunities/"+b.id+"/history",{cache:!1}).error(function(a){console.log(a)})},this.listForAgenda=function(e){return a.get("/api/agenda/list/opportunity/"+e.id+"?"+b.objectToQueryString(e),{cache:!1}).then(function(a){var b=a.data.message;return b&&b.type===c.MESSAGE_ERROR_MODAL&&d.add({type:b.type,message:b.msg}),a})},this.searchGlobal=function(b){return a.get("/api/opportunity/search-all/"+b.str).error(function(a){console.log(a)})},this.setSuccess=function(b){return a.put("/api/opportunities/"+b.id+"/success",b).error(function(a){console.log(a)})},this.setFailed=function(b){return a.put("/api/opportunities/"+b.id+"/failed",b).error(function(a){console.log(a)})},this.setOpen=function(b){return a.put("/api/opportunities/"+b.id+"/open",b).error(function(a){console.log(a)})}}]),angular.module("crmPostgresWebApp").controller("ChangelogCtrl",["$scope","$translate","$translatePartialLoader",function(a,b,c){c.addPart("changelog"),b.refresh(),a.defaultFunction=function(a,b){}}]),angular.module("crmPostgresWebApp").controller("ChangelogsCtrl",["$scope","$location","$translate","$translatePartialLoader","ChangelogsService","Constants","initialData",function(a,b,c,d,e,f,g){d.addPart("changelogs"),c.refresh(),a.searchStr="",a.dataLoaderParams={sortField:"table_name",sortDirection:"asc"},a.infoPaging={},a.showDetail=function(a){a.pk&&a.table_name&&f.ROUTES[a.table_name]&&b.path(f.ROUTES[a.table_name]+a.pk)},a.changelogs=g.changelogs||[],a.dataLoader=e.list}]),angular.module("crmPostgresWebApp").service("ChangelogsService",["$http","Tools",function(a,b){this.list=function(c){return a.get("/api/changelogs?"+b.objectToQueryString(c)).error(function(a){console.log(a)})}}]),angular.module("crmPostgresWebApp").service("FilesService",["$timeout","Upload",function(a,b){this.uploadFile=function(c,d){var e;d.inProcess=!0,c&&!c.$error&&(e={url:d.url,data:d.data,method:"POST",headers:{"my-header":"my-header-value"},fields:{username:d.username},file:c,fileFormDataName:"file"},c.upload=b.upload(e),c.upload.then(function(b){a(function(){c.result=b.data,d.callback(b)})},function(a){d.callbackError(a),a.status>0&&(d.errorMsg=a.status+": "+a.data)}),c.upload.progress(function(a){c.progress=Math.min(100,parseInt(100*a.loaded/a.total,10))}))}}]),angular.module("crmPostgresWebApp").controller("CompaniesImportCtrl",["$scope","$translate","$translatePartialLoader","FilesService","SocketFactory","Constants","ImportCSVService",function(a,b,c,d,e,f,g){c.addPart("companies_import"),b.refresh(),a.toggleStages=[!1,!1],a.list=[],a.dataLoader=g.listImportCsvV1,a.dataLoaderSummary=g.listImportCsvV1,a.dataLoaderParams={filter:{},sortField:"company_name",sortDirection:"asc",hash:null},a.infoPaging={},a.importFile={},a.inProcess=!1,a.uploadFileSuccess=!1,a.importFileSuccess=!1,a.errorInUploadProcess=!1,a.errorInImportProcess=!1,a.isFileChange=!1,a.uploadFileConfig={url:"/api/import/csv/v1/companies-import-csv-v1",errorMsg:"",callback:function(b){a.uploadFileSuccess=!0,a.errorInImportProcess=!b.data.startImportSuccess},callbackError:function(){a.errorInUploadProcess=!0}},a.info={count:0,step:0,process:0},a.IMPORT_CSV_FILE_SIZE_LIMIT=f.IMPORT_CSV_FILE_SIZE_LIMIT,a.uploadFile=function(){!a.inProcess&&a.importFile.name&&(a.clearProgressBars(),d.uploadFile(a.importFile,a.uploadFileConfig),a.inProcess=!0)},a.cancelUploadFile=function(){a.importFile.upload.abort(),e.emit("send:message",{cancelImport:!0},function(){a.inProcess=!1}),a.info.process||(a.inProcess=!1)},a.selectFile=function(b){a.importFile=b,a.isFileChange=!0},a.refreshLocalProgressBar=function(){0===Object.keys(a.importFile).length&&(a.importFile={progress:100})},a.clearProgressBars=function(){a.uploadFileSuccess=!1,a.importFileSuccess=!1,a.importFile.progress=0,a.info={count:0,step:0,process:0}},e.on("send:message",function(b){b.type===f.MESSAGE_INFO_IMPORT_CSV&&(a.info=b,a.inProcess=!b.isCancel&&!b.success&&!b.failed,a.errorInImportProcess=b.failed,a.importFileSuccess=b.success,a.dataLoaderParams.hash=b.success?Math.random():null,a.refreshLocalProgressBar())})}]),angular.module("crmPostgresWebApp").service("ImportCSVService",["$http","$q","Tools","AlertsService","Constants",function(a,b,c,d,e){return{listImportCsvV1:function(b){return a.get("/api/import/csv/v1/companies-import-csv-v1?"+c.objectToQueryString(b)).error(function(a){console.log(a)})}}}]),angular.module("crmPostgresWebApp").controller("DashboardCtrl",["$scope","$translate","$translatePartialLoader",function(a,b,c){c.addPart("dashboard"),b.refresh(),a.defaultFunction=function(a,b){}}]),angular.module("crmPostgresWebApp").controller("SalesCtrl",["$scope","$translate","$translatePartialLoader",function(a,b,c){c.addPart("sales"),b.refresh(),a.defaultFunction=function(a,b){}}]),angular.module("crmPostgresWebApp").controller("PipelineSetupCtrl",["$scope","$translate","$translatePartialLoader","SalesPipelineStagesService","PageAncestor","Constants","initialData",function(a,b,c,d,e,f,g){c.addPart("pipeline_setup"),b.refresh(),a.config={},a.config.stages=g.stages||[],a.config.newStage={id:null,name:"",chance:null},a.pipelines={},a.pipelines.activeStageIndex=null,a.pipelines.actionButtons=[],a.pipelines.selectedStageForMove={},a.initButtons=function(){var b,c={};a.pipelines.actionButtons=[{name:"DELETE",onClick:a.del,disabled:function(){return-1===a.pipelines.activeStageIndex}},{name:"CANCEL",onClick:a.pageAncestor.cancel,disabled:function(){return!a.pageAncestor.log.changes.isChanged}}],b=function(){a.pipelines.activeStageIndex>-1?a.put():a.post()},c={name:"SAVE",onClick:b,disabled:function(){return a.inProcess}},a.pipelines.actionButtons.push(c)},a.verifyForm=function(){var b,c,d=!0,e=[];for(e.push({message:"WARNING_FIELD_VALUE_INVALID"}),a.config.newStage.name||-1!==a.pipelines.activeStageIndex||(d=!1,e.push({message:"NAME"})),a.config.newStage.chance||-1!==a.pipelines.activeStageIndex||(d=!1,e.push({message:"CHANCE"})),a.pipelines.activeStageIndex>-1&&!a.config.stages[a.pipelines.activeStageIndex].name&&(d=!1,e.push({message:"NAME"})),a.pipelines.activeStageIndex>-1&&!a.config.stages[a.pipelines.activeStageIndex].chance&&(d=!1,e.push({message:"CHANCE"})),b=0,c=e.length;c>b;b+=1)b>1&&(e[b].prefix=", ");return d||a.pageAncestor.addAlert({type:f.MESSAGE_WARNING_VALIDATION_BEFORE_CRUD,messages:e}),d},a.verifyBeforeDeleteStage=function(){var b,c,d=!0,e=[];for(e.push({message:f.MESSAGE_WARNING_VALIDATION_PIPELINE_STAGE_NOT_FOUND}),a.pipelines.selectedStageForMove.id||(d=!1,e.push({message:""})),b=0,c=e.length;c>b;b+=1)b>1&&(e[b].prefix=", ");return d||a.pageAncestor.addAlert({type:f.MESSAGE_WARNING_VALIDATION_BEFORE_CRUD,messages:e}),d},a.post=function(){a.verifyForm()&&a.pageAncestor.post(function(){return d.post(a.config.newStage).then(function(b){return a.refreshAfterInsert(b.data),b})})},a.put=function(){a.verifyForm()&&a.pageAncestor.put(function(){return d.put(a.config.stages[a.pipelines.activeStageIndex]).then(function(a){return a})})},a.del=function(){a.pipelines.showDeleteDialog=!0},a.deleteStage=function(){a.verifyBeforeDeleteStage()&&a.pageAncestor.confirm(function(){var b={id:a.config.stages[a.pipelines.activeStageIndex].id,newId:a.pipelines.selectedStageForMove.id};return d.replace(b).then(function(b){return a.refreshAfterDelete(b.data,a.pipelines.activeStageIndex),b})},f.MESSAGE_EXEC_REPLACE_STAGE_AND_DELETE,f.MESSAGE_EXEC_REPLACE_STAGE_AND_DELETE_SUCCESS,f.MESSAGE_EXEC_REPLACE_STAGE_AND_DELETE_ERROR)},a.newStage=function(){a.pageAncestor.cancel(),a.pipelines.activeStageIndex=-1,a.config.newStage={id:null,name:"",chance:null}},a.openDetail=function(b){a.pageAncestor.cancel(),a.pipelines.activeStageIndex=b,a.pipelines.showDeleteDialog=!1,a.pipelines.selectedStageForMove={}},a.refreshAfterInsert=function(b){b.id&&(a.pipelines.activeStageIndex=null,d.list().then(function(b){a.config.stages=b.data,a.pageAncestor["default"]()}))},a.refreshAfterDelete=function(b,c){b.id&&(a.pipelines.activeStageIndex=null,a.config.stages.splice(c,1),a.pageAncestor["default"]())},a.setStageForMove=function(b){a.pipelines.selectedStageForMove=a.config.stages.filter(function(a){return a.id===b.id})[0]},a.pageAncestor=e.getInstance(),a.pageAncestor.init({scope:a,formObject:"config",table:"SALES_PIPELINE_STAGES"}),a.initButtons()}]),angular.module("crmPostgresWebApp").directive("dashboardTasks",function(){return{templateUrl:"views/directives/dashboard_tasks.html",restrict:"E",controller:"DashboardTaskCtrl",scope:{}}}),angular.module("crmPostgresWebApp").controller("DashboardTaskCtrl",["$scope","$location","TasksService","MessengerService","Constants",function(a,b,c,d,e){var f={count:0,records:[]};a.dashboard={},a.config={limit:5},a.types=[e.TASK.FILTER.OLD.ID,e.TASK.FILTER.TODAY.ID,e.TASK.FILTER.TOMORROW.ID,e.TASK.FILTER.NEW.ID],a.openTask=function(c){d.setData({tasks:{filter:{type:a.types[c]}}}),b.path(e.ROUTES.TASKS)},c.userCount().then(function(b){a.dashboard.count=b.data.count}),c.userListOld(a.config).then(function(b){a.dashboard.old=b.data||f}),c.userListToday(a.config).then(function(b){a.dashboard.today=b.data||f}),c.userListTomorrow(a.config).then(function(b){a.dashboard.tomorrow=b.data||f}),c.userListNew(a.config).then(function(b){a.dashboard["new"]=b.data||f})}]),angular.module("crmPostgresWebApp").directive("dashboardSalesplan",function(){return{templateUrl:"views/directives/dashboard_salesplan.html",restrict:"E",controller:"DashboardSalesPlanCtrl",scope:{}}}),angular.module("crmPostgresWebApp").directive("dashboardAgenda",function(){return{templateUrl:"views/directives/dashboard_agenda.html",restrict:"E",link:function(a,b,c){}}}),angular.module("crmPostgresWebApp").directive("dashboardActivity",function(){return{templateUrl:"views/directives/dashboard_activity.html",restrict:"E",link:function(a,b,c){}}}),angular.module("crmPostgresWebApp").directive("dashboardAnniversary",function(){return{templateUrl:"views/directives/dashboard_anniversary.html",restrict:"E",controller:"DashboardAnniversaryCtrl",scope:{}}}),angular.module("crmPostgresWebApp").directive("dashboardGoals",function(){return{templateUrl:"views/directives/dashboard_goals.html",restrict:"E",link:function(a,b,c){}}}),angular.module("crmPostgresWebApp").directive("dashboardPipeline",function(){return{templateUrl:"views/directives/dashboard_pipeline.html",restrict:"E",link:function(a,b,c){}}}),angular.module("crmPostgresWebApp").directive("dashboardCalendar",function(){return{templateUrl:"views/directives/dashboard_calendar.html",restrict:"E",link:function(a,b,c){}}}),angular.module("crmPostgresWebApp").filter("filterWithout",function(){return function(a,b){return a.filter(function(a){return a[Object.keys(b)[0]]!==b[Object.keys(b)[0]]})}}),angular.module("crmPostgresWebApp").controller("DashboardSalesPlanCtrl",["$scope",function(a){a.chartLabels=["Plán",""],a.chartData=["500","200"],a.chartLegend=!0,a.chartColours=["#5CB85C","#FFFFFF"],a.chartOptions={tooltipFillColor:"#000",responsive:!0,showTooltips:!1}}]),angular.module("crmPostgresWebApp").controller("DashboardAnniversaryCtrl",["$scope","$location","PeopleService","MessengerService","Constants","Tools",function(a,b,c,d,e,f){var g={count:0,records:[]};a.dashboard={},c.anniversaryCount().then(function(b){a.dashboard.count=b.data.count}),c.anniversaryToday().then(function(b){a.dashboard.today=b.data||g}),c.anniversaryTomorrow().then(function(b){a.dashboard.tomorrow=b.data||g}),c.anniversaryAfterTomorrow().then(function(b){a.dashboard.afterTomorrow=b.data||g}),c.anniversaryNextDays().then(function(b){a.dashboard.nextDays=b.data||g})}]),angular.module("crmPostgresWebApp").controller("AttachmentsCtrl",["$scope","$translate","$translatePartialLoader","Constants",function(a,b,c,d){c.addPart("attachments"),b.refresh(),a.attachmentsTable=d.ATTACHMENTS_TYPES.ANY}]),angular.module("crmPostgresWebApp").service("AttachmentsService",["$http","Tools","Constants",function(a,b,c){return{list:function(c){return a.get("/api/attachments?"+b.objectToQueryString(c)).error(function(a){console.log(a)})},del:function(b){return a["delete"]("/api/attachments/"+b.id).error(function(a){console.log(a)})}}}]),angular.module("crmPostgresWebApp").controller("ContractCtrl",["$scope","$translate","$translatePartialLoader",function(a,b,c){c.addPart("contract"),b.refresh(),a.defaultFunction=function(a,b){}}]),angular.module("crmPostgresWebApp").controller("ContractsCtrl",["$scope","$translate","$translatePartialLoader",function(a,b,c){c.addPart("contracts"),b.refresh(),a.defaultFunction=function(a,b){}}]),angular.module("crmPostgresWebApp").directive("attachments",function(){return{templateUrl:"views/directives/attachments.html",restrict:"E",scope:{table:"=?",tableId:"=?",info:"=?",config:"=?"},controller:["$scope","Constants","AttachmentsService","FilesService",function(a,b,c,d){a.attachments=[],a.attachmentFile={},a.searchStr="",a.dataLoader=c.list,a.dataLoaderParams={sortField:"description",sortDirection:"asc",table:a.table,tableId:a.tableId},a.infoPaging={},a.uploadAttachmentConfig={},a.uploadPicture=function(){d.uploadFile(a.attachmentFile,a.uploadAttachmentConfig)},a.setSearch=function(b){13===b.which&&(a.dataLoaderParams.searchStr=a.searchStr)},a.selectFile=function(b){a.attachmentFile=b,a.uploadPicture()},a.initAttachmentsConfig=function(){a.uploadAttachmentConfig={url:"/api/attachments/upload/"+(a.table||b.ATTACHMENTS_TYPES.ANY)+"/"+(a.tableId||"999999"),errorMsg:"",callback:a.afterUploadAttachment,callbackError:a.afterUploadAttachmentError}},a.initAttachments=function(){"object"==typeof a.info?a.info.paging=a.infoPaging:a.info={paging:a.infoPaging}},a.afterUploadAttachment=function(){a.inProcess=!1,a.dataLoaderParams.loadCount=!0,a.dataLoaderParams.hash=Math.random()},a.afterUploadAttachmentError=function(){a.inProcess=!1},a.deleteFile=function(b){c.del(b).then(function(){a.afterDeleteAttachment()})},a.afterDeleteAttachment=function(){a.inProcess=!1,a.dataLoaderParams.loadCount=!0,a.dataLoaderParams.hash=Math.random()},a.$watch("config.selectFileHash",function(a,b){a!==b&&$("#selectFile").click()},!0),a.initAttachments(),a.initAttachmentsConfig()}]}}),angular.module("crmPostgresWebApp").directive("htmlTextEditor",[function(){return{templateUrl:"views/directives/html_text_editor.html",restrict:"E",scope:{model:"="}}}]),angular.module("crmPostgresWebApp").controller("UserCtrl",["$scope","$translate","$translatePartialLoader","UsersService","PageAncestor","Constants",function(a,b,c,d,e,f){c.addPart("user"),b.refresh(),a.settings={user:{},resType:0},a.users=[],a.resTypes=[{id:0,name:"ALL"},{id:1,name:"USER"}],a.loadUsers=function(){d.list().then(function(b){a.users=b.data})},a.setUser=function(b){a.settings.user=a.users[b]},a.setResType=function(b){a.settings.resType=a.resTypes[b]},a.verifyForm=function(){var b,c,d=!0,e=[];for(e.push({message:"WARNING_FIELD_VALUE_INVALID"}),a.settings&&a.settings.user&&a.settings.user.id||(d=!1,e.push({message:"USER"})),b=0,c=e.length;c>b;b+=1)b>1&&(e[b].prefix=", ");return d||a.pageAncestor.addAlert({type:f.MESSAGE_WARNING_VALIDATION_BEFORE_CRUD,messages:e}),d},a.createPermission=function(){var b={id:a.settings.user.id,resType:a.settings.resType.id};a.verifyForm()&&a.pageAncestor.post(function(){return d.createPermission(b).then(function(a){return a})})},a.pageAncestor=e.getInstance(),a.pageAncestor.init({scope:a,formObject:"settings",table:"USERS_RESTRICTIONS"}),a.loadUsers()}]);